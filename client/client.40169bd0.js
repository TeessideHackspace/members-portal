function e(){}const t=e=>e;function r(e,t){for(const r in t)e[r]=t[r];return e}function i(e){return e()}function s(){return Object.create(null)}function n(e){e.forEach(i)}function o(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(t,r,i){t.$$.on_destroy.push(function(t,...r){if(null==t)return e;const i=t.subscribe(...r);return i.unsubscribe?()=>i.unsubscribe():i}(r,i))}function c(e,t,r,i){if(e){const s=h(e,t,r,i);return e[0](s)}}function h(e,t,i,s){return e[1]&&s?r(i.ctx.slice(),e[1](s(t))):i.ctx}function l(e,t,r,i,s,n,o){const a=function(e,t,r,i){if(e[2]&&i){const s=e[2](i(r));if(void 0===t.dirty)return s;if("object"==typeof s){const e=[],r=Math.max(t.dirty.length,s.length);for(let i=0;i<r;i+=1)e[i]=t.dirty[i]|s[i];return e}return t.dirty|s}return t.dirty}(t,i,s,n);if(a){const s=h(t,r,i,o);e.p(s,a)}}function d(e){const t={};for(const r in e)"$"!==r[0]&&(t[r]=e[r]);return t}function g(t){return t&&o(t.destroy)?t.destroy:e}const p="undefined"!=typeof window;let f=p?()=>window.performance.now():()=>Date.now(),v=p?e=>requestAnimationFrame(e):e;const m=new Set;function y(e){m.forEach(t=>{t.c(e)||(m.delete(t),t.f())}),0!==m.size&&v(y)}function _(e,t){e.appendChild(t)}function F(e,t,r){e.insertBefore(t,r||null)}function S(e){e.parentNode.removeChild(e)}function b(e,t){for(let r=0;r<e.length;r+=1)e[r]&&e[r].d(t)}function w(e){return document.createElement(e)}function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function x(e){return document.createTextNode(e)}function k(){return x(" ")}function A(){return x("")}function P(e,t,r,i){return e.addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)}function C(e,t,r){null==r?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function R(e,t){const r=Object.getOwnPropertyDescriptors(e.__proto__);for(const i in t)null==t[i]?e.removeAttribute(i):"style"===i?e.style.cssText=t[i]:"__value"===i?e.value=e[i]=t[i]:r[i]&&r[i].set?e[i]=t[i]:C(e,i,t[i])}function T(e){return Array.from(e.childNodes)}function I(e,t,r,i){for(let i=0;i<e.length;i+=1){const s=e[i];if(s.nodeName===t){let t=0;const n=[];for(;t<s.attributes.length;){const e=s.attributes[t++];r[e.name]||n.push(e.name)}for(let e=0;e<n.length;e++)s.removeAttribute(n[e]);return e.splice(i,1)[0]}}return i?E(t):w(t)}function D(e,t){for(let r=0;r<e.length;r+=1){const i=e[r];if(3===i.nodeType)return i.data=""+t,e.splice(r,1)[0]}return x(t)}function N(e){return D(e," ")}function H(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function B(e,t){e.value=null==t?"":t}function U(e,t,r,i){e.style.setProperty(t,r,i?"important":"")}function j(e,t,r){e.classList[r?"add":"remove"](t)}function O(e,t=document.body){return Array.from(t.querySelectorAll(e))}const M=new Set;let V,K=0;function q(e,t){const r=(e.style.animation||"").split(", "),i=r.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),s=r.length-i.length;s&&(e.style.animation=i.join(", "),(K-=s)||v(()=>{K||(M.forEach(e=>{const t=e.__svelte_stylesheet;let r=t.cssRules.length;for(;r--;)t.deleteRule(r);e.__svelte_rules={}}),M.clear())}))}function L(e){V=e}function $(){if(!V)throw new Error("Function called outside component initialization");return V}function J(e){$().$$.on_mount.push(e)}function W(e){$().$$.after_update.push(e)}function z(e){$().$$.on_destroy.push(e)}function G(e,t){$().$$.context.set(e,t)}function Y(e){return $().$$.context.get(e)}function Q(e,t){const r=e.$$.callbacks[t.type];r&&r.slice().forEach(e=>e(t))}const X=[],Z=[],ee=[],te=[],re=Promise.resolve();let ie=!1;function se(){ie||(ie=!0,re.then(ce))}function ne(e){ee.push(e)}function oe(e){te.push(e)}let ae=!1;const ue=new Set;function ce(){if(!ae){ae=!0;do{for(let e=0;e<X.length;e+=1){const t=X[e];L(t),he(t.$$)}for(X.length=0;Z.length;)Z.pop()();for(let e=0;e<ee.length;e+=1){const t=ee[e];ue.has(t)||(ue.add(t),t())}ee.length=0}while(X.length);for(;te.length;)te.pop()();ie=!1,ae=!1,ue.clear()}}function he(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ne)}}let le;function de(e,t,r){e.dispatchEvent(function(e,t){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!1,!1,t),r}(`${t?"intro":"outro"}${r}`))}const ge=new Set;let pe;function fe(){pe={r:0,c:[],p:pe}}function ve(){pe.r||n(pe.c),pe=pe.p}function me(e,t){e&&e.i&&(ge.delete(e),e.i(t))}function ye(e,t,r,i){if(e&&e.o){if(ge.has(e))return;ge.add(e),pe.c.push(()=>{ge.delete(e),i&&(r&&e.d(1),i())}),e.o(t)}}const _e={duration:0};function Fe(r,i,s){let n,a,u=i(r,s),c=!1,h=0;function l(){n&&q(r,n)}function d(){const{delay:i=0,duration:s=300,easing:o=t,tick:d=e,css:g}=u||_e;g&&(n=function(e,t,r,i,s,n,o,a=0){const u=16.666/i;let c="{\n";for(let e=0;e<=1;e+=u){const i=t+(r-t)*n(e);c+=100*e+`%{${o(i,1-i)}}\n`}const h=c+`100% {${o(r,1-r)}}\n}`,l=`__svelte_${function(e){let t=5381,r=e.length;for(;r--;)t=(t<<5)-t^e.charCodeAt(r);return t>>>0}(h)}_${a}`,d=e.ownerDocument;M.add(d);const g=d.__svelte_stylesheet||(d.__svelte_stylesheet=d.head.appendChild(w("style")).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[l]||(p[l]=!0,g.insertRule(`@keyframes ${l} ${h}`,g.cssRules.length));const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${l} ${i}ms linear ${s}ms 1 both`,K+=1,l}(r,0,1,s,i,o,g,h++)),d(0,1);const p=f()+i,_=p+s;a&&a.abort(),c=!0,ne(()=>de(r,!0,"start")),a=function(e){let t;return 0===m.size&&v(y),{promise:new Promise(r=>{m.add(t={c:e,f:r})}),abort(){m.delete(t)}}}(e=>{if(c){if(e>=_)return d(1,0),de(r,!0,"end"),l(),c=!1;if(e>=p){const t=o((e-p)/s);d(t,1-t)}}return c})}let g=!1;return{start(){g||(q(r),o(u)?(u=u(),(le||(le=Promise.resolve()).then(()=>{le=null}),le).then(d)):d())},invalidate(){g=!1},end(){c&&(l(),c=!1)}}}function Se(e,t){const r=t.token={};function i(e,i,s,n){if(t.token!==r)return;t.resolved=n;let o=t.ctx;void 0!==s&&((o=o.slice())[s]=n);const a=e&&(t.current=e)(o);let u=!1;t.block&&(t.blocks?t.blocks.forEach((e,r)=>{r!==i&&e&&(fe(),ye(e,1,1,()=>{t.blocks[r]=null}),ve())}):t.block.d(1),a.c(),me(a,1),a.m(t.mount(),t.anchor),u=!0),t.block=a,t.blocks&&(t.blocks[i]=a),u&&ce()}if((s=e)&&"object"==typeof s&&"function"==typeof s.then){const r=$();if(e.then(e=>{L(r),i(t.then,1,t.value,e),L(null)},e=>{L(r),i(t.catch,2,t.error,e),L(null)}),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}var s}function be(e,t){const r={},i={},s={$$scope:1};let n=e.length;for(;n--;){const o=e[n],a=t[n];if(a){for(const e in o)e in a||(i[e]=1);for(const e in a)s[e]||(r[e]=a[e],s[e]=1);e[n]=a}else for(const e in o)s[e]=1}for(const e in i)e in r||(r[e]=void 0);return r}function we(e){return"object"==typeof e&&null!==e?e:{}}function Ee(e,t,r){const i=e.$$.props[t];void 0!==i&&(e.$$.bound[i]=r,r(e.$$.ctx[i]))}function xe(e){e&&e.c()}function ke(e,t){e&&e.l(t)}function Ae(e,t,r){const{fragment:s,on_mount:a,on_destroy:u,after_update:c}=e.$$;s&&s.m(t,r),ne(()=>{const t=a.map(i).filter(o);u?u.push(...t):n(t),e.$$.on_mount=[]}),c.forEach(ne)}function Pe(e,t){const r=e.$$;null!==r.fragment&&(n(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function Ce(t,r,i,o,a,u,c=[-1]){const h=V;L(t);const l=r.props||{},d=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:a,bound:s(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:s(),dirty:c};let g=!1;if(d.ctx=i?i(t,l,(e,r,...i)=>{const s=i.length?i[0]:r;return d.ctx&&a(d.ctx[e],d.ctx[e]=s)&&(d.bound[e]&&d.bound[e](s),g&&function(e,t){-1===e.$$.dirty[0]&&(X.push(e),se(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),r}):[],d.update(),g=!0,n(d.before_update),d.fragment=!!o&&o(d.ctx),r.target){if(r.hydrate){const e=T(r.target);d.fragment&&d.fragment.l(e),e.forEach(S)}else d.fragment&&d.fragment.c();r.intro&&me(t.$$.fragment),Ae(t,r.target,r.anchor),ce()}L(h)}class Re{$destroy(){Pe(this,1),this.$destroy=e}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}$set(){}}const Te=[];function Ie(e,t){return{subscribe:De(e,t).subscribe}}function De(t,r=e){let i;const s=[];function n(e){if(a(t,e)&&(t=e,i)){const e=!Te.length;for(let e=0;e<s.length;e+=1){const r=s[e];r[1](),Te.push(r,t)}if(e){for(let e=0;e<Te.length;e+=2)Te[e][0](Te[e+1]);Te.length=0}}}return{set:n,update:function(e){n(e(t))},subscribe:function(o,a=e){const u=[o,a];return s.push(u),1===s.length&&(i=r(n)||e),o(t),()=>{const e=s.indexOf(u);-1!==e&&s.splice(e,1),0===s.length&&(i(),i=null)}}}}const Ne={},He=()=>({});let Be={debug(){},info(){},warn(){},error(){}};const Ue=0,je=1,Oe=2,Me=3,Ve=4;let Ke,qe;class Le{static get NONE(){return Ue}static get ERROR(){return je}static get WARN(){return Oe}static get INFO(){return Me}static get DEBUG(){return Ve}static reset(){qe=Me,Ke=Be}static get level(){return qe}static set level(e){if(!(Ue<=e&&e<=Ve))throw new Error("Invalid log level");qe=e}static get logger(){return Ke}static set logger(e){if(!e.debug&&e.info&&(e.debug=e.info),!(e.debug&&e.info&&e.warn&&e.error))throw new Error("Invalid logger");Ke=e}static debug(...e){qe>=Ve&&Ke.debug.apply(Ke,Array.from(e))}static info(...e){qe>=Me&&Ke.info.apply(Ke,Array.from(e))}static warn(...e){qe>=Oe&&Ke.warn.apply(Ke,Array.from(e))}static error(...e){qe>=je&&Ke.error.apply(Ke,Array.from(e))}}Le.reset();const $e={setInterval:function(e,t){return setInterval(e,t)},clearInterval:function(e){return clearInterval(e)}};let Je=!1,We=null;class ze{static _testing(){Je=!0}static get location(){if(!Je)return location}static get localStorage(){if(!Je&&"undefined"!=typeof window)return localStorage}static get sessionStorage(){if(!Je&&"undefined"!=typeof window)return sessionStorage}static setXMLHttpRequest(e){We=e}static get XMLHttpRequest(){if(!Je&&"undefined"!=typeof window)return We||XMLHttpRequest}static get timer(){if(!Je)return $e}}class Ge{constructor({prefix:e="oidc.",store:t=ze.localStorage}={}){this._store=t,this._prefix=e}set(e,t){return Le.debug("WebStorageStateStore.set",e),e=this._prefix+e,this._store.setItem(e,t),Promise.resolve()}get(e){Le.debug("WebStorageStateStore.get",e),e=this._prefix+e;let t=this._store.getItem(e);return Promise.resolve(t)}remove(e){Le.debug("WebStorageStateStore.remove",e),e=this._prefix+e;let t=this._store.getItem(e);return this._store.removeItem(e),Promise.resolve(t)}getAllKeys(){Le.debug("WebStorageStateStore.getAllKeys");var e=[];for(let t=0;t<this._store.length;t++){let r=this._store.key(t);0===r.indexOf(this._prefix)&&e.push(r.substr(this._prefix.length))}return Promise.resolve(e)}}class Ye{constructor(e=null,t=ze.XMLHttpRequest,r=null){e&&Array.isArray(e)?this._contentTypes=e.slice():this._contentTypes=[],this._contentTypes.push("application/json"),r&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=t,this._jwtHandler=r}getJson(e,t){if(!e)throw Le.error("JsonService.getJson: No url passed"),new Error("url");return Le.debug("JsonService.getJson, url: ",e),new Promise((r,i)=>{var s=new this._XMLHttpRequest;s.open("GET",e);var n=this._contentTypes,o=this._jwtHandler;s.onload=function(){if(Le.debug("JsonService.getJson: HTTP response received, status",s.status),200===s.status){var t=s.getResponseHeader("Content-Type");if(t){var a=n.find(e=>{if(t.startsWith(e))return!0});if("application/jwt"==a)return void o(s).then(r,i);if(a)try{return void r(JSON.parse(s.responseText))}catch(e){return Le.error("JsonService.getJson: Error parsing JSON response",e.message),void i(e)}}i(Error("Invalid response Content-Type: "+t+", from URL: "+e))}else i(Error(s.statusText+" ("+s.status+")"))},s.onerror=function(){Le.error("JsonService.getJson: network error"),i(Error("Network Error"))},t&&(Le.debug("JsonService.getJson: token passed, setting Authorization header"),s.setRequestHeader("Authorization","Bearer "+t)),s.send()})}postForm(e,t){if(!e)throw Le.error("JsonService.postForm: No url passed"),new Error("url");return Le.debug("JsonService.postForm, url: ",e),new Promise((r,i)=>{var s=new this._XMLHttpRequest;s.open("POST",e);var n=this._contentTypes;s.onload=function(){if(Le.debug("JsonService.postForm: HTTP response received, status",s.status),200!==s.status){if(400===s.status)if(o=s.getResponseHeader("Content-Type"))if(n.find(e=>{if(o.startsWith(e))return!0}))try{var t=JSON.parse(s.responseText);if(t&&t.error)return Le.error("JsonService.postForm: Error from server: ",t.error),void i(new Error(t.error))}catch(e){return Le.error("JsonService.postForm: Error parsing JSON response",e.message),void i(e)}i(Error(s.statusText+" ("+s.status+")"))}else{var o;if((o=s.getResponseHeader("Content-Type"))&&n.find(e=>{if(o.startsWith(e))return!0}))try{return void r(JSON.parse(s.responseText))}catch(e){return Le.error("JsonService.postForm: Error parsing JSON response",e.message),void i(e)}i(Error("Invalid response Content-Type: "+o+", from URL: "+e))}},s.onerror=function(){Le.error("JsonService.postForm: network error"),i(Error("Network Error"))};let o="";for(let e in t){let r=t[e];r&&(o.length>0&&(o+="&"),o+=encodeURIComponent(e),o+="=",o+=encodeURIComponent(r))}s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(o)})}}const Qe=".well-known/openid-configuration";class Xe{constructor(e,t=Ye){if(!e)throw Le.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=e,this._jsonService=new t(["application/jwk-set+json"])}get metadataUrl(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(Qe)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=Qe))),this._metadataUrl}getMetadata(){return this._settings.metadata?(Le.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(Le.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(e=>(Le.debug("MetadataService.getMetadata: json received"),this._settings.metadata=e,e))):(Le.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(){return this._getMetadataProperty("revocation_endpoint",!0)}getKeysEndpoint(){return this._getMetadataProperty("jwks_uri",!0)}_getMetadataProperty(e,t=!1){return Le.debug("MetadataService.getMetadataProperty for: "+e),this.getMetadata().then(r=>{if(Le.debug("MetadataService.getMetadataProperty: metadata recieved"),void 0===r[e]){if(!0===t)return void Le.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+e);throw Le.error("MetadataService.getMetadataProperty: Metadata does not contain property "+e),new Error("Metadata does not contain property "+e)}return r[e]})}getSigningKeys(){return this._settings.signingKeys?(Le.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(e=>(Le.debug("MetadataService.getSigningKeys: jwks_uri received",e),this._jsonService.getJson(e).then(e=>{if(Le.debug("MetadataService.getSigningKeys: key set received",e),!e.keys)throw Le.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return this._settings.signingKeys=e.keys,this._settings.signingKeys})))}}var Ze={userAgent:!1},et={};if(void 0===tt)var tt={};tt.lang={extend:function(e,t,r){if(!t||!e)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var i=function(){};if(i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),r){var s;for(s in r)e.prototype[s]=r[s];var n=function(){},o=["toString","valueOf"];try{/MSIE/.test(Ze.userAgent)&&(n=function(e,t){for(s=0;s<o.length;s+=1){var r=o[s],i=t[r];"function"==typeof i&&i!=Object.prototype[r]&&(e[r]=i)}})}catch(e){}n(e.prototype,r)}}};var rt,it,st,nt,ot=ot||function(e,t){var r={},i=r.lib={},s=i.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var r=new e;return t&&r.mixIn(t),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),n=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,r=e.words,i=this.sigBytes,s=e.sigBytes;if(this.clamp(),i%4)for(var n=0;n<s;n++){var o=r[n>>>2]>>>24-n%4*8&255;t[i+n>>>2]|=o<<24-(i+n)%4*8}else for(n=0;n<s;n+=4)t[i+n>>>2]=r[n>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],i=0;i<t;i+=4)r.push(4294967296*e.random()|0);return new n.init(r,t)}}),o=r.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],s=0;s<r;s++){var n=t[s>>>2]>>>24-s%4*8&255;i.push((n>>>4).toString(16)),i.push((15&n).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new n.init(r,t/2)}},u=o.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,i=[],s=0;s<r;s++){var n=t[s>>>2]>>>24-s%4*8&255;i.push(String.fromCharCode(n))}return i.join("")},parse:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new n.init(r,t)}},c=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,i=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,c=e.min(4*u,s);if(u){for(var h=0;h<u;h+=o)this._doProcessBlock(i,h);var l=i.splice(0,u);r.sigBytes-=c}return new n.init(l,c)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),l=(i.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new l.HMAC.init(e,r).finalize(t)}}}),r.algo={});return r}(Math);it=(rt=ot).lib,st=it.Base,nt=it.WordArray,(rt=rt.x64={}).Word=st.extend({init:function(e,t){this.high=e,this.low=t}}),rt.WordArray=st.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],i=0;i<t;i++){var s=e[i];r.push(s.high),r.push(s.low)}return nt.create(r,this.sigBytes)},clone:function(){for(var e=st.clone.call(this),t=e.words=this.words.slice(0),r=t.length,i=0;i<r;i++)t[i]=t[i].clone();return e}}),function(){var e=ot,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,i=this._map;e.clamp(),e=[];for(var s=0;s<r;s+=3)for(var n=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;4>o&&s+.75*o<r;o++)e.push(i.charAt(n>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var r=e.length,i=this._map;(s=i.charAt(64))&&(-1!=(s=e.indexOf(s))&&(r=s));for(var s=[],n=0,o=0;o<r;o++)if(o%4){var a=i.indexOf(e.charAt(o-1))<<o%4*2,u=i.indexOf(e.charAt(o))>>>6-o%4*2;s[n>>>2]|=(a|u)<<24-n%4*8,n++}return t.create(s,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){for(var t=ot,r=(s=t.lib).WordArray,i=s.Hasher,s=t.algo,n=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var h;e:{h=u;for(var l=e.sqrt(h),d=2;d<=l;d++)if(!(h%d)){h=!1;break e}h=!0}h&&(8>c&&(n[c]=a(e.pow(u,.5))),o[c]=a(e.pow(u,1/3)),c++),u++}var g=[];s=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(n.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,i=r[0],s=r[1],n=r[2],a=r[3],u=r[4],c=r[5],h=r[6],l=r[7],d=0;64>d;d++){if(16>d)g[d]=0|e[t+d];else{var p=g[d-15],f=g[d-2];g[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+g[d-7]+((f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10)+g[d-16]}p=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&h)+o[d]+g[d],f=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&s^i&n^s&n),l=h,h=c,c=u,u=a+p|0,a=n,n=s,s=i,i=p+f|0}r[0]=r[0]+i|0,r[1]=r[1]+s|0,r[2]=r[2]+n|0,r[3]=r[3]+a|0,r[4]=r[4]+u|0,r[5]=r[5]+c|0,r[6]=r[6]+h|0,r[7]=r[7]+l|0},_doFinalize:function(){var t=this._data,r=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return r[s>>>5]|=128<<24-s%32,r[14+(s+64>>>9<<4)]=e.floor(i/4294967296),r[15+(s+64>>>9<<4)]=i,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(s),t.HmacSHA256=i._createHmacHelper(s)}(Math),function(){function e(){return i.create.apply(i,arguments)}for(var t=ot,r=t.lib.Hasher,i=(n=t.x64).Word,s=n.WordArray,n=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],a=[],u=0;80>u;u++)a[u]=e();n=n.SHA512=r.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=(l=this._hash.words)[0],i=l[1],s=l[2],n=l[3],u=l[4],c=l[5],h=l[6],l=l[7],d=r.high,g=r.low,p=i.high,f=i.low,v=s.high,m=s.low,y=n.high,_=n.low,F=u.high,S=u.low,b=c.high,w=c.low,E=h.high,x=h.low,k=l.high,A=l.low,P=d,C=g,R=p,T=f,I=v,D=m,N=y,H=_,B=F,U=S,j=b,O=w,M=E,V=x,K=k,q=A,L=0;80>L;L++){var $=a[L];if(16>L)var J=$.high=0|e[t+2*L],W=$.low=0|e[t+2*L+1];else{J=((W=(J=a[L-15]).high)>>>1|(z=J.low)<<31)^(W>>>8|z<<24)^W>>>7;var z=(z>>>1|W<<31)^(z>>>8|W<<24)^(z>>>7|W<<25),G=((W=(G=a[L-2]).high)>>>19|(Y=G.low)<<13)^(W<<3|Y>>>29)^W>>>6,Y=(Y>>>19|W<<13)^(Y<<3|W>>>29)^(Y>>>6|W<<26),Q=(W=a[L-7]).high,X=(Z=a[L-16]).high,Z=Z.low;J=(J=(J=J+Q+((W=z+W.low)>>>0<z>>>0?1:0))+G+((W=W+Y)>>>0<Y>>>0?1:0))+X+((W=W+Z)>>>0<Z>>>0?1:0);$.high=J,$.low=W}Q=B&j^~B&M,Z=U&O^~U&V,$=P&R^P&I^R&I;var ee=C&T^C&D^T&D,te=(z=(P>>>28|C<<4)^(P<<30|C>>>2)^(P<<25|C>>>7),G=(C>>>28|P<<4)^(C<<30|P>>>2)^(C<<25|P>>>7),(Y=o[L]).high),re=Y.low;X=K+((B>>>14|U<<18)^(B>>>18|U<<14)^(B<<23|U>>>9))+((Y=q+((U>>>14|B<<18)^(U>>>18|B<<14)^(U<<23|B>>>9)))>>>0<q>>>0?1:0),K=M,q=V,M=j,V=O,j=B,O=U,B=N+(X=(X=(X=X+Q+((Y=Y+Z)>>>0<Z>>>0?1:0))+te+((Y=Y+re)>>>0<re>>>0?1:0))+J+((Y=Y+W)>>>0<W>>>0?1:0))+((U=H+Y|0)>>>0<H>>>0?1:0)|0,N=I,H=D,I=R,D=T,R=P,T=C,P=X+($=z+$+((W=G+ee)>>>0<G>>>0?1:0))+((C=Y+W|0)>>>0<Y>>>0?1:0)|0}g=r.low=g+C,r.high=d+P+(g>>>0<C>>>0?1:0),f=i.low=f+T,i.high=p+R+(f>>>0<T>>>0?1:0),m=s.low=m+D,s.high=v+I+(m>>>0<D>>>0?1:0),_=n.low=_+H,n.high=y+N+(_>>>0<H>>>0?1:0),S=u.low=S+U,u.high=F+B+(S>>>0<U>>>0?1:0),w=c.low=w+O,c.high=b+j+(w>>>0<O>>>0?1:0),x=h.low=x+V,h.high=E+M+(x>>>0<V>>>0?1:0),A=l.low=A+q,l.high=k+K+(A>>>0<q>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(i+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=r._createHelper(n),t.HmacSHA512=r._createHmacHelper(n)}(),function(){var e=ot,t=(s=e.x64).Word,r=s.WordArray,i=(s=e.algo).SHA512,s=s.SHA384=i.extend({_doReset:function(){this._hash=new r.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=i._createHelper(s),e.HmacSHA384=i._createHmacHelper(s)}();var at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ut="=";function ct(e){var t,r,i="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),i+=at.charAt(r>>6)+at.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),i+=at.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),i+=at.charAt(r>>2)+at.charAt((3&r)<<4));(3&i.length)>0;)i+=ut;return i}function ht(e){var t,r,i,s="",n=0;for(t=0;t<e.length&&e.charAt(t)!=ut;++t)(i=at.indexOf(e.charAt(t)))<0||(0==n?(s+=mt(i>>2),r=3&i,n=1):1==n?(s+=mt(r<<2|i>>4),r=15&i,n=2):2==n?(s+=mt(r),s+=mt(i>>2),r=3&i,n=3):(s+=mt(r<<2|i>>4),s+=mt(15&i),n=0));return 1==n&&(s+=mt(r<<2)),s}function lt(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function dt(){return new lt(null)}lt.prototype.am=function(e,t,r,i,s,n){for(;--n>=0;){var o=t*this[e++]+r[i]+s;s=Math.floor(o/67108864),r[i++]=67108863&o}return s},lt.prototype.DB=26,lt.prototype.DM=67108863,lt.prototype.DV=1<<26;lt.prototype.FV=Math.pow(2,52),lt.prototype.F1=26,lt.prototype.F2=0;var gt,pt,ft="0123456789abcdefghijklmnopqrstuvwxyz",vt=new Array;for(gt="0".charCodeAt(0),pt=0;pt<=9;++pt)vt[gt++]=pt;for(gt="a".charCodeAt(0),pt=10;pt<36;++pt)vt[gt++]=pt;for(gt="A".charCodeAt(0),pt=10;pt<36;++pt)vt[gt++]=pt;function mt(e){return ft.charAt(e)}function yt(e,t){var r=vt[e.charCodeAt(t)];return null==r?-1:r}function _t(e){var t=dt();return t.fromInt(e),t}function Ft(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function St(e){this.m=e}function bt(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function wt(e,t){return e&t}function Et(e,t){return e|t}function xt(e,t){return e^t}function kt(e,t){return e&~t}function At(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function Pt(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function Ct(){}function Rt(e){return e}function Tt(e){this.r2=dt(),this.q3=dt(),lt.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}St.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},St.prototype.revert=function(e){return e},St.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},St.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},St.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},bt.prototype.convert=function(e){var t=dt();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(lt.ZERO)>0&&this.m.subTo(t,t),t},bt.prototype.revert=function(e){var t=dt();return e.copyTo(t),this.reduce(t),t},bt.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],i=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,i,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},bt.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},bt.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},lt.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},lt.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},lt.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var i=e.length,s=!1,n=0;--i>=0;){var o=8==r?255&e[i]:yt(e,i);o<0?"-"==e.charAt(i)&&(s=!0):(s=!1,0==n?this[this.t++]=o:n+r>this.DB?(this[this.t-1]|=(o&(1<<this.DB-n)-1)<<n,this[this.t++]=o>>this.DB-n):this[this.t-1]|=o<<n,(n+=r)>=this.DB&&(n-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,n>0&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),s&&lt.ZERO.subTo(this,this)},lt.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},lt.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},lt.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},lt.prototype.lShiftTo=function(e,t){var r,i=e%this.DB,s=this.DB-i,n=(1<<s)-1,o=Math.floor(e/this.DB),a=this.s<<i&this.DM;for(r=this.t-1;r>=0;--r)t[r+o+1]=this[r]>>s|a,a=(this[r]&n)<<i;for(r=o-1;r>=0;--r)t[r]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},lt.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var i=e%this.DB,s=this.DB-i,n=(1<<i)-1;t[0]=this[r]>>i;for(var o=r+1;o<this.t;++o)t[o-r-1]|=(this[o]&n)<<s,t[o-r]=this[o]>>i;i>0&&(t[this.t-r-1]|=(this.s&n)<<s),t.t=this.t-r,t.clamp()}},lt.prototype.subTo=function(e,t){for(var r=0,i=0,s=Math.min(e.t,this.t);r<s;)i+=this[r]-e[r],t[r++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i-=e.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<e.t;)i-=e[r],t[r++]=i&this.DM,i>>=this.DB;i-=e.s}t.s=i<0?-1:0,i<-1?t[r++]=this.DV+i:i>0&&(t[r++]=i),t.t=r,t.clamp()},lt.prototype.multiplyTo=function(e,t){var r=this.abs(),i=e.abs(),s=r.t;for(t.t=s+i.t;--s>=0;)t[s]=0;for(s=0;s<i.t;++s)t[s+r.t]=r.am(0,i[s],t,s,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&lt.ZERO.subTo(t,t)},lt.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var i=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,i,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},lt.prototype.divRemTo=function(e,t,r){var i=e.abs();if(!(i.t<=0)){var s=this.abs();if(s.t<i.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=dt());var n=dt(),o=this.s,a=e.s,u=this.DB-Ft(i[i.t-1]);u>0?(i.lShiftTo(u,n),s.lShiftTo(u,r)):(i.copyTo(n),s.copyTo(r));var c=n.t,h=n[c-1];if(0!=h){var l=h*(1<<this.F1)+(c>1?n[c-2]>>this.F2:0),d=this.FV/l,g=(1<<this.F1)/l,p=1<<this.F2,f=r.t,v=f-c,m=null==t?dt():t;for(n.dlShiftTo(v,m),r.compareTo(m)>=0&&(r[r.t++]=1,r.subTo(m,r)),lt.ONE.dlShiftTo(c,m),m.subTo(n,n);n.t<c;)n[n.t++]=0;for(;--v>=0;){var y=r[--f]==h?this.DM:Math.floor(r[f]*d+(r[f-1]+p)*g);if((r[f]+=n.am(0,y,r,v,0,c))<y)for(n.dlShiftTo(v,m),r.subTo(m,r);r[f]<--y;)r.subTo(m,r)}null!=t&&(r.drShiftTo(c,t),o!=a&&lt.ZERO.subTo(t,t)),r.t=c,r.clamp(),u>0&&r.rShiftTo(u,r),o<0&&lt.ZERO.subTo(r,r)}}},lt.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},lt.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},lt.prototype.exp=function(e,t){if(e>4294967295||e<1)return lt.ONE;var r=dt(),i=dt(),s=t.convert(this),n=Ft(e)-1;for(s.copyTo(r);--n>=0;)if(t.sqrTo(r,i),(e&1<<n)>0)t.mulTo(i,s,r);else{var o=r;r=i,i=o}return t.revert(r)},lt.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,i=(1<<t)-1,s=!1,n="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this[o]>>a)>0&&(s=!0,n=mt(r));o>=0;)a<t?(r=(this[o]&(1<<a)-1)<<t-a,r|=this[--o]>>(a+=this.DB-t)):(r=this[o]>>(a-=t)&i,a<=0&&(a+=this.DB,--o)),r>0&&(s=!0),s&&(n+=mt(r));return s?n:"0"},lt.prototype.negate=function(){var e=dt();return lt.ZERO.subTo(this,e),e},lt.prototype.abs=function(){return this.s<0?this.negate():this},lt.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},lt.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Ft(this[this.t-1]^this.s&this.DM)},lt.prototype.mod=function(e){var t=dt();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(lt.ZERO)>0&&e.subTo(t,t),t},lt.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new St(t):new bt(t),this.exp(e,r)},lt.ZERO=_t(0),lt.ONE=_t(1),Ct.prototype.convert=Rt,Ct.prototype.revert=Rt,Ct.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},Ct.prototype.sqrTo=function(e,t){e.squareTo(t)},Tt.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=dt();return e.copyTo(t),this.reduce(t),t},Tt.prototype.revert=function(e){return e},Tt.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},Tt.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},Tt.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var It=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Dt=(1<<26)/It[It.length-1];function Nt(){this.i=0,this.j=0,this.S=new Array}lt.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},lt.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=_t(r),s=dt(),n=dt(),o="";for(this.divRemTo(i,s,n);s.signum()>0;)o=(r+n.intValue()).toString(e).substr(1)+o,s.divRemTo(i,s,n);return n.intValue().toString(e)+o},lt.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),i=Math.pow(t,r),s=!1,n=0,o=0,a=0;a<e.length;++a){var u=yt(e,a);u<0?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(o=t*o+u,++n>=r&&(this.dMultiply(i),this.dAddOffset(o,0),n=0,o=0))}n>0&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(o,0)),s&&lt.ZERO.subTo(this,this)},lt.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(lt.ONE.shiftLeft(e-1),Et,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(lt.ONE.shiftLeft(e-1),this);else{var i=new Array,s=7&e;i.length=1+(e>>3),t.nextBytes(i),s>0?i[0]&=(1<<s)-1:i[0]=0,this.fromString(i,256)}},lt.prototype.bitwiseTo=function(e,t,r){var i,s,n=Math.min(e.t,this.t);for(i=0;i<n;++i)r[i]=t(this[i],e[i]);if(e.t<this.t){for(s=e.s&this.DM,i=n;i<this.t;++i)r[i]=t(this[i],s);r.t=this.t}else{for(s=this.s&this.DM,i=n;i<e.t;++i)r[i]=t(s,e[i]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},lt.prototype.changeBit=function(e,t){var r=lt.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},lt.prototype.addTo=function(e,t){for(var r=0,i=0,s=Math.min(e.t,this.t);r<s;)i+=this[r]+e[r],t[r++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i+=e.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<e.t;)i+=e[r],t[r++]=i&this.DM,i>>=this.DB;i+=e.s}t.s=i<0?-1:0,i>0?t[r++]=i:i<-1&&(t[r++]=this.DV+i),t.t=r,t.clamp()},lt.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},lt.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},lt.prototype.multiplyLowerTo=function(e,t,r){var i,s=Math.min(this.t+e.t,t);for(r.s=0,r.t=s;s>0;)r[--s]=0;for(i=r.t-this.t;s<i;++s)r[s+this.t]=this.am(0,e[s],r,s,0,this.t);for(i=Math.min(e.t,t);s<i;++s)this.am(0,e[s],r,s,0,t-s);r.clamp()},lt.prototype.multiplyUpperTo=function(e,t,r){--t;var i=r.t=this.t+e.t-t;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(t-this.t,0);i<e.t;++i)r[this.t+i-t]=this.am(t-i,e[i],r,0,0,this.t+i-t);r.clamp(),r.drShiftTo(1,r)},lt.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var i=this.t-1;i>=0;--i)r=(t*r+this[i])%e;return r},lt.prototype.millerRabin=function(e){var t=this.subtract(lt.ONE),r=t.getLowestSetBit();if(r<=0)return!1;var i=t.shiftRight(r);(e=e+1>>1)>It.length&&(e=It.length);for(var s=dt(),n=0;n<e;++n){s.fromInt(It[Math.floor(Math.random()*It.length)]);var o=s.modPow(i,this);if(0!=o.compareTo(lt.ONE)&&0!=o.compareTo(t)){for(var a=1;a++<r&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(lt.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},lt.prototype.clone=function(){var e=dt();return this.copyTo(e),e},lt.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},lt.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},lt.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},lt.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},lt.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,i=this.DB-e*this.DB%8,s=0;if(e-- >0)for(i<this.DB&&(r=this[e]>>i)!=(this.s&this.DM)>>i&&(t[s++]=r|this.s<<this.DB-i);e>=0;)i<8?(r=(this[e]&(1<<i)-1)<<8-i,r|=this[--e]>>(i+=this.DB-8)):(r=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==s&&(128&this.s)!=(128&r)&&++s,(s>0||r!=this.s)&&(t[s++]=r);return t},lt.prototype.equals=function(e){return 0==this.compareTo(e)},lt.prototype.min=function(e){return this.compareTo(e)<0?this:e},lt.prototype.max=function(e){return this.compareTo(e)>0?this:e},lt.prototype.and=function(e){var t=dt();return this.bitwiseTo(e,wt,t),t},lt.prototype.or=function(e){var t=dt();return this.bitwiseTo(e,Et,t),t},lt.prototype.xor=function(e){var t=dt();return this.bitwiseTo(e,xt,t),t},lt.prototype.andNot=function(e){var t=dt();return this.bitwiseTo(e,kt,t),t},lt.prototype.not=function(){for(var e=dt(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},lt.prototype.shiftLeft=function(e){var t=dt();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},lt.prototype.shiftRight=function(e){var t=dt();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},lt.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+At(this[e]);return this.s<0?this.t*this.DB:-1},lt.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=Pt(this[r]^t);return e},lt.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},lt.prototype.setBit=function(e){return this.changeBit(e,Et)},lt.prototype.clearBit=function(e){return this.changeBit(e,kt)},lt.prototype.flipBit=function(e){return this.changeBit(e,xt)},lt.prototype.add=function(e){var t=dt();return this.addTo(e,t),t},lt.prototype.subtract=function(e){var t=dt();return this.subTo(e,t),t},lt.prototype.multiply=function(e){var t=dt();return this.multiplyTo(e,t),t},lt.prototype.divide=function(e){var t=dt();return this.divRemTo(e,t,null),t},lt.prototype.remainder=function(e){var t=dt();return this.divRemTo(e,null,t),t},lt.prototype.divideAndRemainder=function(e){var t=dt(),r=dt();return this.divRemTo(e,t,r),new Array(t,r)},lt.prototype.modPow=function(e,t){var r,i,s=e.bitLength(),n=_t(1);if(s<=0)return n;r=s<18?1:s<48?3:s<144?4:s<768?5:6,i=s<8?new St(t):t.isEven()?new Tt(t):new bt(t);var o=new Array,a=3,u=r-1,c=(1<<r)-1;if(o[1]=i.convert(this),r>1){var h=dt();for(i.sqrTo(o[1],h);a<=c;)o[a]=dt(),i.mulTo(h,o[a-2],o[a]),a+=2}var l,d,g=e.t-1,p=!0,f=dt();for(s=Ft(e[g])-1;g>=0;){for(s>=u?l=e[g]>>s-u&c:(l=(e[g]&(1<<s+1)-1)<<u-s,g>0&&(l|=e[g-1]>>this.DB+s-u)),a=r;0==(1&l);)l>>=1,--a;if((s-=a)<0&&(s+=this.DB,--g),p)o[l].copyTo(n),p=!1;else{for(;a>1;)i.sqrTo(n,f),i.sqrTo(f,n),a-=2;a>0?i.sqrTo(n,f):(d=n,n=f,f=d),i.mulTo(f,o[l],n)}for(;g>=0&&0==(e[g]&1<<s);)i.sqrTo(n,f),d=n,n=f,f=d,--s<0&&(s=this.DB-1,--g)}return i.revert(n)},lt.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return lt.ZERO;for(var r=e.clone(),i=this.clone(),s=_t(1),n=_t(0),o=_t(0),a=_t(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(s.isEven()&&n.isEven()||(s.addTo(this,s),n.subTo(e,n)),s.rShiftTo(1,s)):n.isEven()||n.subTo(e,n),n.rShiftTo(1,n);for(;i.isEven();)i.rShiftTo(1,i),t?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(e,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);r.compareTo(i)>=0?(r.subTo(i,r),t&&s.subTo(o,s),n.subTo(a,n)):(i.subTo(r,i),t&&o.subTo(s,o),a.subTo(n,a))}return 0!=i.compareTo(lt.ONE)?lt.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},lt.prototype.pow=function(e){return this.exp(e,new Ct)},lt.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var i=t;t=r,r=i}var s=t.getLowestSetBit(),n=r.getLowestSetBit();if(n<0)return t;for(s<n&&(n=s),n>0&&(t.rShiftTo(n,t),r.rShiftTo(n,r));t.signum()>0;)(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return n>0&&r.lShiftTo(n,r),r},lt.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=It[It.length-1]){for(t=0;t<It.length;++t)if(r[0]==It[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<It.length;){for(var i=It[t],s=t+1;s<It.length&&i<Dt;)i*=It[s++];for(i=r.modInt(i);t<s;)if(i%It[t++]==0)return!1}return r.millerRabin(e)},lt.prototype.square=function(){var e=dt();return this.squareTo(e),e},Nt.prototype.init=function(e){var t,r,i;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,i=this.S[t],this.S[t]=this.S[r],this.S[r]=i;this.i=0,this.j=0},Nt.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var Ht,Bt,Ut,jt=256;function Ot(){var e;e=(new Date).getTime(),Bt[Ut++]^=255&e,Bt[Ut++]^=e>>8&255,Bt[Ut++]^=e>>16&255,Bt[Ut++]^=e>>24&255,Ut>=jt&&(Ut-=jt)}if(null==Bt){var Mt;if(Bt=new Array,Ut=0,void 0!==et&&void 0!==et.msCrypto){var Vt=et.msCrypto;if(Vt.getRandomValues){var Kt=new Uint8Array(32);for(Vt.getRandomValues(Kt),Mt=0;Mt<32;++Mt)Bt[Ut++]=Kt[Mt]}}for(;Ut<jt;)Mt=Math.floor(65536*Math.random()),Bt[Ut++]=Mt>>>8,Bt[Ut++]=255&Mt;Ut=0,Ot()}function qt(){if(null==Ht){for(Ot(),(Ht=new Nt).init(Bt),Ut=0;Ut<Bt.length;++Ut)Bt[Ut]=0;Ut=0}return Ht.next()}function Lt(){}function $t(e,t){return new lt(e,t)}function Jt(e,t,r){for(var i="",s=0;i.length<t;)i+=r(String.fromCharCode.apply(String,e.concat([(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s]))),s+=1;return i}function Wt(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function zt(e,t){this.x=t,this.q=e}function Gt(e,t,r,i){this.curve=e,this.x=t,this.y=r,this.z=null==i?lt.ONE:i,this.zinv=null}function Yt(e,t,r){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(r),this.infinity=new Gt(this,null,null)}Lt.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=qt()},Wt.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},Wt.prototype.setPublic=function(e,t){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof e)this.n=e,this.e=t;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA public key";this.n=$t(e,16),this.e=parseInt(t,16)}},Wt.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var r=new Array,i=e.length-1;i>=0&&t>0;){var s=e.charCodeAt(i--);s<128?r[--t]=s:s>127&&s<2048?(r[--t]=63&s|128,r[--t]=s>>6|192):(r[--t]=63&s|128,r[--t]=s>>6&63|128,r[--t]=s>>12|224)}r[--t]=0;for(var n=new Lt,o=new Array;t>2;){for(o[0]=0;0==o[0];)n.nextBytes(o);r[--t]=o[0]}return r[--t]=2,r[--t]=0,new lt(r)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var r=this.doPublic(t);if(null==r)return null;var i=r.toString(16);return 0==(1&i.length)?i:"0"+i},Wt.prototype.encryptOAEP=function(e,t,r){var i=function(e,t,r,i){var s=Xt.crypto.MessageDigest,n=Xt.crypto.Util,o=null;if(r||(r="sha1"),"string"==typeof r&&(o=s.getCanonicalAlgName(r),i=s.getHashLength(o),r=function(e){return hr(n.hashHex(lr(e),o))}),e.length+2*i+2>t)throw"Message too long for RSA";var a,u="";for(a=0;a<t-e.length-2*i-2;a+=1)u+="\0";var c=r("")+u+""+e,h=new Array(i);(new Lt).nextBytes(h);var l=Jt(h,c.length,r),d=[];for(a=0;a<c.length;a+=1)d[a]=c.charCodeAt(a)^l.charCodeAt(a);var g=Jt(d,h.length,r),p=[0];for(a=0;a<h.length;a+=1)p[a+1]=h[a]^g.charCodeAt(a);return new lt(p.concat(d))}(e,this.n.bitLength()+7>>3,t,r);if(null==i)return null;var s=this.doPublic(i);if(null==s)return null;var n=s.toString(16);return 0==(1&n.length)?n:"0"+n},Wt.prototype.type="RSA",zt.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},zt.prototype.toBigInteger=function(){return this.x},zt.prototype.negate=function(){return new zt(this.q,this.x.negate().mod(this.q))},zt.prototype.add=function(e){return new zt(this.q,this.x.add(e.toBigInteger()).mod(this.q))},zt.prototype.subtract=function(e){return new zt(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},zt.prototype.multiply=function(e){return new zt(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},zt.prototype.square=function(){return new zt(this.q,this.x.square().mod(this.q))},zt.prototype.divide=function(e){return new zt(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},Gt.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Gt.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Gt.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(lt.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(lt.ZERO))},Gt.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(lt.ZERO)&&!this.y.toBigInteger().equals(lt.ZERO)},Gt.prototype.negate=function(){return new Gt(this.curve,this.x,this.y.negate(),this.z)},Gt.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),r=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(lt.ZERO.equals(r))return lt.ZERO.equals(t)?this.twice():this.curve.getInfinity();var i=new lt("3"),s=this.x.toBigInteger(),n=this.y.toBigInteger(),o=(e.x.toBigInteger(),e.y.toBigInteger(),r.square()),a=o.multiply(r),u=s.multiply(o),c=t.square().multiply(this.z),h=c.subtract(u.shiftLeft(1)).multiply(e.z).subtract(a).multiply(r).mod(this.curve.q),l=u.multiply(i).multiply(t).subtract(n.multiply(a)).subtract(c.multiply(t)).multiply(e.z).add(t.multiply(a)).mod(this.curve.q),d=a.multiply(this.z).multiply(e.z).mod(this.curve.q);return new Gt(this.curve,this.curve.fromBigInteger(h),this.curve.fromBigInteger(l),d)},Gt.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new lt("3"),t=this.x.toBigInteger(),r=this.y.toBigInteger(),i=r.multiply(this.z),s=i.multiply(r).mod(this.curve.q),n=this.curve.a.toBigInteger(),o=t.square().multiply(e);lt.ZERO.equals(n)||(o=o.add(this.z.square().multiply(n)));var a=(o=o.mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(s)).shiftLeft(1).multiply(i).mod(this.curve.q),u=o.multiply(e).multiply(t).subtract(s.shiftLeft(1)).shiftLeft(2).multiply(s).subtract(o.square().multiply(o)).mod(this.curve.q),c=i.square().multiply(i).shiftLeft(3).mod(this.curve.q);return new Gt(this.curve,this.curve.fromBigInteger(a),this.curve.fromBigInteger(u),c)},Gt.prototype.multiply=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,r=e,i=r.multiply(new lt("3")),s=this.negate(),n=this;for(t=i.bitLength()-2;t>0;--t){n=n.twice();var o=i.testBit(t);o!=r.testBit(t)&&(n=n.add(o?this:s))}return n},Gt.prototype.multiplyTwo=function(e,t,r){var i;i=e.bitLength()>r.bitLength()?e.bitLength()-1:r.bitLength()-1;for(var s=this.curve.getInfinity(),n=this.add(t);i>=0;)s=s.twice(),e.testBit(i)?s=r.testBit(i)?s.add(n):s.add(this):r.testBit(i)&&(s=s.add(t)),--i;return s},Yt.prototype.getQ=function(){return this.q},Yt.prototype.getA=function(){return this.a},Yt.prototype.getB=function(){return this.b},Yt.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},Yt.prototype.getInfinity=function(){return this.infinity},Yt.prototype.fromBigInteger=function(e){return new zt(this.q,e)},Yt.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var t=(e.length-2)/2,r=e.substr(2,t),i=e.substr(t+2,t);return new Gt(this,this.fromBigInteger(new lt(r,16)),this.fromBigInteger(new lt(i,16)));default:return null}},zt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Gt.prototype.getEncoded=function(e){var t=function(e,t){var r=e.toByteArrayUnsigned();if(t<r.length)r=r.slice(r.length-t);else for(;t>r.length;)r.unshift(0);return r},r=this.getX().toBigInteger(),i=this.getY().toBigInteger(),s=t(r,32);return e?i.isEven()?s.unshift(2):s.unshift(3):(s.unshift(4),s=s.concat(t(i,32))),s},Gt.decodeFrom=function(e,t){t[0];var r=t.length-1,i=t.slice(1,1+r/2),s=t.slice(1+r/2,1+r);i.unshift(0),s.unshift(0);var n=new lt(i),o=new lt(s);return new Gt(e,e.fromBigInteger(n),e.fromBigInteger(o))},Gt.decodeFromHex=function(e,t){t.substr(0,2);var r=t.length-2,i=t.substr(2,r/2),s=t.substr(2+r/2,r/2),n=new lt(i,16),o=new lt(s,16);return new Gt(e,e.fromBigInteger(n),e.fromBigInteger(o))},Gt.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),r=e.y.subtract(this.y).divide(t),i=r.square().subtract(this.x).subtract(e.x),s=r.multiply(this.x.subtract(i)).subtract(this.y);return new Gt(this.curve,i,s)},Gt.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(lt.valueOf(2)),t=this.curve.fromBigInteger(lt.valueOf(3)),r=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),i=r.square().subtract(this.x.multiply(e)),s=r.multiply(this.x.subtract(i)).subtract(this.y);return new Gt(this.curve,i,s)},Gt.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,r=e,i=r.multiply(new lt("3")),s=this.negate(),n=this;for(t=i.bitLength()-2;t>0;--t){n=n.twice();var o=i.testBit(t);o!=r.testBit(t)&&(n=n.add2D(o?this:s))}return n},Gt.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),i=this.curve.getB().toBigInteger(),s=this.curve.getQ(),n=t.multiply(t).mod(s),o=e.multiply(e).multiply(e).add(r.multiply(e)).add(i).mod(s);return n.equals(o)},Gt.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Gt.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(t.compareTo(lt.ONE)<0||t.compareTo(e.subtract(lt.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(lt.ONE)<0||r.compareTo(e.subtract(lt.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var Qt=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function i(e,t,i){return t?r[t]:String.fromCharCode(parseInt(i,16))}var s=new String(""),n=Object.hasOwnProperty;return function(r,o){var a,u,c=r.match(e),h=c[0],l=!1;"{"===h?a={}:"["===h?a=[]:(a=[],l=!0);for(var d=[a],g=1-l,p=c.length;g<p;++g){var f;switch((h=c[g]).charCodeAt(0)){default:(f=d[0])[u||f.length]=+h,u=void 0;break;case 34:if(-1!==(h=h.substring(1,h.length-1)).indexOf("\\")&&(h=h.replace(t,i)),f=d[0],!u){if(!(f instanceof Array)){u=h||s;break}u=f.length}f[u]=h,u=void 0;break;case 91:f=d[0],d.unshift(f[u||f.length]=[]),u=void 0;break;case 93:d.shift();break;case 102:(f=d[0])[u||f.length]=!1,u=void 0;break;case 110:(f=d[0])[u||f.length]=null,u=void 0;break;case 116:(f=d[0])[u||f.length]=!0,u=void 0;break;case 123:f=d[0],d.unshift(f[u||f.length]={}),u=void 0;break;case 125:d.shift()}}if(l){if(1!==d.length)throw new Error;a=a[0]}else if(d.length)throw new Error;if(o){var v=function(e,t){var r=e[t];if(r&&"object"==typeof r){var i=null;for(var s in r)if(n.call(r,s)&&r!==e){var a=v(r,s);void 0!==a?r[s]=a:(i||(i=[]),i.push(s))}if(i)for(var u=i.length;--u>=0;)delete r[i[u]]}return o.call(e,t,r)};a=v({"":a},"")}return a}}();void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.asn1&&Xt.asn1||(Xt.asn1={}),Xt.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var i="",s=0;s<r;s++)i+="f";t=new lt(i,16).xor(e).add(lt.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return gr(e,t)},this.newObject=function(e){var t=Xt.asn1,r=t.DERBoolean,i=t.DERInteger,s=t.DERBitString,n=t.DEROctetString,o=t.DERNull,a=t.DERObjectIdentifier,u=t.DEREnumerated,c=t.DERUTF8String,h=t.DERNumericString,l=t.DERPrintableString,d=t.DERTeletexString,g=t.DERIA5String,p=t.DERUTCTime,f=t.DERGeneralizedTime,v=t.DERSequence,m=t.DERSet,y=t.DERTaggedObject,_=t.ASN1Util.newObject,F=Object.keys(e);if(1!=F.length)throw"key of param shall be only one.";var S=F[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+S+":"))throw"undefined key: "+S;if("bool"==S)return new r(e[S]);if("int"==S)return new i(e[S]);if("bitstr"==S)return new s(e[S]);if("octstr"==S)return new n(e[S]);if("null"==S)return new o(e[S]);if("oid"==S)return new a(e[S]);if("enum"==S)return new u(e[S]);if("utf8str"==S)return new c(e[S]);if("numstr"==S)return new h(e[S]);if("prnstr"==S)return new l(e[S]);if("telstr"==S)return new d(e[S]);if("ia5str"==S)return new g(e[S]);if("utctime"==S)return new p(e[S]);if("gentime"==S)return new f(e[S]);if("seq"==S){for(var b=e[S],w=[],E=0;E<b.length;E++){var x=_(b[E]);w.push(x)}return new v({array:w})}if("set"==S){for(b=e[S],w=[],E=0;E<b.length;E++){x=_(b[E]);w.push(x)}return new m({array:w})}if("tag"==S){var k=e[S];if("[object Array]"===Object.prototype.toString.call(k)&&3==k.length){var A=_(k[2]);return new y({tag:k[0],explicit:k[1],obj:A})}var P={};if(void 0!==k.explicit&&(P.explicit=k.explicit),void 0!==k.tag&&(P.tag=k.tag),void 0===k.obj)throw"obj shall be specified for 'tag'.";return P.obj=_(k.obj),new y(P)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},Xt.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",r=parseInt(e.substr(0,2),16),i=(t=Math.floor(r/40)+"."+r%40,""),s=2;s<e.length;s+=2){var n=("00000000"+parseInt(e.substr(s,2),16).toString(2)).slice(-8);if(i+=n.substr(1,7),"0"==n.substr(0,1))t=t+"."+new lt(i,2).toString(10),i=""}return t},Xt.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",i=new lt(e,10).toString(2),s=7-i.length%7;7==s&&(s=0);for(var n="",o=0;o<s;o++)n+="0";i=n+i;for(o=0;o<i.length-1;o+=7){var a=i.substr(o,7);o!=i.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var i="",s=e.split("."),n=40*parseInt(s[0])+parseInt(s[1]);i+=t(n),s.splice(0,2);for(var o=0;o<s.length;o++)i+=r(s[o]);return i},Xt.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var r=t.length/2;if(r>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+r).toString(16)+t},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},Xt.asn1.DERAbstractString=function(e){Xt.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=ur(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},tt.lang.extend(Xt.asn1.DERAbstractString,Xt.asn1.ASN1Object),Xt.asn1.DERAbstractTime=function(e){Xt.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){return utc=e.getTime()+6e4*e.getTimezoneOffset(),new Date(utc)},this.formatDate=function(e,t,r){var i=this.zeroPadding,s=this.localDateToUTC(e),n=String(s.getFullYear());"utc"==t&&(n=n.substr(2,2));var o=n+i(String(s.getMonth()+1),2)+i(String(s.getDate()),2)+i(String(s.getHours()),2)+i(String(s.getMinutes()),2)+i(String(s.getSeconds()),2);if(!0===r){var a=s.getMilliseconds();if(0!=a){var u=i(String(a),3);o=o+"."+(u=u.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=ir(e)},this.setByDateValue=function(e,t,r,i,s,n){var o=new Date(Date.UTC(e,t-1,r,i,s,n,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},tt.lang.extend(Xt.asn1.DERAbstractTime,Xt.asn1.ASN1Object),Xt.asn1.DERAbstractStructured=function(e){Xt.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},tt.lang.extend(Xt.asn1.DERAbstractStructured,Xt.asn1.ASN1Object),Xt.asn1.DERBoolean=function(){Xt.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},tt.lang.extend(Xt.asn1.DERBoolean,Xt.asn1.ASN1Object),Xt.asn1.DERInteger=function(e){Xt.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=Xt.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new lt(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.bigint?this.setByBigInteger(e.bigint):void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},tt.lang.extend(Xt.asn1.DERInteger,Xt.asn1.ASN1Object),Xt.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=Xt.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}Xt.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var r="0"+e;this.hTLV=null,this.isModified=!0,this.hV=r+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0);for(var r=0;r<=t;r++)e+="0";var i="";for(r=0;r<e.length-1;r+=8){var s=e.substr(r,8),n=parseInt(s,2).toString(16);1==n.length&&(n="0"+n),i+=n}this.hTLV=null,this.isModified=!0,this.hV="0"+t+i},this.setByBooleanArray=function(e){for(var t="",r=0;r<e.length;r++)1==e[r]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},tt.lang.extend(Xt.asn1.DERBitString,Xt.asn1.ASN1Object),Xt.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=Xt.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}Xt.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},tt.lang.extend(Xt.asn1.DEROctetString,Xt.asn1.DERAbstractString),Xt.asn1.DERNull=function(){Xt.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},tt.lang.extend(Xt.asn1.DERNull,Xt.asn1.ASN1Object),Xt.asn1.DERObjectIdentifier=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",i=new lt(e,10).toString(2),s=7-i.length%7;7==s&&(s=0);for(var n="",o=0;o<s;o++)n+="0";i=n+i;for(o=0;o<i.length-1;o+=7){var a=i.substr(o,7);o!=i.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};Xt.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var i="",s=e.split("."),n=40*parseInt(s[0])+parseInt(s[1]);i+=t(n),s.splice(0,2);for(var o=0;o<s.length;o++)i+=r(s[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueName=function(e){var t=Xt.asn1.x509.OID.name2oid(e);if(""===t)throw"DERObjectIdentifier oidName undefined: "+e;this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e):void 0!==e.oid?this.setValueOidString(e.oid):void 0!==e.hex?this.setValueHex(e.hex):void 0!==e.name&&this.setValueName(e.name))},tt.lang.extend(Xt.asn1.DERObjectIdentifier,Xt.asn1.ASN1Object),Xt.asn1.DEREnumerated=function(e){Xt.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=Xt.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new lt(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},tt.lang.extend(Xt.asn1.DEREnumerated,Xt.asn1.ASN1Object),Xt.asn1.DERUTF8String=function(e){Xt.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},tt.lang.extend(Xt.asn1.DERUTF8String,Xt.asn1.DERAbstractString),Xt.asn1.DERNumericString=function(e){Xt.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},tt.lang.extend(Xt.asn1.DERNumericString,Xt.asn1.DERAbstractString),Xt.asn1.DERPrintableString=function(e){Xt.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},tt.lang.extend(Xt.asn1.DERPrintableString,Xt.asn1.DERAbstractString),Xt.asn1.DERTeletexString=function(e){Xt.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},tt.lang.extend(Xt.asn1.DERTeletexString,Xt.asn1.DERAbstractString),Xt.asn1.DERIA5String=function(e){Xt.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},tt.lang.extend(Xt.asn1.DERIA5String,Xt.asn1.DERAbstractString),Xt.asn1.DERUTCTime=function(e){Xt.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=ir(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=ir(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{12}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},tt.lang.extend(Xt.asn1.DERUTCTime,Xt.asn1.DERAbstractTime),Xt.asn1.DERGeneralizedTime=function(e){Xt.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ir(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=ir(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{14}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date),!0===e.millis&&(this.withMillis=!0))},tt.lang.extend(Xt.asn1.DERGeneralizedTime,Xt.asn1.DERAbstractTime),Xt.asn1.DERSequence=function(e){Xt.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].getEncodedHex()}return this.hV=e,this.hV}},tt.lang.extend(Xt.asn1.DERSequence,Xt.asn1.DERAbstractStructured),Xt.asn1.DERSet=function(e){Xt.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var r=this.asn1Array[t];e.push(r.getEncodedHex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},tt.lang.extend(Xt.asn1.DERSet,Xt.asn1.DERAbstractStructured),Xt.asn1.DERTaggedObject=function(e){Xt.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,r){this.hT=t,this.isExplicit=e,this.asn1Object=r,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=r.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.tag&&(this.hT=e.tag),void 0!==e.explicit&&(this.isExplicit=e.explicit),void 0!==e.obj&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},tt.lang.extend(Xt.asn1.DERTaggedObject,Xt.asn1.ASN1Object);var Xt,Zt,er,tr=new function(){};function rr(e){for(var t="",r=0;r<e.length;r++){var i=e[r].toString(16);1==i.length&&(i="0"+i),t+=i}return t}function ir(e){return rr(function(e){for(var t=new Array,r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e))}function sr(e){return e=(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function nr(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function or(e){return e.length%2==1&&(e="0"+e),sr(ct(e))}function ar(e){return ht(nr(e))}function ur(e){return vr(_r(e))}function cr(e){return decodeURIComponent(mr(e))}function hr(e){for(var t="",r=0;r<e.length-1;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}function lr(e){for(var t="",r=0;r<e.length;r++)t+=("0"+e.charCodeAt(r).toString(16)).slice(-2);return t}function dr(e){var t=function(e){return ct(e)}(e).replace(/(.{64})/g,"$1\r\n");return t=t.replace(/\r\n$/,"")}function gr(e,t){return"-----BEGIN "+t+"-----\r\n"+dr(e)+"\r\n-----END "+t+"-----\r\n"}function pr(e,t){if(-1==e.indexOf("-----BEGIN "))throw"can't find PEM header: "+t;return function(e){return ht(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}(e=void 0!==t?(e=e.replace("-----BEGIN "+t+"-----","")).replace("-----END "+t+"-----",""):(e=e.replace(/-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----/,""))}function fr(e){return~~(function(e){var t,r,i,s,n,o,a,u,c,h,l;if(l=e.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return u=l[1],t=parseInt(u),2===u.length&&(50<=t&&t<100?t=1900+t:0<=t&&t<50&&(t=2e3+t)),r=parseInt(l[2])-1,i=parseInt(l[3]),s=parseInt(l[4]),n=parseInt(l[5]),o=parseInt(l[6]),a=0,""!==(c=l[7])&&(h=(c.substr(1)+"00").substr(0,3),a=parseInt(h)),Date.UTC(t,r,i,s,n,o,a);throw"unsupported zulu format: "+e}(e)/1e3)}function vr(e){return e.replace(/%/g,"")}function mr(e){return e.replace(/(..)/g,"%$1")}function yr(e){var t="malformed hex value";if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(8!=e.length)return 32==e.length?function(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var t=(e=e.toLowerCase()).match(/.{1,4}/g),r=0;r<8;r++)t[r]=t[r].replace(/^0+/,""),""==t[r]&&(t[r]="0");var i=(e=":"+t.join(":")+":").match(/:(0:){2,}/g);if(null===i)return e.slice(1,-1);var s="";for(r=0;r<i.length;r++)i[r].length>s.length&&(s=i[r]);return(e=e.replace(s,"::")).slice(1,-1)}(e):e;try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch(e){throw t}}function _r(e){for(var t=encodeURIComponent(e),r="",i=0;i<t.length;i++)"%"==t[i]?(r+=t.substr(i,3),i+=2):r=r+"%"+ir(t[i]);return r}function Fr(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}tr.getLblen=function(e,t){if("8"!=e.substr(t+2,1))return 1;var r=parseInt(e.substr(t+3,1));return 0==r?-1:0<r&&r<10?r+1:-2},tr.getL=function(e,t){var r=tr.getLblen(e,t);return r<1?"":e.substr(t+2,2*r)},tr.getVblen=function(e,t){var r;return""==(r=tr.getL(e,t))?-1:("8"===r.substr(0,1)?new lt(r.substr(2),16):new lt(r,16)).intValue()},tr.getVidx=function(e,t){var r=tr.getLblen(e,t);return r<0?r:t+2*(r+1)},tr.getV=function(e,t){var r=tr.getVidx(e,t),i=tr.getVblen(e,t);return e.substr(r,2*i)},tr.getTLV=function(e,t){return e.substr(t,2)+tr.getL(e,t)+tr.getV(e,t)},tr.getNextSiblingIdx=function(e,t){return tr.getVidx(e,t)+2*tr.getVblen(e,t)},tr.getChildIdx=function(e,t){var r=tr,i=new Array,s=r.getVidx(e,t);"03"==e.substr(t,2)?i.push(s+2):i.push(s);for(var n=r.getVblen(e,t),o=s,a=0;;){var u=r.getNextSiblingIdx(e,o);if(null==u||u-s>=2*n)break;if(a>=200)break;i.push(u),o=u,a++}return i},tr.getNthChildIdx=function(e,t,r){return tr.getChildIdx(e,t)[r]},tr.getIdxbyList=function(e,t,r,i){var s,n,o=tr;if(0==r.length){if(void 0!==i&&e.substr(t,2)!==i)throw"checking tag doesn't match: "+e.substr(t,2)+"!="+i;return t}return s=r.shift(),n=o.getChildIdx(e,t),o.getIdxbyList(e,n[s],r,i)},tr.getTLVbyList=function(e,t,r,i){var s=tr,n=s.getIdxbyList(e,t,r);if(void 0===n)throw"can't find nthList object";if(void 0!==i&&e.substr(n,2)!=i)throw"checking tag doesn't match: "+e.substr(n,2)+"!="+i;return s.getTLV(e,n)},tr.getVbyList=function(e,t,r,i,s){var n,o,a=tr;if(void 0===(n=a.getIdxbyList(e,t,r,i)))throw"can't find nthList object";return o=a.getV(e,n),!0===s&&(o=o.substr(2)),o},tr.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},r=[],i=e.substr(0,2),s=parseInt(i,16);r[0]=new String(Math.floor(s/40)),r[1]=new String(s%40);for(var n=e.substr(2),o=[],a=0;a<n.length/2;a++)o.push(parseInt(n.substr(2*a,2),16));var u=[],c="";for(a=0;a<o.length;a++)128&o[a]?c+=t((127&o[a]).toString(2),7):(c+=t((127&o[a]).toString(2),7),u.push(new String(parseInt(c,2))),c="");var h=r.join(".");return u.length>0&&(h=h+"."+u.join(".")),h},tr.dump=function(e,t,r,i){var s=tr,n=s.getV,o=s.dump,a=s.getChildIdx,u=e;e instanceof Xt.asn1.ASN1Object&&(u=e.getEncodedHex());var c=function(e,t){return e.length<=2*t?e:e.substr(0,t)+"..(total "+e.length/2+"bytes).."+e.substr(e.length-t,t)};void 0===t&&(t={ommit_long_octet:32}),void 0===r&&(r=0),void 0===i&&(i="");var h=t.ommit_long_octet;if("01"==u.substr(r,2))return"00"==(l=n(u,r))?i+"BOOLEAN FALSE\n":i+"BOOLEAN TRUE\n";if("02"==u.substr(r,2))return i+"INTEGER "+c(l=n(u,r),h)+"\n";if("03"==u.substr(r,2))return i+"BITSTRING "+c(l=n(u,r),h)+"\n";if("04"==u.substr(r,2)){var l=n(u,r);if(s.isASN1HEX(l)){var d=i+"OCTETSTRING, encapsulates\n";return d+=o(l,t,0,i+"  ")}return i+"OCTETSTRING "+c(l,h)+"\n"}if("05"==u.substr(r,2))return i+"NULL\n";if("06"==u.substr(r,2)){var g=n(u,r),p=Xt.asn1.ASN1Util.oidHexToInt(g),f=Xt.asn1.x509.OID.oid2name(p),v=p.replace(/\./g," ");return""!=f?i+"ObjectIdentifier "+f+" ("+v+")\n":i+"ObjectIdentifier ("+v+")\n"}if("0c"==u.substr(r,2))return i+"UTF8String '"+cr(n(u,r))+"'\n";if("13"==u.substr(r,2))return i+"PrintableString '"+cr(n(u,r))+"'\n";if("14"==u.substr(r,2))return i+"TeletexString '"+cr(n(u,r))+"'\n";if("16"==u.substr(r,2))return i+"IA5String '"+cr(n(u,r))+"'\n";if("17"==u.substr(r,2))return i+"UTCTime "+cr(n(u,r))+"\n";if("18"==u.substr(r,2))return i+"GeneralizedTime "+cr(n(u,r))+"\n";if("30"==u.substr(r,2)){if("3000"==u.substr(r,4))return i+"SEQUENCE {}\n";d=i+"SEQUENCE\n";var m=t;if((2==(F=a(u,r)).length||3==F.length)&&"06"==u.substr(F[0],2)&&"04"==u.substr(F[F.length-1],2)){f=s.oidname(n(u,F[0]));var y=JSON.parse(JSON.stringify(t));y.x509ExtName=f,m=y}for(var _=0;_<F.length;_++)d+=o(u,m,F[_],i+"  ");return d}if("31"==u.substr(r,2)){d=i+"SET\n";var F=a(u,r);for(_=0;_<F.length;_++)d+=o(u,t,F[_],i+"  ");return d}var S=parseInt(u.substr(r,2),16);if(0!=(128&S)){var b=31&S;if(0!=(32&S)){var d=i+"["+b+"]\n";for(F=a(u,r),_=0;_<F.length;_++)d+=o(u,t,F[_],i+"  ");return d}return"68747470"==(l=n(u,r)).substr(0,8)&&(l=cr(l)),"subjectAltName"===t.x509ExtName&&2==b&&(l=cr(l)),d=i+"["+b+"] "+l+"\n"}return i+"UNKNOWN("+u.substr(r,2)+") "+n(u,r)+"\n"},tr.isASN1HEX=function(e){var t=tr;if(e.length%2==1)return!1;var r=t.getVblen(e,0),i=e.substr(0,2),s=t.getL(e,0);return e.length-i.length-s.length==2*r},tr.oidname=function(e){var t=Xt.asn1;Xt.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var r=t.x509.OID.oid2name(e);return""===r&&(r=e),r},void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.lang&&Xt.lang||(Xt.lang={}),Xt.lang.String=function(){},"function"==typeof Buffer?(Zt=function(e){return sr(new Buffer(e,"utf8").toString("base64"))},er=function(e){return new Buffer(nr(e),"base64").toString("utf8")}):(Zt=function(e){return or(vr(_r(e)))},er=function(e){return decodeURIComponent(mr(ar(e)))}),Xt.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},Xt.lang.String.isHex=function(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))},Xt.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},Xt.lang.String.isBase64URL=function(e){return!e.match(/[+\/=]/)&&(e=nr(e),Xt.lang.String.isBase64(e))},Xt.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.crypto&&Xt.crypto||(Xt.crypto={}),Xt.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:ot.algo.MD5,sha1:ot.algo.SHA1,sha224:ot.algo.SHA224,sha256:ot.algo.SHA256,sha384:ot.algo.SHA384,sha512:ot.algo.SHA512,ripemd160:ot.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(void 0===this.DIGESTINFOHEAD[t])throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,r){var i=this.getDigestInfoHex(e,t),s=r/4;if(i.length+22>s)throw"key is too short for SigAlg: keylen="+r+","+t;for(var n="0001",o="00"+i,a="",u=s-n.length-o.length,c=0;c<u;c+=2)a+="ff";return n+a+o},this.hashString=function(e,t){return new Xt.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new Xt.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return new Xt.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"}).digestString(e)},this.sha256=function(e){return new Xt.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestString(e)},this.sha256Hex=function(e){return new Xt.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestHex(e)},this.sha512=function(e){return new Xt.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestString(e)},this.sha512Hex=function(e){return new Xt.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestHex(e)}},Xt.crypto.Util.md5=function(e){return new Xt.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},Xt.crypto.Util.ripemd160=function(e){return new Xt.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},Xt.crypto.Util.SECURERANDOMGEN=new Lt,Xt.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return Xt.crypto.Util.SECURERANDOMGEN.nextBytes(t),rr(t)},Xt.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new lt(Xt.crypto.Util.getRandomHexOfNbytes(e),16)},Xt.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,r=new Array((e-t)/8+1);return Xt.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<t&255^255)&r[0],rr(r)},Xt.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new lt(Xt.crypto.Util.getRandomHexOfNbits(e),16)},Xt.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var r=Xt.crypto.Util.getRandomBigIntegerOfNbits(t);if(-1!=e.compareTo(r))return r}},Xt.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var r=e.compareTo(t);if(1==r)throw"biMin is greater than biMax";if(0==r)return e;var i=t.subtract(e);return Xt.crypto.Util.getRandomBigIntegerZeroToMax(i).add(e)},Xt.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(e,t){if(null!==(e=Xt.crypto.MessageDigest.getCanonicalAlgName(e))&&void 0===t&&(t=Xt.crypto.Util.DEFAULTPROVIDER[e]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)&&"cryptojs"==t){try{this.md=Xt.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=ot.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(ot.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(-1!=":sha256:".indexOf(e)&&"sjcl"==t){try{this.md=new sjcl.hash.sha256}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=Xt.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},Xt.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"==typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},Xt.crypto.MessageDigest.getHashLength=function(e){var t=Xt.crypto.MessageDigest,r=t.getCanonicalAlgName(e);if(void 0===t.HASHLENGTH[r])throw"not supported algorithm: "+e;return t.HASHLENGTH[r]},Xt.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},Xt.crypto.Mac=function(e){this.setAlgAndProvider=function(e,t){if(null==(e=e.toLowerCase())&&(e="hmacsha1"),"hmac"!=(e=e.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+e;void 0===t&&(t=Xt.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+t;var r=e.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(r)&&"cryptojs"==t){try{var i=Xt.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[r];this.mac=ot.algo.HMAC.create(i,this.pass)}catch(e){throw"setAlgAndProvider hash alg set fail hashAlg="+r+"/"+e}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=ot.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(ot.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if("string"==typeof e){var t=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(t=lr(e)),void(this.pass=ot.enc.Hex.parse(t))}if("object"!=typeof e)throw"KJUR.crypto.Mac unsupported password type: "+e;t=null;if(void 0!==e.hex){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;t=e.hex}if(void 0!==e.utf8&&(t=ur(e.utf8)),void 0!==e.rstr&&(t=lr(e.rstr)),void 0!==e.b64&&(t=ht(e.b64)),void 0!==e.b64u&&(t=ar(e.b64u)),null==t)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=ot.enc.Hex.parse(t)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=Xt.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},Xt.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var e=this.algName.match(/^(.+)with(.+)$/);e&&(this.mdAlgName=e[1].toLowerCase(),this.pubkeyAlgName=e[2].toLowerCase())},this._zeroPaddingOfSignature=function(e,t){for(var r="",i=t/4-e.length,s=0;s<i;s++)r+="0";return r+e},this.setAlgAndProvider=function(e,t){if(this._setAlgNames(),"cryptojs/jsrsa"!=t)throw"provider not supported: "+t;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new Xt.crypto.MessageDigest({alg:this.mdAlgName})}catch(e){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+e}this.init=function(e,t){var r=null;try{r=void 0===t?Sr.getKey(e):Sr.getKey(e,t)}catch(e){throw"init failed:"+e}if(!0===r.isPrivate)this.prvKey=r,this.state="SIGN";else{if(!0!==r.isPublic)throw"init failed.:"+r;this.pubKey=r,this.state="VERIFY"}},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0!==this.ecprvhex&&void 0!==this.eccurvename){var e=new Xt.crypto.ECDSA({curve:this.eccurvename});this.hSign=e.signHex(this.sHashHex,this.ecprvhex)}else if(this.prvKey instanceof Wt&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Wt&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof Xt.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof Xt.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){if(this.sHashHex=this.md.digest(),void 0!==this.ecpubhex&&void 0!==this.eccurvename)return new Xt.crypto.ECDSA({curve:this.eccurvename}).verifyHex(this.sHashHex,e,this.ecpubhex);if(this.pubKey instanceof Wt&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Wt&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==Xt.crypto.ECDSA&&this.pubKey instanceof Xt.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==Xt.crypto.DSA&&this.pubKey instanceof Xt.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov?this.provName=Xt.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{t=Sr.getKey(e.prvkeypem);this.init(t)}catch(e){throw"fatal error to load pem private key: "+e}}},Xt.crypto.Cipher=function(e){},Xt.crypto.Cipher.encrypt=function(e,t,r){if(t instanceof Wt&&t.isPublic){var i=Xt.crypto.Cipher.getAlgByKeyAndName(t,r);if("RSA"===i)return t.encrypt(e);if("RSAOAEP"===i)return t.encryptOAEP(e,"sha1");var s=i.match(/^RSAOAEP(\d+)$/);if(null!==s)return t.encryptOAEP(e,"sha"+s[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},Xt.crypto.Cipher.decrypt=function(e,t,r){if(t instanceof Wt&&t.isPrivate){var i=Xt.crypto.Cipher.getAlgByKeyAndName(t,r);if("RSA"===i)return t.decrypt(e);if("RSAOAEP"===i)return t.decryptOAEP(e,"sha1");var s=i.match(/^RSAOAEP(\d+)$/);if(null!==s)return t.decryptOAEP(e,"sha"+s[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},Xt.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof Wt){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t))return t;if(null==t)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},Xt.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.crypto&&Xt.crypto||(Xt.crypto={}),Xt.crypto.ECDSA=function(e){var t=new Lt;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(e){return new lt(e.bitLength(),t).mod(e.subtract(lt.ONE)).add(lt.ONE)},this.setNamedCurve=function(e){this.ecparams=Xt.crypto.ECParameterDB.getByName(e),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=e},this.setPrivateKeyHex=function(e){this.isPrivate=!0,this.prvKeyHex=e},this.setPublicKeyHex=function(e){this.isPublic=!0,this.pubKeyHex=e},this.getPublicKeyXYHex=function(){var e=this.pubKeyHex;if("04"!==e.substr(0,2))throw"this method supports uncompressed format(04) only";var t=this.ecparams.keylen/4;if(e.length!==2+2*t)throw"malformed public key hex length";var r={};return r.x=e.substr(2,t),r.y=e.substr(2+t),r},this.getShortNISTPCurveName=function(){var e=this.curveName;return"secp256r1"===e||"NIST P-256"===e||"P-256"===e||"prime256v1"===e?"P-256":"secp384r1"===e||"NIST P-384"===e||"P-384"===e?"P-384":null},this.generateKeyPairHex=function(){var e=this.ecparams.n,t=this.getBigRandom(e),r=this.ecparams.G.multiply(t),i=r.getX().toBigInteger(),s=r.getY().toBigInteger(),n=this.ecparams.keylen/4,o=("0000000000"+t.toString(16)).slice(-n),a="04"+("0000000000"+i.toString(16)).slice(-n)+("0000000000"+s.toString(16)).slice(-n);return this.setPrivateKeyHex(o),this.setPublicKeyHex(a),{ecprvhex:o,ecpubhex:a}},this.signWithMessageHash=function(e){return this.signHex(e,this.prvKeyHex)},this.signHex=function(e,t){var r=new lt(t,16),i=this.ecparams.n,s=new lt(e,16);do{var n=this.getBigRandom(i),o=this.ecparams.G.multiply(n).getX().toBigInteger().mod(i)}while(o.compareTo(lt.ZERO)<=0);var a=n.modInverse(i).multiply(s.add(r.multiply(o))).mod(i);return Xt.crypto.ECDSA.biRSSigToASN1Sig(o,a)},this.sign=function(e,t){var r=t,i=this.ecparams.n,s=lt.fromByteArrayUnsigned(e);do{var n=this.getBigRandom(i),o=this.ecparams.G.multiply(n).getX().toBigInteger().mod(i)}while(o.compareTo(lt.ZERO)<=0);var a=n.modInverse(i).multiply(s.add(r.multiply(o))).mod(i);return this.serializeSig(o,a)},this.verifyWithMessageHash=function(e,t){return this.verifyHex(e,t,this.pubKeyHex)},this.verifyHex=function(e,t,r){var i,s,n,o=Xt.crypto.ECDSA.parseSigHex(t);i=o.r,s=o.s,n=Gt.decodeFromHex(this.ecparams.curve,r);var a=new lt(e,16);return this.verifyRaw(a,i,s,n)},this.verify=function(e,t,r){var i,s,n;if(Bitcoin.Util.isArray(t)){var o=this.parseSig(t);i=o.r,s=o.s}else{if("object"!=typeof t||!t.r||!t.s)throw"Invalid value for signature";i=t.r,s=t.s}if(r instanceof Gt)n=r;else{if(!Bitcoin.Util.isArray(r))throw"Invalid format for pubkey value, must be byte array or ECPointFp";n=Gt.decodeFrom(this.ecparams.curve,r)}var a=lt.fromByteArrayUnsigned(e);return this.verifyRaw(a,i,s,n)},this.verifyRaw=function(e,t,r,i){var s=this.ecparams.n,n=this.ecparams.G;if(t.compareTo(lt.ONE)<0||t.compareTo(s)>=0)return!1;if(r.compareTo(lt.ONE)<0||r.compareTo(s)>=0)return!1;var o=r.modInverse(s),a=e.multiply(o).mod(s),u=t.multiply(o).mod(s);return n.multiply(a).add(i.multiply(u)).getX().toBigInteger().mod(s).equals(t)},this.serializeSig=function(e,t){var r=e.toByteArraySigned(),i=t.toByteArraySigned(),s=[];return s.push(2),s.push(r.length),(s=s.concat(r)).push(2),s.push(i.length),(s=s.concat(i)).unshift(s.length),s.unshift(48),s},this.parseSig=function(e){var t;if(48!=e[0])throw new Error("Signature not a valid DERSequence");if(2!=e[t=2])throw new Error("First element in signature must be a DERInteger");var r=e.slice(t+2,t+2+e[t+1]);if(2!=e[t+=2+e[t+1]])throw new Error("Second element in signature must be a DERInteger");var i=e.slice(t+2,t+2+e[t+1]);return t+=2+e[t+1],{r:lt.fromByteArrayUnsigned(r),s:lt.fromByteArrayUnsigned(i)}},this.parseSigCompact=function(e){if(65!==e.length)throw"Signature has the wrong length";var t=e[0]-27;if(t<0||t>7)throw"Invalid signature type";var r=this.ecparams.n;return{r:lt.fromByteArrayUnsigned(e.slice(1,33)).mod(r),s:lt.fromByteArrayUnsigned(e.slice(33,65)).mod(r),i:t}},this.readPKCS5PrvKeyHex=function(e){var t,r,i,s=tr,n=Xt.crypto.ECDSA.getName,o=s.getVbyList;if(!1===s.isASN1HEX(e))throw"not ASN.1 hex string";try{t=o(e,0,[2,0],"06"),r=o(e,0,[1],"04");try{i=o(e,0,[3,0],"03").substr(2)}catch(e){}}catch(e){throw"malformed PKCS#1/5 plain ECC private key"}if(this.curveName=n(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(i),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(e){var t,r,i,s=tr,n=Xt.crypto.ECDSA.getName,o=s.getVbyList;if(!1===s.isASN1HEX(e))throw"not ASN.1 hex string";try{o(e,0,[1,0],"06"),t=o(e,0,[1,1],"06"),r=o(e,0,[2,0,1],"04");try{i=o(e,0,[2,0,2,0],"03").substr(2)}catch(e){}}catch(e){throw"malformed PKCS#8 plain ECC private key"}if(this.curveName=n(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(i),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PubKeyHex=function(e){var t,r,i=tr,s=Xt.crypto.ECDSA.getName,n=i.getVbyList;if(!1===i.isASN1HEX(e))throw"not ASN.1 hex string";try{n(e,0,[0,0],"06"),t=n(e,0,[0,1],"06"),r=n(e,0,[1],"03").substr(2)}catch(e){throw"malformed PKCS#8 ECC public key"}if(this.curveName=s(t),null===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r)},this.readCertPubKeyHex=function(e,t){5!==t&&(t=6);var r,i,s=tr,n=Xt.crypto.ECDSA.getName,o=s.getVbyList;if(!1===s.isASN1HEX(e))throw"not ASN.1 hex string";try{r=o(e,0,[0,t,0,1],"06"),i=o(e,0,[0,t,1],"03").substr(2)}catch(e){throw"malformed X.509 certificate ECC public key"}if(this.curveName=n(r),null===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(i)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},Xt.crypto.ECDSA.parseSigHex=function(e){var t=Xt.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new lt(t.r,16),s:new lt(t.s,16)}},Xt.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=tr,r=t.getChildIdx,i=t.getV;if("30"!=e.substr(0,2))throw"signature is not a ASN.1 sequence";var s=r(e,0);if(2!=s.length)throw"number of signature ASN.1 sequence elements seem wrong";var n=s[0],o=s[1];if("02"!=e.substr(n,2))throw"1st item of sequene of signature is not ASN.1 integer";if("02"!=e.substr(o,2))throw"2nd item of sequene of signature is not ASN.1 integer";return{r:i(e,n),s:i(e,o)}},Xt.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=Xt.crypto.ECDSA.parseSigHexInHexRS(e),r=t.r,i=t.s;if("00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),"00"==i.substr(0,2)&&i.length%32==2&&(i=i.substr(2)),r.length%32==30&&(r="00"+r),i.length%32==30&&(i="00"+i),r.length%32!=0)throw"unknown ECDSA sig r length error";if(i.length%32!=0)throw"unknown ECDSA sig s length error";return r+i},Xt.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var t=e.substr(0,e.length/2),r=e.substr(e.length/2);return Xt.crypto.ECDSA.hexRSSigToASN1Sig(t,r)},Xt.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var r=new lt(e,16),i=new lt(t,16);return Xt.crypto.ECDSA.biRSSigToASN1Sig(r,i)},Xt.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var r=Xt.asn1,i=new r.DERInteger({bigint:e}),s=new r.DERInteger({bigint:t});return new r.DERSequence({array:[i,s]}).getEncodedHex()},Xt.crypto.ECDSA.getName=function(e){return"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040022"===e?"secp384r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":null},void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.crypto&&Xt.crypto||(Xt.crypto={}),Xt.crypto.ECParameterDB=new function(){var e={},t={};function r(e){return new lt(e,16)}this.getByName=function(r){var i=r;if(void 0!==t[i]&&(i=t[r]),void 0!==e[i])return e[i];throw"unregistered EC curve name: "+i},this.regist=function(i,s,n,o,a,u,c,h,l,d,g,p){e[i]={};var f=r(n),v=r(o),m=r(a),y=r(u),_=r(c),F=new Yt(f,v,m),S=F.decodePointHex("04"+h+l);e[i].name=i,e[i].keylen=s,e[i].curve=F,e[i].G=S,e[i].n=y,e[i].h=_,e[i].oid=g,e[i].info=p;for(var b=0;b<d.length;b++)t[d[b]]=i}},Xt.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),Xt.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),Xt.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),Xt.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),Xt.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),Xt.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),Xt.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),Xt.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),Xt.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),Xt.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var Sr=function(){var e=function(e,r,i){return t(ot.AES,e,r,i)},t=function(e,t,r,i){var s=ot.enc.Hex.parse(t),n=ot.enc.Hex.parse(r),o=ot.enc.Hex.parse(i),a={};a.key=n,a.iv=o,a.ciphertext=s;var u=e.decrypt(a,n,{iv:o});return ot.enc.Hex.stringify(u)},r=function(e,t,r){return i(ot.AES,e,t,r)},i=function(e,t,r,i){var s=ot.enc.Hex.parse(t),n=ot.enc.Hex.parse(r),o=ot.enc.Hex.parse(i),a=e.encrypt(s,n,{iv:o}),u=ot.enc.Hex.parse(a.toString());return ot.enc.Base64.stringify(u)},s={"AES-256-CBC":{proc:e,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(e,r,i){return t(ot.TripleDES,e,r,i)},eproc:function(e,t,r){return i(ot.TripleDES,e,t,r)},keylen:24,ivlen:8},"DES-CBC":{proc:function(e,r,i){return t(ot.DES,e,r,i)},eproc:function(e,t,r){return i(ot.DES,e,t,r)},keylen:8,ivlen:8}},n=function(e){var t={},r=e.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));r&&(t.cipher=r[1],t.ivsalt=r[2]);var i=e.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));i&&(t.type=i[1]);var s=-1,n=0;-1!=e.indexOf("\r\n\r\n")&&(s=e.indexOf("\r\n\r\n"),n=2),-1!=e.indexOf("\n\n")&&(s=e.indexOf("\n\n"),n=1);var o=e.indexOf("-----END");if(-1!=s&&-1!=o){var a=e.substring(s+2*n,o-n);a=a.replace(/\s+/g,""),t.data=a}return t},o=function(e,t,r){for(var i=r.substring(0,16),n=ot.enc.Hex.parse(i),o=ot.enc.Utf8.parse(t),a=s[e].keylen+s[e].ivlen,u="",c=null;;){var h=ot.algo.MD5.create();if(null!=c&&h.update(c),h.update(o),h.update(n),c=h.finalize(),(u+=ot.enc.Hex.stringify(c)).length>=2*a)break}var l={};return l.keyhex=u.substr(0,2*s[e].keylen),l.ivhex=u.substr(2*s[e].keylen,2*s[e].ivlen),l},a=function(e,t,r,i){var n=ot.enc.Base64.parse(e),o=ot.enc.Hex.stringify(n);return(0,s[t].proc)(o,r,i)};return{version:"1.0.0",parsePKCS5PEM:function(e){return n(e)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(e,t,r){return o(e,t,r)},decryptKeyB64:function(e,t,r,i){return a(e,t,r,i)},getDecryptedKeyHex:function(e,t){var r=n(e),i=r.cipher,s=r.ivsalt,u=r.data,c=o(i,t,s).keyhex;return a(u,i,c,s)},getEncryptedPKCS5PEMFromPrvKeyHex:function(e,t,r,i,n){var a="";if(void 0!==i&&null!=i||(i="AES-256-CBC"),void 0===s[i])throw"KEYUTIL unsupported algorithm: "+i;void 0!==n&&null!=n||(n=function(e){var t=ot.lib.WordArray.random(e);return ot.enc.Hex.stringify(t)}(s[i].ivlen).toUpperCase());var u=function(e,t,r,i){return(0,s[t].eproc)(e,r,i)}(t,i,o(i,r,n).keyhex,n);a="-----BEGIN "+e+" PRIVATE KEY-----\r\n";return a+="Proc-Type: 4,ENCRYPTED\r\n",a+="DEK-Info: "+i+","+n+"\r\n",a+="\r\n",a+=u.replace(/(.{64})/g,"$1\r\n"),a+="\r\n-----END "+e+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(e){var t=tr,r=t.getChildIdx,i=t.getV,s={},n=r(e,0);if(2!=n.length)throw"malformed format: SEQUENCE(0).items != 2: "+n.length;s.ciphertext=i(e,n[1]);var o=r(e,n[0]);if(2!=o.length)throw"malformed format: SEQUENCE(0.0).items != 2: "+o.length;if("2a864886f70d01050d"!=i(e,o[0]))throw"this only supports pkcs5PBES2";var a=r(e,o[1]);if(2!=o.length)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+a.length;var u=r(e,a[1]);if(2!=u.length)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+u.length;if("2a864886f70d0307"!=i(e,u[0]))throw"this only supports TripleDES";s.encryptionSchemeAlg="TripleDES",s.encryptionSchemeIV=i(e,u[1]);var c=r(e,a[0]);if(2!=c.length)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+c.length;if("2a864886f70d01050c"!=i(e,c[0]))throw"this only supports pkcs5PBKDF2";var h=r(e,c[1]);if(h.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+h.length;s.pbkdf2Salt=i(e,h[0]);var l=i(e,h[1]);try{s.pbkdf2Iter=parseInt(l,16)}catch(e){throw"malformed format pbkdf2Iter: "+l}return s},getPBKDF2KeyHexFromParam:function(e,t){var r=ot.enc.Hex.parse(e.pbkdf2Salt),i=e.pbkdf2Iter,s=ot.PBKDF2(t,r,{keySize:6,iterations:i});return ot.enc.Hex.stringify(s)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(e,t){var r=pr(e,"ENCRYPTED PRIVATE KEY"),i=this.parseHexOfEncryptedPKCS8(r),s=Sr.getPBKDF2KeyHexFromParam(i,t),n={};n.ciphertext=ot.enc.Hex.parse(i.ciphertext);var o=ot.enc.Hex.parse(s),a=ot.enc.Hex.parse(i.encryptionSchemeIV),u=ot.TripleDES.decrypt(n,o,{iv:a});return ot.enc.Hex.stringify(u)},getKeyFromEncryptedPKCS8PEM:function(e,t){var r=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(e,t);return this.getKeyFromPlainPrivatePKCS8Hex(r)},parsePlainPrivatePKCS8Hex:function(e){var t=tr,r=t.getChildIdx,i=t.getV,s={algparam:null};if("30"!=e.substr(0,2))throw"malformed plain PKCS8 private key(code:001)";var n=r(e,0);if(3!=n.length)throw"malformed plain PKCS8 private key(code:002)";if("30"!=e.substr(n[1],2))throw"malformed PKCS8 private key(code:003)";var o=r(e,n[1]);if(2!=o.length)throw"malformed PKCS8 private key(code:004)";if("06"!=e.substr(o[0],2))throw"malformed PKCS8 private key(code:005)";if(s.algoid=i(e,o[0]),"06"==e.substr(o[1],2)&&(s.algparam=i(e,o[1])),"04"!=e.substr(n[2],2))throw"malformed PKCS8 private key(code:006)";return s.keyidx=t.getVidx(e,n[2]),s},getKeyFromPlainPrivatePKCS8PEM:function(e){var t=pr(e,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(t)},getKeyFromPlainPrivatePKCS8Hex:function(e){var t,r=this.parsePlainPrivatePKCS8Hex(e);if("2a864886f70d010101"==r.algoid)t=new Wt;else if("2a8648ce380401"==r.algoid)t=new Xt.crypto.DSA;else{if("2a8648ce3d0201"!=r.algoid)throw"unsupported private key algorithm";t=new Xt.crypto.ECDSA}return t.readPKCS8PrvKeyHex(e),t},_getKeyFromPublicPKCS8Hex:function(e){var t,r=tr.getVbyList(e,0,[0,0],"06");if("2a864886f70d010101"===r)t=new Wt;else if("2a8648ce380401"===r)t=new Xt.crypto.DSA;else{if("2a8648ce3d0201"!==r)throw"unsupported PKCS#8 public key hex";t=new Xt.crypto.ECDSA}return t.readPKCS8PubKeyHex(e),t},parsePublicRawRSAKeyHex:function(e){var t=tr,r=t.getChildIdx,i=t.getV,s={};if("30"!=e.substr(0,2))throw"malformed RSA key(code:001)";var n=r(e,0);if(2!=n.length)throw"malformed RSA key(code:002)";if("02"!=e.substr(n[0],2))throw"malformed RSA key(code:003)";if(s.n=i(e,n[0]),"02"!=e.substr(n[1],2))throw"malformed RSA key(code:004)";return s.e=i(e,n[1]),s},parsePublicPKCS8Hex:function(e){var t=tr,r=t.getChildIdx,i=t.getV,s={algparam:null},n=r(e,0);if(2!=n.length)throw"outer DERSequence shall have 2 elements: "+n.length;var o=n[0];if("30"!=e.substr(o,2))throw"malformed PKCS8 public key(code:001)";var a=r(e,o);if(2!=a.length)throw"malformed PKCS8 public key(code:002)";if("06"!=e.substr(a[0],2))throw"malformed PKCS8 public key(code:003)";if(s.algoid=i(e,a[0]),"06"==e.substr(a[1],2)?s.algparam=i(e,a[1]):"30"==e.substr(a[1],2)&&(s.algparam={},s.algparam.p=t.getVbyList(e,a[1],[0],"02"),s.algparam.q=t.getVbyList(e,a[1],[1],"02"),s.algparam.g=t.getVbyList(e,a[1],[2],"02")),"03"!=e.substr(n[1],2))throw"malformed PKCS8 public key(code:004)";return s.key=i(e,n[1]).substr(2),s}}}();Sr.getKey=function(e,t,r){var i=(v=tr).getChildIdx,s=(v.getV,v.getVbyList),n=Xt.crypto,o=n.ECDSA,a=n.DSA,u=Wt,c=pr,h=Sr;if(void 0!==u&&e instanceof u)return e;if(void 0!==o&&e instanceof o)return e;if(void 0!==a&&e instanceof a)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new o({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new o({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(A=new u).setPublic(e.n,e.e),A;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(A=new u).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),A;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(A=new u).setPrivate(e.n,e.e,e.d),A;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(A=new a).setPublic(e.p,e.q,e.g,e.y),A;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(A=new a).setPrivate(e.p,e.q,e.g,e.y,e.x),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(A=new u).setPublic(ar(e.n),ar(e.e)),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(A=new u).setPrivateEx(ar(e.n),ar(e.e),ar(e.d),ar(e.p),ar(e.q),ar(e.dp),ar(e.dq),ar(e.qi)),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(A=new u).setPrivate(ar(e.n),ar(e.e),ar(e.d)),A;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var l=(k=new o({curve:e.crv})).ecparams.keylen/4,d="04"+("0000000000"+ar(e.x)).slice(-l)+("0000000000"+ar(e.y)).slice(-l);return k.setPublicKeyHex(d),k}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){l=(k=new o({curve:e.crv})).ecparams.keylen/4,d="04"+("0000000000"+ar(e.x)).slice(-l)+("0000000000"+ar(e.y)).slice(-l);var g=("0000000000"+ar(e.d)).slice(-l);return k.setPublicKeyHex(d),k.setPrivateKeyHex(g),k}if("pkcs5prv"===r){var p,f=e,v=tr;if(9===(p=i(f,0)).length)(A=new u).readPKCS5PrvKeyHex(f);else if(6===p.length)(A=new a).readPKCS5PrvKeyHex(f);else{if(!(p.length>2&&"04"===f.substr(p[1],2)))throw"unsupported PKCS#1/5 hexadecimal key";(A=new o).readPKCS5PrvKeyHex(f)}return A}if("pkcs8prv"===r)return A=h.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===r)return h._getKeyFromPublicPKCS8Hex(e);if("x509pub"===r)return kr.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return kr.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var m=pr(e,"PUBLIC KEY");return h._getKeyFromPublicPKCS8Hex(m)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var y=c(e,"RSA PRIVATE KEY");return h.getKey(y,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var _=s(R=c(e,"DSA PRIVATE KEY"),0,[1],"02"),F=s(R,0,[2],"02"),S=s(R,0,[3],"02"),b=s(R,0,[4],"02"),w=s(R,0,[5],"02");return(A=new a).setPrivate(new lt(_,16),new lt(F,16),new lt(S,16),new lt(b,16),new lt(w,16)),A}if(-1!=e.indexOf("-END PRIVATE KEY-"))return h.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var E=h.getDecryptedKeyHex(e,t),x=new Wt;return x.readPKCS5PrvKeyHex(E),x}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var k,A=s(R=h.getDecryptedKeyHex(e,t),0,[1],"04"),P=s(R,0,[2,0],"06"),C=s(R,0,[3,0],"03").substr(2);if(void 0===Xt.crypto.OID.oidhex2name[P])throw"undefined OID(hex) in KJUR.crypto.OID: "+P;return(k=new o({curve:Xt.crypto.OID.oidhex2name[P]})).setPublicKeyHex(C),k.setPrivateKeyHex(A),k.isPublic=!1,k}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var R;_=s(R=h.getDecryptedKeyHex(e,t),0,[1],"02"),F=s(R,0,[2],"02"),S=s(R,0,[3],"02"),b=s(R,0,[4],"02"),w=s(R,0,[5],"02");return(A=new a).setPrivate(new lt(_,16),new lt(F,16),new lt(S,16),new lt(b,16),new lt(w,16)),A}if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return h.getKeyFromEncryptedPKCS8PEM(e,t);throw"not supported argument"},Sr.generateKeypair=function(e,t){if("RSA"==e){var r=t;(o=new Wt).generate(r,"10001"),o.isPrivate=!0,o.isPublic=!0;var i=new Wt,s=o.n.toString(16),n=o.e.toString(16);return i.setPublic(s,n),i.isPrivate=!1,i.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=i,a}if("EC"==e){var o,a,u=t,c=new Xt.crypto.ECDSA({curve:u}).generateKeyPairHex();return(o=new Xt.crypto.ECDSA({curve:u})).setPublicKeyHex(c.ecpubhex),o.setPrivateKeyHex(c.ecprvhex),o.isPrivate=!0,o.isPublic=!1,(i=new Xt.crypto.ECDSA({curve:u})).setPublicKeyHex(c.ecpubhex),i.isPrivate=!1,i.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=i,a}throw"unknown algorithm: "+e},Sr.getPEM=function(e,t,r,i,s,n){var o=Xt,a=o.asn1,u=a.DERObjectIdentifier,c=a.DERInteger,h=a.ASN1Util.newObject,l=a.x509.SubjectPublicKeyInfo,d=o.crypto,g=d.DSA,p=d.ECDSA,f=Wt;function v(e){return h({seq:[{int:0},{int:{bigint:e.n}},{int:e.e},{int:{bigint:e.d}},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.dmp1}},{int:{bigint:e.dmq1}},{int:{bigint:e.coeff}}]})}function m(e){return h({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a0",!0,{oid:{name:e.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]})}function y(e){return h({seq:[{int:0},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}},{int:{bigint:e.y}},{int:{bigint:e.x}}]})}if((void 0!==f&&e instanceof f||void 0!==g&&e instanceof g||void 0!==p&&e instanceof p)&&1==e.isPublic&&(void 0===t||"PKCS8PUB"==t))return gr(b=new l(e).getEncodedHex(),"PUBLIC KEY");if("PKCS1PRV"==t&&void 0!==f&&e instanceof f&&(void 0===r||null==r)&&1==e.isPrivate)return gr(b=v(e).getEncodedHex(),"RSA PRIVATE KEY");if("PKCS1PRV"==t&&void 0!==p&&e instanceof p&&(void 0===r||null==r)&&1==e.isPrivate){var _=new u({name:e.curveName}).getEncodedHex(),F=m(e).getEncodedHex(),S="";return S+=gr(_,"EC PARAMETERS"),S+=gr(F,"EC PRIVATE KEY")}if("PKCS1PRV"==t&&void 0!==g&&e instanceof g&&(void 0===r||null==r)&&1==e.isPrivate)return gr(b=y(e).getEncodedHex(),"DSA PRIVATE KEY");if("PKCS5PRV"==t&&void 0!==f&&e instanceof f&&void 0!==r&&null!=r&&1==e.isPrivate){var b=v(e).getEncodedHex();return void 0===i&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",b,r,i,n)}if("PKCS5PRV"==t&&void 0!==p&&e instanceof p&&void 0!==r&&null!=r&&1==e.isPrivate){b=m(e).getEncodedHex();return void 0===i&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",b,r,i,n)}if("PKCS5PRV"==t&&void 0!==g&&e instanceof g&&void 0!==r&&null!=r&&1==e.isPrivate){b=y(e).getEncodedHex();return void 0===i&&(i="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",b,r,i,n)}var w=function(e,t){var r=E(e,t);return new h({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:r.pbkdf2Salt}},{int:r.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:r.encryptionSchemeIV}}]}]}]},{octstr:{hex:r.ciphertext}}]}).getEncodedHex()},E=function(e,t){var r=ot.lib.WordArray.random(8),i=ot.lib.WordArray.random(8),s=ot.PBKDF2(t,r,{keySize:6,iterations:100}),n=ot.enc.Hex.parse(e),o=ot.TripleDES.encrypt(n,s,{iv:i})+"",a={};return a.ciphertext=o,a.pbkdf2Salt=ot.enc.Hex.stringify(r),a.pbkdf2Iter=100,a.encryptionSchemeAlg="DES-EDE3-CBC",a.encryptionSchemeIV=ot.enc.Hex.stringify(i),a};if("PKCS8PRV"==t&&null!=f&&e instanceof f&&1==e.isPrivate){var x=v(e).getEncodedHex();b=h({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:x}}]}).getEncodedHex();return void 0===r||null==r?gr(b,"PRIVATE KEY"):gr(F=w(b,r),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==p&&e instanceof p&&1==e.isPrivate){x=new h({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]}).getEncodedHex(),b=h({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:x}}]}).getEncodedHex();return void 0===r||null==r?gr(b,"PRIVATE KEY"):gr(F=w(b,r),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==g&&e instanceof g&&1==e.isPrivate){x=new c({bigint:e.x}).getEncodedHex(),b=h({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:x}}]}).getEncodedHex();return void 0===r||null==r?gr(b,"PRIVATE KEY"):gr(F=w(b,r),"ENCRYPTED PRIVATE KEY")}throw"unsupported object nor format"},Sr.getKeyFromCSRPEM=function(e){var t=pr(e,"CERTIFICATE REQUEST");return Sr.getKeyFromCSRHex(t)},Sr.getKeyFromCSRHex=function(e){var t=Sr.parseCSRHex(e);return Sr.getKey(t.p8pubkeyhex,null,"pkcs8pub")},Sr.parseCSRHex=function(e){var t=tr,r=t.getChildIdx,i=t.getTLV,s={},n=e;if("30"!=n.substr(0,2))throw"malformed CSR(code:001)";var o=r(n,0);if(o.length<1)throw"malformed CSR(code:002)";if("30"!=n.substr(o[0],2))throw"malformed CSR(code:003)";var a=r(n,o[0]);if(a.length<3)throw"malformed CSR(code:004)";return s.p8pubkeyhex=i(n,a[2]),s},Sr.getJWKFromKey=function(e){var t={};if(e instanceof Wt&&e.isPrivate)return t.kty="RSA",t.n=or(e.n.toString(16)),t.e=or(e.e.toString(16)),t.d=or(e.d.toString(16)),t.p=or(e.p.toString(16)),t.q=or(e.q.toString(16)),t.dp=or(e.dmp1.toString(16)),t.dq=or(e.dmq1.toString(16)),t.qi=or(e.coeff.toString(16)),t;if(e instanceof Wt&&e.isPublic)return t.kty="RSA",t.n=or(e.n.toString(16)),t.e=or(e.e.toString(16)),t;if(e instanceof Xt.crypto.ECDSA&&e.isPrivate){if("P-256"!==(i=e.getShortNISTPCurveName())&&"P-384"!==i)throw"unsupported curve name for JWT: "+i;var r=e.getPublicKeyXYHex();return t.kty="EC",t.crv=i,t.x=or(r.x),t.y=or(r.y),t.d=or(e.prvKeyHex),t}if(e instanceof Xt.crypto.ECDSA&&e.isPublic){var i;if("P-256"!==(i=e.getShortNISTPCurveName())&&"P-384"!==i)throw"unsupported curve name for JWT: "+i;r=e.getPublicKeyXYHex();return t.kty="EC",t.crv=i,t.x=or(r.x),t.y=or(r.y),t}throw"not supported key object"},Wt.getPosArrayOfChildrenFromHex=function(e){return tr.getChildIdx(e,0)},Wt.getHexValueArrayOfChildrenFromHex=function(e){var t,r=tr.getV,i=r(e,(t=Wt.getPosArrayOfChildrenFromHex(e))[0]),s=r(e,t[1]),n=r(e,t[2]),o=r(e,t[3]),a=r(e,t[4]),u=r(e,t[5]),c=r(e,t[6]),h=r(e,t[7]),l=r(e,t[8]);return(t=new Array).push(i,s,n,o,a,u,c,h,l),t},Wt.prototype.readPrivateKeyFromPEMString=function(e){var t=pr(e),r=Wt.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},Wt.prototype.readPKCS5PrvKeyHex=function(e){var t=Wt.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Wt.prototype.readPKCS8PrvKeyHex=function(e){var t,r,i,s,n,o,a,u,c=tr,h=c.getVbyList;if(!1===c.isASN1HEX(e))throw"not ASN.1 hex string";try{t=h(e,0,[2,0,1],"02"),r=h(e,0,[2,0,2],"02"),i=h(e,0,[2,0,3],"02"),s=h(e,0,[2,0,4],"02"),n=h(e,0,[2,0,5],"02"),o=h(e,0,[2,0,6],"02"),a=h(e,0,[2,0,7],"02"),u=h(e,0,[2,0,8],"02")}catch(e){throw"malformed PKCS#8 plain RSA private key"}this.setPrivateEx(t,r,i,s,n,o,a,u)},Wt.prototype.readPKCS5PubKeyHex=function(e){var t=tr,r=t.getV;if(!1===t.isASN1HEX(e))throw"keyHex is not ASN.1 hex string";var i=t.getChildIdx(e,0);if(2!==i.length||"02"!==e.substr(i[0],2)||"02"!==e.substr(i[1],2))throw"wrong hex for PKCS#5 public key";var s=r(e,i[0]),n=r(e,i[1]);this.setPublic(s,n)},Wt.prototype.readPKCS8PubKeyHex=function(e){var t=tr;if(!1===t.isASN1HEX(e))throw"not ASN.1 hex string";if("06092a864886f70d010101"!==t.getTLVbyList(e,0,[0,0]))throw"not PKCS8 RSA public key";var r=t.getTLVbyList(e,0,[1,0]);this.readPKCS5PubKeyHex(r)},Wt.prototype.readCertPubKeyHex=function(e,t){var r,i;(r=new kr).readCertHex(e),i=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(i)};var br=new RegExp("");function wr(e,t){for(var r="",i=t/4-e.length,s=0;s<i;s++)r+="0";return r+e}function Er(e,t,r){for(var i="",s=0;i.length<t;)i+=hr(r(lr(e+String.fromCharCode.apply(String,[(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s])))),s+=1;return i}function xr(e){for(var t in Xt.crypto.Util.DIGESTINFOHEAD){var r=Xt.crypto.Util.DIGESTINFOHEAD[t],i=r.length;if(e.substring(0,i)==r)return[t,e.substring(i)]}return[]}function kr(){var e=tr,t=e.getChildIdx,r=e.getV,i=e.getTLV,s=e.getVbyList,n=e.getTLVbyList,o=e.getIdxbyList,a=e.getVidx,u=e.oidname,c=kr,h=pr;this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){return null===this.hex||0!==this.version?this.version:"a003020102"!==n(this.hex,0,[0,0])?(this.version=1,this.foffset=-1,1):(this.version=3,3)},this.getSerialNumberHex=function(){return s(this.hex,0,[0,1+this.foffset],"02")},this.getSignatureAlgorithmField=function(){return u(s(this.hex,0,[0,2+this.foffset,0],"06"))},this.getIssuerHex=function(){return n(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return c.hex2dn(this.getIssuerHex())},this.getSubjectHex=function(){return n(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return c.hex2dn(this.getSubjectHex())},this.getNotBefore=function(){var e=s(this.hex,0,[0,4+this.foffset,0]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getNotAfter=function(){var e=s(this.hex,0,[0,4+this.foffset,1]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getPublicKeyHex=function(){return e.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return o(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var e=this.getPublicKeyIdx();return o(this.hex,e,[1,0],"30")},this.getPublicKey=function(){return Sr.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){return u(s(this.hex,0,[1,0],"06"))},this.getSignatureValueHex=function(){return s(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmName(),r=this.getSignatureValueHex(),i=n(this.hex,0,[0],"30"),s=new Xt.crypto.Signature({alg:t});return s.init(e),s.updateHex(i),s.verify(r)},this.parseExt=function(){if(3!==this.version)return-1;var r=o(this.hex,0,[0,7,0],"30"),i=t(this.hex,r);this.aExtInfo=new Array;for(var n=0;n<i.length;n++){var u={critical:!1},c=0;3===t(this.hex,i[n]).length&&(u.critical=!0,c=1),u.oid=e.hextooidstr(s(this.hex,i[n],[0],"06"));var h=o(this.hex,i[n],[1+c]);u.vidx=a(this.hex,h),this.aExtInfo.push(u)}},this.getExtInfo=function(e){var t=this.aExtInfo,r=e;if(e.match(/^[0-9.]+$/)||(r=Xt.asn1.x509.OID.name2oid(e)),""!==r)for(var i=0;i<t.length;i++)if(t[i].oid===r)return t[i]},this.getExtBasicConstraints=function(){var e=this.getExtInfo("basicConstraints");if(void 0===e)return e;var t=r(this.hex,e.vidx);if(""===t)return{};if("0101ff"===t)return{cA:!0};if("0101ff02"===t.substr(0,8)){var i=r(t,6);return{cA:!0,pathLen:parseInt(i,16)}}throw"basicConstraints parse error"},this.getExtKeyUsageBin=function(){var e=this.getExtInfo("keyUsage");if(void 0===e)return"";var t=r(this.hex,e.vidx);if(t.length%2!=0||t.length<=2)throw"malformed key usage value";var i=parseInt(t.substr(0,2)),s=parseInt(t.substr(2),16).toString(2);return s.substr(0,s.length-i)},this.getExtKeyUsageString=function(){for(var e=this.getExtKeyUsageBin(),t=new Array,r=0;r<e.length;r++)"1"==e.substr(r,1)&&t.push(kr.KEYUSAGE_NAME[r]);return t.join(",")},this.getExtSubjectKeyIdentifier=function(){var e=this.getExtInfo("subjectKeyIdentifier");return void 0===e?e:r(this.hex,e.vidx)},this.getExtAuthorityKeyIdentifier=function(){var e=this.getExtInfo("authorityKeyIdentifier");if(void 0===e)return e;for(var s={},n=i(this.hex,e.vidx),o=t(n,0),a=0;a<o.length;a++)"80"===n.substr(o[a],2)&&(s.kid=r(n,o[a]));return s},this.getExtExtKeyUsageName=function(){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return e;var s=new Array,n=i(this.hex,e.vidx);if(""===n)return s;for(var o=t(n,0),a=0;a<o.length;a++)s.push(u(r(n,o[a])));return s},this.getExtSubjectAltName=function(){for(var e=this.getExtSubjectAltName2(),t=new Array,r=0;r<e.length;r++)"DNS"===e[r][0]&&t.push(e[r][1]);return t},this.getExtSubjectAltName2=function(){var e,s,n,o=this.getExtInfo("subjectAltName");if(void 0===o)return o;for(var a=new Array,u=i(this.hex,o.vidx),c=t(u,0),h=0;h<c.length;h++)n=u.substr(c[h],2),e=r(u,c[h]),"81"===n&&(s=cr(e),a.push(["MAIL",s])),"82"===n&&(s=cr(e),a.push(["DNS",s])),"84"===n&&(s=kr.hex2dn(e,0),a.push(["DN",s])),"86"===n&&(s=cr(e),a.push(["URI",s])),"87"===n&&(s=yr(e),a.push(["IP",s]));return a},this.getExtCRLDistributionPointsURI=function(){var e=this.getExtInfo("cRLDistributionPoints");if(void 0===e)return e;for(var r=new Array,i=t(this.hex,e.vidx),n=0;n<i.length;n++)try{var o=cr(s(this.hex,i[n],[0,0,0],"86"));r.push(o)}catch(e){}return r},this.getExtAIAInfo=function(){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return e;for(var r={ocsp:[],caissuer:[]},i=t(this.hex,e.vidx),n=0;n<i.length;n++){var o=s(this.hex,i[n],[0],"06"),a=s(this.hex,i[n],[1],"86");"2b06010505073001"===o&&r.ocsp.push(cr(a)),"2b06010505073002"===o&&r.caissuer.push(cr(a))}return r},this.getExtCertificatePolicies=function(){var e=this.getExtInfo("certificatePolicies");if(void 0===e)return e;for(var n=i(this.hex,e.vidx),o=[],a=t(n,0),c=0;c<a.length;c++){var h={},l=t(n,a[c]);if(h.id=u(r(n,l[0])),2===l.length)for(var d=t(n,l[1]),g=0;g<d.length;g++){var p=s(n,d[g],[0],"06");"2b06010505070201"===p?h.cps=cr(s(n,d[g],[1])):"2b06010505070202"===p&&(h.unotice=cr(s(n,d[g],[1,0])))}o.push(h)}return o},this.readCertPEM=function(e){this.readCertHex(h(e))},this.readCertHex=function(e){this.hex=e,this.getVersion();try{o(this.hex,0,[0,7],"a3"),this.parseExt()}catch(e){}},this.getInfo=function(){var e,t,r;if(e="Basic Fields\n",e+="  serial number: "+this.getSerialNumberHex()+"\n",e+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",e+="  issuer: "+this.getIssuerString()+"\n",e+="  notBefore: "+this.getNotBefore()+"\n",e+="  notAfter: "+this.getNotAfter()+"\n",e+="  subject: "+this.getSubjectString()+"\n",e+="  subject public key info: \n",e+="    key algorithm: "+(t=this.getPublicKey()).type+"\n","RSA"===t.type&&(e+="    n="+Fr(t.n.toString(16)).substr(0,16)+"...\n",e+="    e="+Fr(t.e.toString(16))+"\n"),null!=(r=this.aExtInfo)){e+="X509v3 Extensions:\n";for(var i=0;i<r.length;i++){var s=r[i],n=Xt.asn1.x509.OID.oid2name(s.oid);""===n&&(n=s.oid);var o="";if(!0===s.critical&&(o="CRITICAL"),e+="  "+n+" "+o+":\n","basicConstraints"===n){var a=this.getExtBasicConstraints();void 0===a.cA?e+="    {}\n":(e+="    cA=true",void 0!==a.pathLen&&(e+=", pathLen="+a.pathLen),e+="\n")}else if("keyUsage"===n)e+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"===n)e+="    "+this.getExtSubjectKeyIdentifier()+"\n";else if("authorityKeyIdentifier"===n){var u=this.getExtAuthorityKeyIdentifier();void 0!==u.kid&&(e+="    kid="+u.kid+"\n")}else{if("extKeyUsage"===n)e+="    "+this.getExtExtKeyUsageName().join(", ")+"\n";else if("subjectAltName"===n)e+="    "+this.getExtSubjectAltName2()+"\n";else if("cRLDistributionPoints"===n)e+="    "+this.getExtCRLDistributionPointsURI()+"\n";else if("authorityInfoAccess"===n){var c=this.getExtAIAInfo();void 0!==c.ocsp&&(e+="    ocsp: "+c.ocsp.join(",")+"\n"),void 0!==c.caissuer&&(e+="    caissuer: "+c.caissuer.join(",")+"\n")}else if("certificatePolicies"===n)for(var h=this.getExtCertificatePolicies(),l=0;l<h.length;l++)void 0!==h[l].id&&(e+="    policy oid: "+h[l].id+"\n"),void 0!==h[l].cps&&(e+="    cps: "+h[l].cps+"\n")}}}return e+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n",e+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"}}br.compile("[^0-9a-f]","gi"),Wt.prototype.sign=function(e,t){var r,i=(r=e,Xt.crypto.Util.hashString(r,t));return this.signWithMessageHash(i,t)},Wt.prototype.signWithMessageHash=function(e,t){var r=$t(Xt.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return wr(this.doPrivate(r).toString(16),this.n.bitLength())},Wt.prototype.signPSS=function(e,t,r){var i,s=(i=lr(e),Xt.crypto.Util.hashHex(i,t));return void 0===r&&(r=-1),this.signWithMessageHashPSS(s,t,r)},Wt.prototype.signWithMessageHashPSS=function(e,t,r){var i,s=hr(e),n=s.length,o=this.n.bitLength()-1,a=Math.ceil(o/8),u=function(e){return Xt.crypto.Util.hashHex(e,t)};if(-1===r||void 0===r)r=n;else if(-2===r)r=a-n-2;else if(r<-2)throw"invalid salt length";if(a<n+r+2)throw"data too long";var c="";r>0&&(c=new Array(r),(new Lt).nextBytes(c),c=String.fromCharCode.apply(String,c));var h=hr(u(lr("\0\0\0\0\0\0\0\0"+s+c))),l=[];for(i=0;i<a-r-n-2;i+=1)l[i]=0;var d=String.fromCharCode.apply(String,l)+""+c,g=Er(h,d.length,u),p=[];for(i=0;i<d.length;i+=1)p[i]=d.charCodeAt(i)^g.charCodeAt(i);var f=65280>>8*a-o&255;for(p[0]&=~f,i=0;i<n;i++)p.push(h.charCodeAt(i));return p.push(188),wr(this.doPrivate(new lt(p)).toString(16),this.n.bitLength())},Wt.prototype.verify=function(e,t){var r=$t(t=(t=t.replace(br,"")).replace(/[ \n]+/g,""),16);if(r.bitLength()>this.n.bitLength())return 0;var i=xr(this.doPublic(r).toString(16).replace(/^1f+00/,""));if(0==i.length)return!1;var s,n=i[0];return i[1]==(s=e,Xt.crypto.Util.hashString(s,n))},Wt.prototype.verifyWithMessageHash=function(e,t){var r=$t(t=(t=t.replace(br,"")).replace(/[ \n]+/g,""),16);if(r.bitLength()>this.n.bitLength())return 0;var i=xr(this.doPublic(r).toString(16).replace(/^1f+00/,""));if(0==i.length)return!1;i[0];return i[1]==e},Wt.prototype.verifyPSS=function(e,t,r,i){var s,n=(s=lr(e),Xt.crypto.Util.hashHex(s,r));return void 0===i&&(i=-1),this.verifyWithMessageHashPSS(n,t,r,i)},Wt.prototype.verifyWithMessageHashPSS=function(e,t,r,i){var s=new lt(t,16);if(s.bitLength()>this.n.bitLength())return!1;var n,o=function(e){return Xt.crypto.Util.hashHex(e,r)},a=hr(e),u=a.length,c=this.n.bitLength()-1,h=Math.ceil(c/8);if(-1===i||void 0===i)i=u;else if(-2===i)i=h-u-2;else if(i<-2)throw"invalid salt length";if(h<u+i+2)throw"data too long";var l=this.doPublic(s).toByteArray();for(n=0;n<l.length;n+=1)l[n]&=255;for(;l.length<h;)l.unshift(0);if(188!==l[h-1])throw"encoded message does not end in 0xbc";var d=(l=String.fromCharCode.apply(String,l)).substr(0,h-u-1),g=l.substr(d.length,u),p=65280>>8*h-c&255;if(0!=(d.charCodeAt(0)&p))throw"bits beyond keysize not zero";var f=Er(g,d.length,o),v=[];for(n=0;n<d.length;n+=1)v[n]=d.charCodeAt(n)^f.charCodeAt(n);v[0]&=~p;var m=h-u-i-2;for(n=0;n<m;n+=1)if(0!==v[n])throw"leftmost octets not zero";if(1!==v[m])throw"0x01 marker not found";return g===hr(o(lr("\0\0\0\0\0\0\0\0"+a+String.fromCharCode.apply(String,v.slice(-i)))))},Wt.SALT_LEN_HLEN=-1,Wt.SALT_LEN_MAX=-2,Wt.SALT_LEN_RECOVER=-2,kr.hex2dn=function(e,t){if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw"malformed DN";for(var r=new Array,i=tr.getChildIdx(e,t),s=0;s<i.length;s++)r.push(kr.hex2rdn(e,i[s]));return"/"+(r=r.map(function(e){return e.replace("/","\\/")})).join("/")},kr.hex2rdn=function(e,t){if(void 0===t&&(t=0),"31"!==e.substr(t,2))throw"malformed RDN";for(var r=new Array,i=tr.getChildIdx(e,t),s=0;s<i.length;s++)r.push(kr.hex2attrTypeValue(e,i[s]));return(r=r.map(function(e){return e.replace("+","\\+")})).join("+")},kr.hex2attrTypeValue=function(e,t){var r=tr,i=r.getV;if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw"malformed attribute type and value";var s=r.getChildIdx(e,t);2!==s.length||e.substr(s[0],2);var n=i(e,s[0]),o=Xt.asn1.ASN1Util.oidHexToInt(n);return Xt.asn1.x509.OID.oid2atype(o)+"="+hr(i(e,s[1]))},kr.getPublicKeyFromCertHex=function(e){var t=new kr;return t.readCertHex(e),t.getPublicKey()},kr.getPublicKeyFromCertPEM=function(e){var t=new kr;return t.readCertPEM(e),t.getPublicKey()},kr.getPublicKeyInfoPropOfCertPEM=function(e){var t,r,i=tr.getVbyList,s={};return s.algparam=null,(t=new kr).readCertPEM(e),r=t.getPublicKeyHex(),s.keyhex=i(r,0,[1],"03").substr(2),s.algoid=i(r,0,[0,0],"06"),"2a8648ce3d0201"===s.algoid&&(s.algparam=i(r,0,[0,1],"06")),s},kr.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==Xt&&Xt||(Xt={}),void 0!==Xt.jws&&Xt.jws||(Xt.jws={}),Xt.jws.JWS=function(){var e=Xt.jws.JWS.isSafeJSONString;this.parseJWS=function(t,r){if(void 0===this.parsedJWS||!r&&void 0===this.parsedJWS.sigvalH){var i=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==i)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var s=i[1],n=i[2],o=i[3],a=s+"."+n;if(this.parsedJWS={},this.parsedJWS.headB64U=s,this.parsedJWS.payloadB64U=n,this.parsedJWS.sigvalB64U=o,this.parsedJWS.si=a,!r){var u=ar(o),c=$t(u,16);this.parsedJWS.sigvalH=u,this.parsedJWS.sigvalBI=c}var h=er(s),l=er(n);if(this.parsedJWS.headS=h,this.parsedJWS.payloadS=l,!e(h,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+h}}},Xt.jws.JWS.sign=function(e,t,r,i,s){var n,o,a,u=Xt,c=u.jws.JWS,h=c.readSafeJSONString,l=c.isSafeJSONString,d=u.crypto,g=(d.ECDSA,d.Mac),p=d.Signature,f=JSON;if("string"!=typeof t&&"object"!=typeof t)throw"spHeader must be JSON string or object: "+t;if("object"==typeof t&&(o=t,n=f.stringify(o)),"string"==typeof t){if(!l(n=t))throw"JWS Head is not safe JSON string: "+n;o=h(n)}if(a=r,"object"==typeof r&&(a=f.stringify(r)),""!=e&&null!=e||void 0===o.alg||(e=o.alg),""!=e&&null!=e&&void 0===o.alg&&(o.alg=e,n=f.stringify(o)),e!==o.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+o.alg;var v=null;if(void 0===c.jwsalg2sigalg[e])throw"unsupported alg name: "+e;v=c.jwsalg2sigalg[e];var m=Zt(n)+"."+Zt(a),y="";if("Hmac"==v.substr(0,4)){if(void 0===i)throw"mac key shall be specified for HS* alg";var _=new g({alg:v,prov:"cryptojs",pass:i});_.updateString(m),y=_.doFinal()}else{var F;if(-1!=v.indexOf("withECDSA"))(F=new p({alg:v})).init(i,s),F.updateString(m),hASN1Sig=F.sign(),y=Xt.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig);else if("none"!=v)(F=new p({alg:v})).init(i,s),F.updateString(m),y=F.sign()}return m+"."+or(y)},Xt.jws.JWS.verify=function(e,t,r){var i,s=Xt,n=s.jws.JWS,o=n.readSafeJSONString,a=s.crypto,u=a.ECDSA,c=a.Mac,h=a.Signature;i=Wt;var l=e.split(".");if(3!==l.length)return!1;var d=l[0]+"."+l[1],g=ar(l[2]),p=o(er(l[0])),f=null,v=null;if(void 0===p.alg)throw"algorithm not specified in header";if((v=(f=p.alg).substr(0,2),null!=r&&"[object Array]"===Object.prototype.toString.call(r)&&r.length>0)&&-1==(":"+r.join(":")+":").indexOf(":"+f+":"))throw"algorithm '"+f+"' not accepted in the list";if("none"!=f&&null===t)throw"key shall be specified to verify.";if("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&(t=Sr.getKey(t)),!("RS"!=v&&"PS"!=v||t instanceof i))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==v&&!(t instanceof u))throw"key shall be a ECDSA obj for ES* algs";var m=null;if(void 0===n.jwsalg2sigalg[p.alg])throw"unsupported alg name: "+f;if("none"==(m=n.jwsalg2sigalg[f]))throw"not supported";if("Hmac"==m.substr(0,4)){if(void 0===t)throw"hexadecimal key shall be specified for HMAC";var y=new c({alg:m,pass:t});return y.updateString(d),g==y.doFinal()}if(-1!=m.indexOf("withECDSA")){var _,F=null;try{F=u.concatSigToASN1Sig(g)}catch(e){return!1}return(_=new h({alg:m})).init(t),_.updateString(d),_.verify(F)}return(_=new h({alg:m})).init(t),_.updateString(d),_.verify(g)},Xt.jws.JWS.parse=function(e){var t,r,i,s=e.split("."),n={};if(2!=s.length&&3!=s.length)throw"malformed sJWS: wrong number of '.' splitted elements";return t=s[0],r=s[1],3==s.length&&(i=s[2]),n.headerObj=Xt.jws.JWS.readSafeJSONString(er(t)),n.payloadObj=Xt.jws.JWS.readSafeJSONString(er(r)),n.headerPP=JSON.stringify(n.headerObj,null,"  "),null==n.payloadObj?n.payloadPP=er(r):n.payloadPP=JSON.stringify(n.payloadObj,null,"  "),void 0!==i&&(n.sigHex=ar(i)),n},Xt.jws.JWS.verifyJWT=function(e,t,r){var i=Xt.jws,s=i.JWS,n=s.readSafeJSONString,o=s.inArray,a=s.includedArray,u=e.split("."),c=u[0],h=u[1],l=(ar(u[2]),n(er(c))),d=n(er(h));if(void 0===l.alg)return!1;if(void 0===r.alg)throw"acceptField.alg shall be specified";if(!o(l.alg,r.alg))return!1;if(void 0!==d.iss&&"object"==typeof r.iss&&!o(d.iss,r.iss))return!1;if(void 0!==d.sub&&"object"==typeof r.sub&&!o(d.sub,r.sub))return!1;if(void 0!==d.aud&&"object"==typeof r.aud)if("string"==typeof d.aud){if(!o(d.aud,r.aud))return!1}else if("object"==typeof d.aud&&!a(d.aud,r.aud))return!1;var g=i.IntDate.getNow();return void 0!==r.verifyAt&&"number"==typeof r.verifyAt&&(g=r.verifyAt),void 0!==r.gracePeriod&&"number"==typeof r.gracePeriod||(r.gracePeriod=0),!(void 0!==d.exp&&"number"==typeof d.exp&&d.exp+r.gracePeriod<g)&&(!(void 0!==d.nbf&&"number"==typeof d.nbf&&g<d.nbf-r.gracePeriod)&&(!(void 0!==d.iat&&"number"==typeof d.iat&&g<d.iat-r.gracePeriod)&&((void 0===d.jti||void 0===r.jti||d.jti===r.jti)&&!!s.verify(e,t,r.alg))))},Xt.jws.JWS.includedArray=function(e,t){var r=Xt.jws.JWS.inArray;if(null===e)return!1;if("object"!=typeof e)return!1;if("number"!=typeof e.length)return!1;for(var i=0;i<e.length;i++)if(!r(e[i],t))return!1;return!0},Xt.jws.JWS.inArray=function(e,t){if(null===t)return!1;if("object"!=typeof t)return!1;if("number"!=typeof t.length)return!1;for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},Xt.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},Xt.jws.JWS.isSafeJSONString=function(e,t,r){var i=null;try{return"object"!=typeof(i=Qt(e))?0:i.constructor===Array?0:(t&&(t[r]=i),1)}catch(e){return 0}},Xt.jws.JWS.readSafeJSONString=function(e){var t=null;try{return"object"!=typeof(t=Qt(e))?null:t.constructor===Array?null:t}catch(e){return null}},Xt.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==t)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},Xt.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var t="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var r=lr(t);return or(Xt.crypto.Util.hashHex(r,"sha256"))},Xt.jws.IntDate={},Xt.jws.IntDate.get=function(e){var t=Xt.jws.IntDate,r=t.getNow,i=t.getZulu;if("now"==e)return r();if("now + 1hour"==e)return r()+3600;if("now + 1day"==e)return r()+86400;if("now + 1month"==e)return r()+2592e3;if("now + 1year"==e)return r()+31536e3;if(e.match(/Z$/))return i(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},Xt.jws.IntDate.getZulu=function(e){return fr(e)},Xt.jws.IntDate.getNow=function(){return~~(new Date/1e3)},Xt.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},Xt.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"};const{EDSA:Ar}=Xt.crypto,{DSA:Pr}=Xt.crypto,{Signature:Cr}=Xt.crypto,{MessageDigest:Rr}=Xt.crypto,{Mac:Tr}=Xt.crypto,{Cipher:Ir}=Xt.crypto,Dr=Xt.crypto,{jws:Nr}=Xt;const Hr=function({jws:e,KeyUtil:t,X509:r,crypto:i,hextob64u:s,b64tohex:n,AllowedSigningAlgs:o}){return class a{static parseJwt(t){Le.debug("JoseUtil.parseJwt");try{var r=e.JWS.parse(t);return{header:r.headerObj,payload:r.payloadObj}}catch(e){Le.error(e)}}static validateJwt(e,i,s,o,u,c,h){Le.debug("JoseUtil.validateJwt");try{if("RSA"===i.kty)if(i.e&&i.n)i=t.getKey(i);else{if(!i.x5c||!i.x5c.length)return Le.error("JoseUtil.validateJwt: RSA key missing key material",i),Promise.reject(new Error("RSA key missing key material"));var l=n(i.x5c[0]);i=r.getPublicKeyFromCertHex(l)}else{if("EC"!==i.kty)return Le.error("JoseUtil.validateJwt: Unsupported key type",i&&i.kty),Promise.reject(new Error("Unsupported key type: "+i&&i.kty));if(!(i.crv&&i.x&&i.y))return Le.error("JoseUtil.validateJwt: EC key missing key material",i),Promise.reject(new Error("EC key missing key material"));i=t.getKey(i)}return a._validateJwt(e,i,s,o,u,c,h)}catch(e){return Le.error(e&&e.message||e),Promise.reject("JWT validation failed")}}static validateJwtAttributes(e,t,r,i,s,n){i||(i=0),s||(s=parseInt(Date.now()/1e3));var o=a.parseJwt(e).payload;if(!o.iss)return Le.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(o.iss!==t)return Le.error("JoseUtil._validateJwt: Invalid issuer in token",o.iss),Promise.reject(new Error("Invalid issuer in token: "+o.iss));if(!o.aud)return Le.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(o.aud===r||Array.isArray(o.aud)&&o.aud.indexOf(r)>=0))return Le.error("JoseUtil._validateJwt: Invalid audience in token",o.aud),Promise.reject(new Error("Invalid audience in token: "+o.aud));if(o.azp&&o.azp!==r)return Le.error("JoseUtil._validateJwt: Invalid azp in token",o.azp),Promise.reject(new Error("Invalid azp in token: "+o.azp));if(!n){var u=s+i,c=s-i;if(!o.iat)return Le.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(u<o.iat)return Le.error("JoseUtil._validateJwt: iat is in the future",o.iat),Promise.reject(new Error("iat is in the future: "+o.iat));if(o.nbf&&u<o.nbf)return Le.error("JoseUtil._validateJwt: nbf is in the future",o.nbf),Promise.reject(new Error("nbf is in the future: "+o.nbf));if(!o.exp)return Le.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(o.exp<c)return Le.error("JoseUtil._validateJwt: exp is in the past",o.exp),Promise.reject(new Error("exp is in the past:"+o.exp))}return Promise.resolve(o)}static _validateJwt(t,r,i,s,n,u,c){return a.validateJwtAttributes(t,i,s,n,u,c).then(i=>{try{return e.JWS.verify(t,r,o)?i:(Le.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(e){return Le.error(e&&e.message||e),Promise.reject(new Error("signature validation failed"))}})}static hashString(e,t){try{return i.Util.hashString(e,t)}catch(e){Le.error(e)}}static hexToBase64Url(e){try{return s(e)}catch(e){Le.error(e)}}}}({jws:Nr,KeyUtil:Sr,X509:kr,crypto:Dr,hextob64u:or,b64tohex:ht,AllowedSigningAlgs:["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]});class Br{constructor(e,t=Ye,r=Xe,i=Hr){if(!e)throw Le.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new r(this._settings),this._joseUtil=i}getClaims(e){return e?this._metadataService.getUserInfoEndpoint().then(t=>(Le.debug("UserInfoService.getClaims: received userinfo url",t),this._jsonService.getJson(t,e).then(e=>(Le.debug("UserInfoService.getClaims: claims received",e),e)))):(Le.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))}_getClaimsFromJwt(e){try{let r=this._joseUtil.parseJwt(e.responseText);if(!r||!r.header||!r.payload)return Le.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",r),Promise.reject(new Error("Failed to parse id_token"));var t=r.header.kid;let i;switch(this._settings.userInfoJwtIssuer){case"OP":i=this._metadataService.getIssuer();break;case"ANY":i=Promise.resolve(r.payload.iss);break;default:i=Promise.resolve(this._settings.userInfoJwtIssuer)}return i.then(i=>(Le.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+i),this._metadataService.getSigningKeys().then(s=>{if(!s)return Le.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));let n;if(Le.debug("UserInfoService._getClaimsFromJwt: Received signing keys"),t)n=s.filter(e=>e.kid===t)[0];else{if((s=this._filterByAlg(s,r.header.alg)).length>1)return Le.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));n=s[0]}if(!n)return Le.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));let o=this._settings.client_id,a=this._settings.clockSkew;return Le.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",a),this._joseUtil.validateJwt(e.responseText,n,i,o,a,void 0,!0).then(()=>(Le.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),r.payload))})))}catch(e){return Le.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",e.message),void reject(e)}}_filterByAlg(e,t){var r=null;if(t.startsWith("RS"))r="RSA";else if(t.startsWith("PS"))r="PS";else{if(!t.startsWith("ES"))return Le.debug("UserInfoService._filterByAlg: alg not supported: ",t),[];r="EC"}return Le.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",r),e=e.filter(e=>e.kty===r),Le.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",r,e.length),e}}class Ur{constructor(e,t=Ye,r=Xe){if(!e)throw Le.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t,this._metadataService=new r(this._settings)}exchangeCode(e={}){return(e=Object.assign({},e)).grant_type=e.grant_type||"authorization_code",e.client_id=e.client_id||this._settings.client_id,e.redirect_uri=e.redirect_uri||this._settings.redirect_uri,e.code?e.redirect_uri?e.code_verifier?e.client_id?this._metadataService.getTokenEndpoint(!1).then(t=>(Le.debug("TokenClient.exchangeCode: Received token endpoint"),this._jsonService.postForm(t,e).then(e=>(Le.debug("TokenClient.exchangeCode: response received"),e)))):(Le.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(Le.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(Le.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(Le.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))}exchangeRefreshToken(e={}){return(e=Object.assign({},e)).grant_type=e.grant_type||"refresh_token",e.client_id=e.client_id||this._settings.client_id,e.client_secret=e.client_secret||this._settings.client_secret,e.refresh_token?e.client_id?this._metadataService.getTokenEndpoint(!1).then(t=>(Le.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),this._jsonService.postForm(t,e).then(e=>(Le.debug("TokenClient.exchangeRefreshToken: response received"),e)))):(Le.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(Le.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))}}class jr extends Error{constructor({error:e,error_description:t,error_uri:r,state:i,session_state:s}={}){if(!e)throw Le.error("No error passed to ErrorResponse"),new Error("error");super(t||e),this.name="ErrorResponse",this.error=e,this.error_description=t,this.error_uri=r,this.state=i,this.session_state=s}}const Or=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];class Mr{constructor(e,t=Xe,r=Br,i=Hr,s=Ur){if(!e)throw Le.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=e,this._metadataService=new t(this._settings),this._userInfoService=new r(this._settings),this._joseUtil=i,this._tokenClient=new s(this._settings)}validateSigninResponse(e,t){return Le.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(e,t).then(t=>(Le.debug("ResponseValidator.validateSigninResponse: state processed"),this._validateTokens(e,t).then(t=>(Le.debug("ResponseValidator.validateSigninResponse: tokens validated"),this._processClaims(e,t).then(e=>(Le.debug("ResponseValidator.validateSigninResponse: claims processed"),e))))))}validateSignoutResponse(e,t){return e.id!==t.state?(Le.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(Le.debug("ResponseValidator.validateSignoutResponse: state validated"),t.state=e.data,t.error?(Le.warn("ResponseValidator.validateSignoutResponse: Response was error",t.error),Promise.reject(new jr(t))):Promise.resolve(t))}_processSigninParams(e,t){if(e.id!==t.state)return Le.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!e.client_id)return Le.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!e.authority)return Le.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==e.authority)return Le.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=e.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==e.client_id)return Le.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=e.client_id;return Le.debug("ResponseValidator._processSigninParams: state validated"),t.state=e.data,t.error?(Le.warn("ResponseValidator._processSigninParams: Response was error",t.error),Promise.reject(new jr(t))):e.nonce&&!t.id_token?(Le.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!e.nonce&&t.id_token?(Le.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):e.code_verifier&&!t.code?(Le.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!e.code_verifier&&t.code?(Le.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(t.scope||(t.scope=e.scope),Promise.resolve(t))}_processClaims(e,t){if(t.isOpenIdConnect){if(Le.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),t.profile=this._filterProtocolClaims(t.profile),!0!==e.skipUserInfo&&this._settings.loadUserInfo&&t.access_token)return Le.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(t.access_token).then(e=>(Le.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),e.sub!==t.profile.sub?(Le.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in access_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in access_token"))):(t.profile=this._mergeClaims(t.profile,e),Le.debug("ResponseValidator._processClaims: user info claims received, updated profile:",t.profile),t)));Le.debug("ResponseValidator._processClaims: not loading user info")}else Le.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(t)}_mergeClaims(e,t){var r=Object.assign({},e);for(let e in t){var i=t[e];Array.isArray(i)||(i=[i]);for(let t=0;t<i.length;t++){let s=i[t];r[e]?Array.isArray(r[e])?r[e].indexOf(s)<0&&r[e].push(s):r[e]!==s&&(r[e]="object"==typeof s?this._mergeClaims(r[e],s):[r[e],s]):r[e]=s}}return r}_filterProtocolClaims(e){Le.debug("ResponseValidator._filterProtocolClaims, incoming claims:",e);var t=Object.assign({},e);return this._settings._filterProtocolClaims?(Or.forEach(e=>{delete t[e]}),Le.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",t)):Le.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),t}_validateTokens(e,t){return t.code?(Le.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(e,t)):t.id_token?t.access_token?(Le.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(e,t)):(Le.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(e,t)):(Le.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(t))}_processCode(e,t){var r={client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier};return e.extraTokenParams&&"object"==typeof e.extraTokenParams&&Object.assign(r,e.extraTokenParams),this._tokenClient.exchangeCode(r).then(r=>{for(var i in r)t[i]=r[i];return t.id_token?(Le.debug("ResponseValidator._processCode: token response successful, processing id_token"),this._validateIdTokenAttributes(e,t)):(Le.debug("ResponseValidator._processCode: token response successful, returning response"),t)})}_validateIdTokenAttributes(e,t){return this._metadataService.getIssuer().then(r=>{let i=e.client_id,s=this._settings.clockSkew;return Le.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",s),this._joseUtil.validateJwtAttributes(t.id_token,r,i,s).then(r=>e.nonce&&e.nonce!==r.nonce?(Le.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):r.sub?(t.profile=r,t):(Le.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token"))))})}_validateIdTokenAndAccessToken(e,t){return this._validateIdToken(e,t).then(e=>this._validateAccessToken(e))}_validateIdToken(e,t){if(!e.nonce)return Le.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));let r=this._joseUtil.parseJwt(t.id_token);if(!r||!r.header||!r.payload)return Le.error("ResponseValidator._validateIdToken: Failed to parse id_token",r),Promise.reject(new Error("Failed to parse id_token"));if(e.nonce!==r.payload.nonce)return Le.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"));var i=r.header.kid;return this._metadataService.getIssuer().then(s=>(Le.debug("ResponseValidator._validateIdToken: Received issuer"),this._metadataService.getSigningKeys().then(n=>{if(!n)return Le.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));let o;if(Le.debug("ResponseValidator._validateIdToken: Received signing keys"),i)o=n.filter(e=>e.kid===i)[0];else{if((n=this._filterByAlg(n,r.header.alg)).length>1)return Le.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));o=n[0]}if(!o)return Le.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));let a=e.client_id,u=this._settings.clockSkew;return Le.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",u),this._joseUtil.validateJwt(t.id_token,o,s,a,u).then(()=>(Le.debug("ResponseValidator._validateIdToken: JWT validation successful"),r.payload.sub?(t.profile=r.payload,t):(Le.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))))})))}_filterByAlg(e,t){var r=null;if(t.startsWith("RS"))r="RSA";else if(t.startsWith("PS"))r="PS";else{if(!t.startsWith("ES"))return Le.debug("ResponseValidator._filterByAlg: alg not supported: ",t),[];r="EC"}return Le.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",r),e=e.filter(e=>e.kty===r),Le.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",r,e.length),e}_validateAccessToken(e){if(!e.profile)return Le.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!e.profile.at_hash)return Le.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!e.id_token)return Le.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));let t=this._joseUtil.parseJwt(e.id_token);if(!t||!t.header)return Le.error("ResponseValidator._validateAccessToken: Failed to parse id_token",t),Promise.reject(new Error("Failed to parse id_token"));var r=t.header.alg;if(!r||5!==r.length)return Le.error("ResponseValidator._validateAccessToken: Unsupported alg:",r),Promise.reject(new Error("Unsupported alg: "+r));var i=r.substr(2,3);if(!i)return Le.error("ResponseValidator._validateAccessToken: Unsupported alg:",r,i),Promise.reject(new Error("Unsupported alg: "+r));if(256!==(i=parseInt(i))&&384!==i&&512!==i)return Le.error("ResponseValidator._validateAccessToken: Unsupported alg:",r,i),Promise.reject(new Error("Unsupported alg: "+r));let s="sha"+i;var n=this._joseUtil.hashString(e.access_token,s);if(!n)return Le.error("ResponseValidator._validateAccessToken: access_token hash failed:",s),Promise.reject(new Error("Failed to validate at_hash"));var o=n.substr(0,n.length/2),a=this._joseUtil.hexToBase64Url(o);return a!==e.profile.at_hash?(Le.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",a,e.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(Le.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(e))}}const Vr=".well-known/openid-configuration",Kr="id_token",qr="openid",Lr=900,$r=300;class Jr{constructor({authority:e,metadataUrl:t,metadata:r,signingKeys:i,client_id:s,client_secret:n,response_type:o=Kr,scope:a=qr,redirect_uri:u,post_logout_redirect_uri:c,prompt:h,display:l,max_age:d,ui_locales:g,acr_values:p,resource:f,response_mode:v,filterProtocolClaims:m=!0,loadUserInfo:y=!0,staleStateAge:_=Lr,clockSkew:F=$r,userInfoJwtIssuer:S="OP",stateStore:b=new Ge,ResponseValidatorCtor:w=Mr,MetadataServiceCtor:E=Xe,extraQueryParams:x={},extraTokenParams:k={}}={}){this._authority=e,this._metadataUrl=t,this._metadata=r,this._signingKeys=i,this._client_id=s,this._client_secret=n,this._response_type=o,this._scope=a,this._redirect_uri=u,this._post_logout_redirect_uri=c,this._prompt=h,this._display=l,this._max_age=d,this._ui_locales=g,this._acr_values=p,this._resource=f,this._response_mode=v,this._filterProtocolClaims=!!m,this._loadUserInfo=!!y,this._staleStateAge=_,this._clockSkew=F,this._userInfoJwtIssuer=S,this._stateStore=b,this._validator=new w(this),this._metadataService=new E(this),this._extraQueryParams="object"==typeof x?x:{},this._extraTokenParams="object"==typeof k?k:{}}get client_id(){return this._client_id}set client_id(e){if(this._client_id)throw Le.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=e}get client_secret(){return this._client_secret}get response_type(){return this._response_type}get scope(){return this._scope}get redirect_uri(){return this._redirect_uri}get post_logout_redirect_uri(){return this._post_logout_redirect_uri}get prompt(){return this._prompt}get display(){return this._display}get max_age(){return this._max_age}get ui_locales(){return this._ui_locales}get acr_values(){return this._acr_values}get resource(){return this._resource}get response_mode(){return this._response_mode}get authority(){return this._authority}set authority(e){if(this._authority)throw Le.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=e}get metadataUrl(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(Vr)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=Vr)),this._metadataUrl}get metadata(){return this._metadata}set metadata(e){this._metadata=e}get signingKeys(){return this._signingKeys}set signingKeys(e){this._signingKeys=e}get filterProtocolClaims(){return this._filterProtocolClaims}get loadUserInfo(){return this._loadUserInfo}get staleStateAge(){return this._staleStateAge}get clockSkew(){return this._clockSkew}get userInfoJwtIssuer(){return this._userInfoJwtIssuer}get stateStore(){return this._stateStore}get validator(){return this._validator}get metadataService(){return this._metadataService}get extraQueryParams(){return this._extraQueryParams}set extraQueryParams(e){this._extraQueryParams="object"==typeof e?e:{}}get extraTokenParams(){return this._extraTokenParams}set extraTokenParams(e){this._extraTokenParams="object"==typeof e?e:{}}}class Wr{static addQueryParam(e,t,r){return e.indexOf("?")<0&&(e+="?"),"?"!==e[e.length-1]&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(r)}static parseUrlFragment(e,t="#",r=ze){"string"!=typeof e&&(e=r.location.href);var i=e.lastIndexOf(t);i>=0&&(e=e.substr(i+1)),"?"===t&&(i=e.indexOf("#"))>=0&&(e=e.substr(0,i));for(var s,n={},o=/([^&=]+)=([^&]*)/g,a=0;s=o.exec(e);)if(n[decodeURIComponent(s[1])]=decodeURIComponent(s[2]),a++>50)return Le.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",e),{error:"Response exceeded expected number of parameters"};for(var u in n)return n;return{}}}var zr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Gr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Yr(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}function Qr(e){return e&&e.default||e}for(var Xr=Yr(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}}),Zr=[],ei=0;ei<256;++ei)Zr[ei]=(ei+256).toString(16).substr(1);var ti=function(e,t){var r=t||0,i=Zr;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")};var ri=function(e,t,r){var i=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||Xr)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var n=0;n<16;++n)t[i+n]=s[n];return t||ti(s)};function ii(){return ri().replace(/-/g,"")}class si{constructor({id:e,data:t,created:r,request_type:i}={}){this._id=e||ii(),this._data=t,this._created="number"==typeof r&&r>0?r:parseInt(Date.now()/1e3),this._request_type=i}get id(){return this._id}get data(){return this._data}get created(){return this._created}get request_type(){return this._request_type}toStorageString(){return Le.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})}static fromStorageString(e){return Le.debug("State.fromStorageString"),new si(JSON.parse(e))}static clearStaleState(e,t){var r=Date.now()/1e3-t;return e.getAllKeys().then(t=>{Le.debug("State.clearStaleState: got keys",t);var i=[];for(let n=0;n<t.length;n++){let o=t[n];var s=e.get(o).then(t=>{let i=!1;if(t)try{var s=si.fromStorageString(t);Le.debug("State.clearStaleState: got item from key: ",o,s.created),s.created<=r&&(i=!0)}catch(e){Le.error("State.clearStaleState: Error parsing state for key",o,e.message),i=!0}else Le.debug("State.clearStaleState: no item in storage for key: ",o),i=!0;if(i)return Le.debug("State.clearStaleState: removed item for key: ",o),e.remove(o)});i.push(s)}return Le.debug("State.clearStaleState: waiting on promise count:",i.length),Promise.all(i)})}}class ni extends si{constructor({nonce:e,authority:t,client_id:r,redirect_uri:i,code_verifier:s,response_mode:n,client_secret:o,scope:a,extraTokenParams:u,skipUserInfo:c}={}){if(super(arguments[0]),!0===e?this._nonce=ii():e&&(this._nonce=e),!0===s?this._code_verifier=ii()+ii()+ii():s&&(this._code_verifier=s),this.code_verifier){let e=Hr.hashString(this.code_verifier,"SHA256");this._code_challenge=Hr.hexToBase64Url(e)}this._redirect_uri=i,this._authority=t,this._client_id=r,this._response_mode=n,this._client_secret=o,this._scope=a,this._extraTokenParams=u,this._skipUserInfo=c}get nonce(){return this._nonce}get authority(){return this._authority}get client_id(){return this._client_id}get redirect_uri(){return this._redirect_uri}get code_verifier(){return this._code_verifier}get code_challenge(){return this._code_challenge}get response_mode(){return this._response_mode}get client_secret(){return this._client_secret}get scope(){return this._scope}get extraTokenParams(){return this._extraTokenParams}get skipUserInfo(){return this._skipUserInfo}toStorageString(){return Le.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){Le.debug("SigninState.fromStorageString");var t=JSON.parse(e);return new ni(t)}}class oi{constructor({url:e,client_id:t,redirect_uri:r,response_type:i,scope:s,authority:n,data:o,prompt:a,display:u,max_age:c,ui_locales:h,id_token_hint:l,login_hint:d,acr_values:g,resource:p,response_mode:f,request:v,request_uri:m,extraQueryParams:y,request_type:_,client_secret:F,extraTokenParams:S,skipUserInfo:b}){if(!e)throw Le.error("SigninRequest.ctor: No url passed"),new Error("url");if(!t)throw Le.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!r)throw Le.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!i)throw Le.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!s)throw Le.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!n)throw Le.error("SigninRequest.ctor: No authority passed"),new Error("authority");let w=oi.isOidc(i),E=oi.isCode(i);f||(f=oi.isCode(i)?"query":null),this.state=new ni({nonce:w,data:o,client_id:t,authority:n,redirect_uri:r,code_verifier:E,request_type:_,response_mode:f,client_secret:F,scope:s,extraTokenParams:S,skipUserInfo:b}),e=Wr.addQueryParam(e,"client_id",t),e=Wr.addQueryParam(e,"redirect_uri",r),e=Wr.addQueryParam(e,"response_type",i),e=Wr.addQueryParam(e,"scope",s),e=Wr.addQueryParam(e,"state",this.state.id),w&&(e=Wr.addQueryParam(e,"nonce",this.state.nonce)),E&&(e=Wr.addQueryParam(e,"code_challenge",this.state.code_challenge),e=Wr.addQueryParam(e,"code_challenge_method","S256"));var x={prompt:a,display:u,max_age:c,ui_locales:h,id_token_hint:l,login_hint:d,acr_values:g,resource:p,request:v,request_uri:m,response_mode:f};for(let t in x)x[t]&&(e=Wr.addQueryParam(e,t,x[t]));for(let t in y)e=Wr.addQueryParam(e,t,y[t]);this.url=e}static isOidc(e){return!!e.split(/\s+/g).filter(function(e){return"id_token"===e})[0]}static isOAuth(e){return!!e.split(/\s+/g).filter(function(e){return"token"===e})[0]}static isCode(e){return!!e.split(/\s+/g).filter(function(e){return"code"===e})[0]}}const ai="openid";class ui{constructor(e,t="#"){var r=Wr.parseUrlFragment(e,t);this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.code=r.code,this.state=r.state,this.id_token=r.id_token,this.session_state=r.session_state,this.access_token=r.access_token,this.token_type=r.token_type,this.scope=r.scope,this.profile=void 0,this.expires_in=r.expires_in}get expires_in(){if(this.expires_at){let e=parseInt(Date.now()/1e3);return this.expires_at-e}}set expires_in(e){let t=parseInt(e);if("number"==typeof t&&t>0){let e=parseInt(Date.now()/1e3);this.expires_at=e+t}}get expired(){let e=this.expires_in;if(void 0!==e)return e<=0}get scopes(){return(this.scope||"").split(" ")}get isOpenIdConnect(){return this.scopes.indexOf(ai)>=0||!!this.id_token}}class ci{constructor({url:e,id_token_hint:t,post_logout_redirect_uri:r,data:i,extraQueryParams:s,request_type:n}){if(!e)throw Le.error("SignoutRequest.ctor: No url passed"),new Error("url");t&&(e=Wr.addQueryParam(e,"id_token_hint",t)),r&&(e=Wr.addQueryParam(e,"post_logout_redirect_uri",r),i&&(this.state=new si({data:i,request_type:n}),e=Wr.addQueryParam(e,"state",this.state.id)));for(let t in s)e=Wr.addQueryParam(e,t,s[t]);this.url=e}}class hi{constructor(e){var t=Wr.parseUrlFragment(e,"?");this.error=t.error,this.error_description=t.error_description,this.error_uri=t.error_uri,this.state=t.state}}class li{constructor(e={}){this._settings=e instanceof Jr?e:new Jr(e)}get _stateStore(){return this.settings.stateStore}get _validator(){return this.settings.validator}get _metadataService(){return this.settings.metadataService}get settings(){return this._settings}get metadataService(){return this._metadataService}createSigninRequest({response_type:e,scope:t,redirect_uri:r,data:i,state:s,prompt:n,display:o,max_age:a,ui_locales:u,id_token_hint:c,login_hint:h,acr_values:l,resource:d,request:g,request_uri:p,response_mode:f,extraQueryParams:v,extraTokenParams:m,request_type:y,skipUserInfo:_}={},F){Le.debug("OidcClient.createSigninRequest");let S=this._settings.client_id;e=e||this._settings.response_type,t=t||this._settings.scope,r=r||this._settings.redirect_uri,n=n||this._settings.prompt,o=o||this._settings.display,a=a||this._settings.max_age,u=u||this._settings.ui_locales,l=l||this._settings.acr_values,d=d||this._settings.resource,f=f||this._settings.response_mode,v=v||this._settings.extraQueryParams,m=m||this._settings.extraTokenParams;let b=this._settings.authority;return oi.isCode(e)&&"code"!==e?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(w=>{Le.debug("OidcClient.createSigninRequest: Received authorization endpoint",w);let E=new oi({url:w,client_id:S,redirect_uri:r,response_type:e,scope:t,data:i||s,authority:b,prompt:n,display:o,max_age:a,ui_locales:u,id_token_hint:c,login_hint:h,acr_values:l,resource:d,request:g,request_uri:p,extraQueryParams:v,extraTokenParams:m,request_type:y,response_mode:f,client_secret:this._settings.client_secret,skipUserInfo:_});var x=E.state;return(F=F||this._stateStore).set(x.id,x.toStorageString()).then(()=>E)})}readSigninResponseState(e,t,r=!1){Le.debug("OidcClient.readSigninResponseState");let i="query"===this._settings.response_mode||!this._settings.response_mode&&oi.isCode(this._settings.response_type);var s=new ui(e,i?"?":"#");return s.state?(t=t||this._stateStore,(r?t.remove.bind(t):t.get.bind(t))(s.state).then(e=>{if(!e)throw Le.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:ni.fromStorageString(e),response:s}})):(Le.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response")))}processSigninResponse(e,t){return Le.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(e,t,!0).then(({state:e,response:t})=>(Le.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),this._validator.validateSigninResponse(e,t)))}createSignoutRequest({id_token_hint:e,data:t,state:r,post_logout_redirect_uri:i,extraQueryParams:s,request_type:n}={},o){return Le.debug("OidcClient.createSignoutRequest"),i=i||this._settings.post_logout_redirect_uri,s=s||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(a=>{if(!a)throw Le.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");Le.debug("OidcClient.createSignoutRequest: Received end session endpoint",a);let u=new ci({url:a,id_token_hint:e,post_logout_redirect_uri:i,data:t||r,extraQueryParams:s,request_type:n});var c=u.state;return c&&(Le.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(o=o||this._stateStore).set(c.id,c.toStorageString())),u})}readSignoutResponseState(e,t,r=!1){Le.debug("OidcClient.readSignoutResponseState");var i=new hi(e);if(!i.state)return Le.debug("OidcClient.readSignoutResponseState: No state in response"),i.error?(Le.warn("OidcClient.readSignoutResponseState: Response was error: ",i.error),Promise.reject(new jr(i))):Promise.resolve({undefined:void 0,response:i});var s=i.state;return t=t||this._stateStore,(r?t.remove.bind(t):t.get.bind(t))(s).then(e=>{if(!e)throw Le.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:si.fromStorageString(e),response:i}})}processSignoutResponse(e,t){return Le.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(e,t,!0).then(({state:e,response:t})=>e?(Le.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),this._validator.validateSignoutResponse(e,t)):(Le.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),t))}clearStaleState(e){return Le.debug("OidcClient.clearStaleState"),e=e||this._stateStore,si.clearStaleState(e,this.settings.staleStateAge)}}class di{prepare(){return Promise.resolve(this)}navigate(e){return e&&e.url?(e.useReplaceToNavigate?window.location.replace(e.url):window.location=e.url,Promise.resolve()):(Le.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))}get url(){return window.location.href}}const gi=500,pi="location=no,toolbar=no,width=500,height=500,left=100,top=100;",fi="_blank";class vi{constructor(e){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t});let t=e.popupWindowTarget||fi,r=e.popupWindowFeatures||pi;this._popup=window.open("",t,r),this._popup&&(Le.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),gi))}get promise(){return this._promise}navigate(e){return this._popup?e&&e.url?(Le.debug("PopupWindow.navigate: Setting URL in popup"),this._id=e.id,this._id&&(window["popupCallback_"+e.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=e.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise}_success(e){Le.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(e)}_error(e){Le.error("PopupWindow.error: ",e),this._cleanup(),this._reject(new Error(e))}close(){this._cleanup(!1)}_cleanup(e){Le.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!e&&this._popup.close(),this._popup=null}_checkForPopupClosed(){this._popup&&!this._popup.closed||this._error("Popup window closed")}_callback(e,t){this._cleanup(t),e?(Le.debug("PopupWindow.callback success"),this._success({url:e})):(Le.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))}static notifyOpener(e,t,r){if(window.opener){if(e=e||window.location.href){var i=Wr.parseUrlFragment(e,r);if(i.state){var s="popupCallback_"+i.state,n=window.opener[s];n?(Le.debug("PopupWindow.notifyOpener: passing url message to opener"),n(e,t)):Le.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else Le.warn("PopupWindow.notifyOpener: no state found in response url")}}else Le.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")}}class mi{prepare(e){let t=new vi(e);return Promise.resolve(t)}callback(e,t,r){Le.debug("PopupNavigator.callback");try{return vi.notifyOpener(e,t,r),Promise.resolve()}catch(e){return Promise.reject(e)}}}const yi=1e4;class _i{constructor(e){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,window.document.body.appendChild(this._frame)}navigate(e){if(e&&e.url){let t=e.silentRequestTimeout||yi;Le.debug("IFrameWindow.navigate: Using timeout of:",t),this._timer=window.setTimeout(this._timeout.bind(this),t),this._frame.src=e.url}else this._error("No url provided");return this.promise}get promise(){return this._promise}_success(e){this._cleanup(),Le.debug("IFrameWindow: Successful response from frame window"),this._resolve(e)}_error(e){this._cleanup(),Le.error(e),this._reject(new Error(e))}close(){this._cleanup()}_cleanup(){this._frame&&(Le.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)}_timeout(){Le.debug("IFrameWindow.timeout"),this._error("Frame window timed out")}_message(e){if(Le.debug("IFrameWindow.message"),this._timer&&e.origin===this._origin&&e.source===this._frame.contentWindow){let t=e.data;t?this._success({url:t}):this._error("Invalid response from frame")}}get _origin(){return location.protocol+"//"+location.host}static notifyParent(e){Le.debug("IFrameWindow.notifyParent"),window.frameElement&&(e=e||window.location.href)&&(Le.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(e,location.protocol+"//"+location.host))}}class Fi{prepare(e){let t=new _i(e);return Promise.resolve(t)}callback(e){Le.debug("IFrameNavigator.callback");try{return _i.notifyParent(e),Promise.resolve()}catch(e){return Promise.reject(e)}}}const Si=60,bi=2e3;class wi extends Jr{constructor({popup_redirect_uri:e,popup_post_logout_redirect_uri:t,popupWindowFeatures:r,popupWindowTarget:i,silent_redirect_uri:s,silentRequestTimeout:n,automaticSilentRenew:o=!1,validateSubOnSilentRenew:a=!1,includeIdTokenInSilentRenew:u=!0,monitorSession:c=!0,monitorAnonymousSession:h=!1,checkSessionInterval:l=bi,stopCheckSessionOnError:d=!0,query_status_response_type:g,revokeAccessTokenOnSignout:p=!1,accessTokenExpiringNotificationTime:f=Si,redirectNavigator:v=new di,popupNavigator:m=new mi,iframeNavigator:y=new Fi,userStore:_=new Ge({store:ze.sessionStorage})}={}){super(arguments[0]),this._popup_redirect_uri=e,this._popup_post_logout_redirect_uri=t,this._popupWindowFeatures=r,this._popupWindowTarget=i,this._silent_redirect_uri=s,this._silentRequestTimeout=n,this._automaticSilentRenew=o,this._validateSubOnSilentRenew=a,this._includeIdTokenInSilentRenew=u,this._accessTokenExpiringNotificationTime=f,this._monitorSession=c,this._monitorAnonymousSession=h,this._checkSessionInterval=l,this._stopCheckSessionOnError=d,g?this._query_status_response_type=g:arguments[0]&&arguments[0].response_type?this._query_status_response_type=oi.isOidc(arguments[0].response_type)?"id_token":"code":this._query_status_response_type="id_token",this._revokeAccessTokenOnSignout=p,this._redirectNavigator=v,this._popupNavigator=m,this._iframeNavigator=y,this._userStore=_}get popup_redirect_uri(){return this._popup_redirect_uri}get popup_post_logout_redirect_uri(){return this._popup_post_logout_redirect_uri}get popupWindowFeatures(){return this._popupWindowFeatures}get popupWindowTarget(){return this._popupWindowTarget}get silent_redirect_uri(){return this._silent_redirect_uri}get silentRequestTimeout(){return this._silentRequestTimeout}get automaticSilentRenew(){return this._automaticSilentRenew}get validateSubOnSilentRenew(){return this._validateSubOnSilentRenew}get includeIdTokenInSilentRenew(){return this._includeIdTokenInSilentRenew}get accessTokenExpiringNotificationTime(){return this._accessTokenExpiringNotificationTime}get monitorSession(){return this._monitorSession}get monitorAnonymousSession(){return this._monitorAnonymousSession}get checkSessionInterval(){return this._checkSessionInterval}get stopCheckSessionOnError(){return this._stopCheckSessionOnError}get query_status_response_type(){return this._query_status_response_type}get revokeAccessTokenOnSignout(){return this._revokeAccessTokenOnSignout}get redirectNavigator(){return this._redirectNavigator}get popupNavigator(){return this._popupNavigator}get iframeNavigator(){return this._iframeNavigator}get userStore(){return this._userStore}}class Ei{constructor({id_token:e,session_state:t,access_token:r,refresh_token:i,token_type:s,scope:n,profile:o,expires_at:a,state:u}){this.id_token=e,this.session_state=t,this.access_token=r,this.refresh_token=i,this.token_type=s,this.scope=n,this.profile=o,this.expires_at=a,this.state=u}get expires_in(){if(this.expires_at){let e=parseInt(Date.now()/1e3);return this.expires_at-e}}set expires_in(e){let t=parseInt(e);if("number"==typeof t&&t>0){let e=parseInt(Date.now()/1e3);this.expires_at=e+t}}get expired(){let e=this.expires_in;if(void 0!==e)return e<=0}get scopes(){return(this.scope||"").split(" ")}toStorageString(){return Le.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}static fromStorageString(e){return Le.debug("User.fromStorageString"),new Ei(JSON.parse(e))}}class xi{constructor(e){this._name=e,this._callbacks=[]}addHandler(e){this._callbacks.push(e)}removeHandler(e){var t=this._callbacks.findIndex(t=>t===e);t>=0&&this._callbacks.splice(t,1)}raise(...e){Le.debug("Event: Raising event: "+this._name);for(let t=0;t<this._callbacks.length;t++)this._callbacks[t](...e)}}const ki=5;class Ai extends xi{constructor(e,t=ze.timer,r){super(e),this._timer=t,this._nowFunc=r||(()=>Date.now()/1e3)}get now(){return parseInt(this._nowFunc())}init(e){e<=0&&(e=1),e=parseInt(e);var t=this.now+e;if(this.expiration===t&&this._timerHandle)Le.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),Le.debug("Timer.init timer "+this._name+" for duration:",e),this._expiration=t;var r=ki;e<r&&(r=e),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*r)}}get expiration(){return this._expiration}cancel(){this._timerHandle&&(Le.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)}_callback(){var e=this._expiration-this.now;Le.debug("Timer.callback; "+this._name+" timer expires in:",e),this._expiration<=this.now&&(this.cancel(),super.raise())}}const Pi=60;class Ci{constructor({accessTokenExpiringNotificationTime:e=Pi,accessTokenExpiringTimer:t=new Ai("Access token expiring"),accessTokenExpiredTimer:r=new Ai("Access token expired")}={}){this._accessTokenExpiringNotificationTime=e,this._accessTokenExpiring=t,this._accessTokenExpired=r}load(e){if(e.access_token&&void 0!==e.expires_in){let t=e.expires_in;if(Le.debug("AccessTokenEvents.load: access token present, remaining duration:",t),t>0){let e=t-this._accessTokenExpiringNotificationTime;e<=0&&(e=1),Le.debug("AccessTokenEvents.load: registering expiring timer in:",e),this._accessTokenExpiring.init(e)}else Le.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();let r=t+1;Le.debug("AccessTokenEvents.load: registering expired timer in:",r),this._accessTokenExpired.init(r)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()}unload(){Le.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()}addAccessTokenExpiring(e){this._accessTokenExpiring.addHandler(e)}removeAccessTokenExpiring(e){this._accessTokenExpiring.removeHandler(e)}addAccessTokenExpired(e){this._accessTokenExpired.addHandler(e)}removeAccessTokenExpired(e){this._accessTokenExpired.removeHandler(e)}}class Ri extends Ci{constructor(e){super(e),this._userLoaded=new xi("User loaded"),this._userUnloaded=new xi("User unloaded"),this._silentRenewError=new xi("Silent renew error"),this._userSignedIn=new xi("User signed in"),this._userSignedOut=new xi("User signed out"),this._userSessionChanged=new xi("User session changed")}load(e,t=!0){Le.debug("UserManagerEvents.load"),super.load(e),t&&this._userLoaded.raise(e)}unload(){Le.debug("UserManagerEvents.unload"),super.unload(),this._userUnloaded.raise()}addUserLoaded(e){this._userLoaded.addHandler(e)}removeUserLoaded(e){this._userLoaded.removeHandler(e)}addUserUnloaded(e){this._userUnloaded.addHandler(e)}removeUserUnloaded(e){this._userUnloaded.removeHandler(e)}addSilentRenewError(e){this._silentRenewError.addHandler(e)}removeSilentRenewError(e){this._silentRenewError.removeHandler(e)}_raiseSilentRenewError(e){Le.debug("UserManagerEvents._raiseSilentRenewError",e.message),this._silentRenewError.raise(e)}addUserSignedIn(e){this._userSignedIn.addHandler(e)}removeUserSignedIn(e){this._userSignedIn.removeHandler(e)}_raiseUserSignedIn(){Le.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()}addUserSignedOut(e){this._userSignedOut.addHandler(e)}removeUserSignedOut(e){this._userSignedOut.removeHandler(e)}_raiseUserSignedOut(){Le.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()}addUserSessionChanged(e){this._userSessionChanged.addHandler(e)}removeUserSessionChanged(e){this._userSessionChanged.removeHandler(e)}_raiseUserSessionChanged(){Le.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()}}class Ti{constructor(e){this._userManager=e}start(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(e=>{}).catch(e=>{Le.error("SilentRenewService.start: Error from getUser:",e.message)}))}stop(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)}_tokenExpiring(){this._userManager.signinSilent().then(e=>{Le.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},e=>{Le.error("SilentRenewService._tokenExpiring: Error from signinSilent:",e.message),this._userManager.events._raiseSilentRenewError(e)})}}const Ii=2e3;class Di{constructor(e,t,r,i,s=!0){this._callback=e,this._client_id=t,this._url=r,this._interval=i||Ii,this._stopOnError=s;var n=r.indexOf("/",r.indexOf("//")+2);this._frame_origin=r.substr(0,n),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,this._frame.src=r}load(){return new Promise(e=>{this._frame.onload=(()=>{e()}),window.document.body.appendChild(this._frame),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1)})}_message(e){e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(Le.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===e.data?(Le.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):Le.debug("CheckSessionIFrame: "+e.data+" message from check session op iframe"))}start(e){if(this._session_state!==e){Le.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=e;let t=()=>{this._frame.contentWindow.postMessage(this._client_id+" "+this._session_state,this._frame_origin)};t(),this._timer=window.setInterval(t,this._interval)}}stop(){this._session_state=null,this._timer&&(Le.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)}}class Ni{constructor(e,t=Di,r=ze.timer){if(!e)throw Le.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=e,this._CheckSessionIFrameCtor=t,this._timer=r,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),this._userManager.getUser().then(e=>{e?this._start(e):this._settings.monitorAnonymousSession&&this._userManager.querySessionStatus().then(e=>{let t={session_state:e.session_state};e.sub&&e.sid&&(t.profile={sub:e.sub,sid:e.sid}),this._start(t)}).catch(e=>{Le.error("SessionMonitor ctor: error from querySessionStatus:",e.message)})}).catch(e=>{Le.error("SessionMonitor ctor: error from getUser:",e.message)})}get _settings(){return this._userManager.settings}get _metadataService(){return this._userManager.metadataService}get _client_id(){return this._settings.client_id}get _checkSessionInterval(){return this._settings.checkSessionInterval}get _stopCheckSessionOnError(){return this._settings.stopCheckSessionOnError}_start(e){let t=e.session_state;t&&(e.profile?(this._sub=e.profile.sub,this._sid=e.profile.sid,Le.debug("SessionMonitor._start: session_state:",t,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,Le.debug("SessionMonitor._start: session_state:",t,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(t):this._metadataService.getCheckSessionIframe().then(e=>{if(e){Le.debug("SessionMonitor._start: Initializing check session iframe");let r=this._client_id,i=this._checkSessionInterval,s=this._stopCheckSessionOnError;this._checkSessionIFrame=new this._CheckSessionIFrameCtor(this._callback.bind(this),r,e,i,s),this._checkSessionIFrame.load().then(()=>{this._checkSessionIFrame.start(t)})}else Le.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(e=>{Le.error("SessionMonitor._start: Error from getCheckSessionIframe:",e.message)}))}_stop(){if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(Le.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession){let e=this._timer.setInterval(()=>{this._timer.clearInterval(e),this._userManager.querySessionStatus().then(e=>{let t={session_state:e.session_state};e.sub&&e.sid&&(t.profile={sub:e.sub,sid:e.sid}),this._start(t)}).catch(e=>{Le.error("SessionMonitor: error from querySessionStatus:",e.message)})},1e3)}}_callback(){this._userManager.querySessionStatus().then(e=>{var t=!0;e?e.sub===this._sub?(t=!1,this._checkSessionIFrame.start(e.session_state),e.sid===this._sid?Le.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",e.session_state):(Le.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",e.session_state),this._userManager.events._raiseUserSessionChanged())):Le.debug("SessionMonitor._callback: Different subject signed into OP:",e.sub):Le.debug("SessionMonitor._callback: Subject no longer signed into OP"),t&&(this._sub?(Le.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),this._userManager.events._raiseUserSignedOut()):(Le.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),this._userManager.events._raiseUserSignedIn()))}).catch(e=>{this._sub&&(Le.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",e.message),this._userManager.events._raiseUserSignedOut())})}}const Hi="access_token",Bi="refresh_token";class Ui{constructor(e,t=ze.XMLHttpRequest,r=Xe){if(!e)throw Le.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=e,this._XMLHttpRequestCtor=t,this._metadataService=new r(this._settings)}revoke(e,t,r="access_token"){if(!e)throw Le.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(r!==Hi&&r!=Bi)throw Le.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(i=>{if(i){Le.debug("TokenRevocationClient.revoke: Revoking "+r);var s=this._settings.client_id,n=this._settings.client_secret;return this._revoke(i,s,n,e,r)}if(t)throw Le.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})}_revoke(e,t,r,i,s){return new Promise((n,o)=>{var a=new this._XMLHttpRequestCtor;a.open("POST",e),a.onload=(()=>{Le.debug("TokenRevocationClient.revoke: HTTP response received, status",a.status),200===a.status?n():o(Error(a.statusText+" ("+a.status+")"))}),a.onerror=(()=>{Le.debug("TokenRevocationClient.revoke: Network Error."),o("Network Error")});var u="client_id="+encodeURIComponent(t);r&&(u+="&client_secret="+encodeURIComponent(r)),u+="&token_type_hint="+encodeURIComponent(s),u+="&token="+encodeURIComponent(i),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u)})}}const ji="location=no,toolbar=no,zoom=no",Oi="_blank";class Mi{constructor(e){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t}),this.features=e.popupWindowFeatures||ji,this.target=e.popupWindowTarget||Oi,this.redirect_uri=e.startUrl,Le.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}_isInAppBrowserInstalled(e){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(t){return e.hasOwnProperty(t)})}navigate(e){if(e&&e.url){if(!window.cordova)return this._error("cordova is undefined");var t=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(t))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(e.url,this.target,this.features),this._popup?(Le.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise}get promise(){return this._promise}_loadStartCallback(e){0===e.url.indexOf(this.redirect_uri)&&this._success({url:e.url})}_exitCallback(e){this._error(e)}_success(e){this._cleanup(),Le.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(e)}_error(e){this._cleanup(),Le.error(e),this._reject(new Error(e))}close(){this._cleanup()}_cleanup(){this._popup&&(Le.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null}}var Vi={Version:"1.10.1",Log:Le,OidcClient:li,OidcClientSettings:Jr,WebStorageStateStore:Ge,InMemoryWebStorage:class{constructor(){this._data={}}getItem(e){return Le.debug("InMemoryWebStorage.getItem",e),this._data[e]}setItem(e,t){Le.debug("InMemoryWebStorage.setItem",e),this._data[e]=t}removeItem(e){Le.debug("InMemoryWebStorage.removeItem",e),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},UserManager:class extends li{constructor(e={},t=Ti,r=Ni,i=Ui,s=Ur,n=Hr){e instanceof wi||(e=new wi(e)),super(e),this._events=new Ri(e),this._silentRenewService=new t(this),this.settings.automaticSilentRenew&&(Le.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),this.startSilentRenew()),this.settings.monitorSession&&(Le.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),this._sessionMonitor=new r(this)),this._tokenRevocationClient=new i(this._settings),this._tokenClient=new s(this._settings),this._joseUtil=n}get _redirectNavigator(){return this.settings.redirectNavigator}get _popupNavigator(){return this.settings.popupNavigator}get _iframeNavigator(){return this.settings.iframeNavigator}get _userStore(){return this.settings.userStore}get events(){return this._events}getUser(){return this._loadUser().then(e=>e?(Le.info("UserManager.getUser: user loaded"),this._events.load(e,!1),e):(Le.info("UserManager.getUser: user not found in storage"),null))}removeUser(){return this.storeUser(null).then(()=>{Le.info("UserManager.removeUser: user removed from storage"),this._events.unload()})}signinRedirect(e={}){(e=Object.assign({},e)).request_type="si:r";let t={useReplaceToNavigate:e.useReplaceToNavigate};return this._signinStart(e,this._redirectNavigator,t).then(()=>{Le.info("UserManager.signinRedirect: successful")})}signinRedirectCallback(e){return this._signinEnd(e||this._redirectNavigator.url).then(e=>(e.profile&&e.profile.sub?Le.info("UserManager.signinRedirectCallback: successful, signed in sub: ",e.profile.sub):Le.info("UserManager.signinRedirectCallback: no sub"),e))}signinPopup(e={}){(e=Object.assign({},e)).request_type="si:p";let t=e.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.display="popup",this._signin(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then(e=>(e&&(e.profile&&e.profile.sub?Le.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",e.profile.sub):Le.info("UserManager.signinPopup: no sub")),e))):(Le.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))}signinPopupCallback(e){return this._signinCallback(e,this._popupNavigator).then(e=>(e&&(e.profile&&e.profile.sub?Le.info("UserManager.signinPopupCallback: successful, signed in sub: ",e.profile.sub):Le.info("UserManager.signinPopupCallback: no sub")),e)).catch(e=>{Le.error("UserManager.signinPopupCallback error: "+e&&e.message)})}signinSilent(e={}){return(e=Object.assign({},e)).request_type="si:s",this._loadUser().then(t=>t&&t.refresh_token?(e.refresh_token=t.refresh_token,this._useRefreshToken(e)):(e.id_token_hint=e.id_token_hint||this.settings.includeIdTokenInSilentRenew&&t&&t.id_token,t&&this._settings.validateSubOnSilentRenew&&(Le.debug("UserManager.signinSilent, subject prior to silent renew: ",t.profile.sub),e.current_sub=t.profile.sub),this._signinSilentIframe(e)))}_useRefreshToken(e={}){return this._tokenClient.exchangeRefreshToken(e).then(e=>e?e.access_token?this._loadUser().then(t=>{if(t){let r=Promise.resolve();return e.id_token&&(r=this._validateIdTokenFromTokenRefreshToken(t.profile,e.id_token)),r.then(()=>(Le.debug("UserManager._useRefreshToken: refresh token response success"),t.id_token=e.id_token,t.access_token=e.access_token,t.refresh_token=e.refresh_token||t.refresh_token,t.expires_in=e.expires_in,this.storeUser(t).then(()=>(this._events.load(t),t))))}return null}):(Le.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(Le.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint")))}_validateIdTokenFromTokenRefreshToken(e,t){return this._metadataService.getIssuer().then(r=>this._joseUtil.validateJwtAttributes(t,r,this._settings.client_id,this._settings.clockSkew).then(t=>t?t.sub!==e.sub?(Le.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):t.auth_time&&t.auth_time!==e.auth_time?(Le.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):t.azp&&t.azp!==e.azp?(Le.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!t.azp&&e.azp?(Le.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(Le.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))))}_signinSilentIframe(e={}){let t=e.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.prompt=e.prompt||"none",this._signin(e,this._iframeNavigator,{startUrl:t,silentRequestTimeout:e.silentRequestTimeout||this.settings.silentRequestTimeout}).then(e=>(e&&(e.profile&&e.profile.sub?Le.info("UserManager.signinSilent: successful, signed in sub: ",e.profile.sub):Le.info("UserManager.signinSilent: no sub")),e))):(Le.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))}signinSilentCallback(e){return this._signinCallback(e,this._iframeNavigator).then(e=>(e&&(e.profile&&e.profile.sub?Le.info("UserManager.signinSilentCallback: successful, signed in sub: ",e.profile.sub):Le.info("UserManager.signinSilentCallback: no sub")),e))}signinCallback(e){return this.readSigninResponseState(e).then(({state:t,response:r})=>"si:r"===t.request_type?this.signinRedirectCallback(e):"si:p"===t.request_type?this.signinPopupCallback(e):"si:s"===t.request_type?this.signinSilentCallback(e):Promise.reject(new Error("invalid response_type in state")))}signoutCallback(e,t){return this.readSignoutResponseState(e).then(({state:r,response:i})=>r?"so:r"===r.request_type?this.signoutRedirectCallback(e):"so:p"===r.request_type?this.signoutPopupCallback(e,t):Promise.reject(new Error("invalid response_type in state")):i)}querySessionStatus(e={}){(e=Object.assign({},e)).request_type="si:s";let t=e.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.prompt="none",e.response_type=e.response_type||this.settings.query_status_response_type,e.scope=e.scope||"openid",e.skipUserInfo=!0,this._signinStart(e,this._iframeNavigator,{startUrl:t,silentRequestTimeout:e.silentRequestTimeout||this.settings.silentRequestTimeout}).then(e=>this.processSigninResponse(e.url).then(e=>{if(Le.debug("UserManager.querySessionStatus: got signin response"),e.session_state&&e.profile.sub)return Le.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid};Le.info("querySessionStatus successful, user not authenticated")}).catch(e=>{if(e.session_state&&this.settings.monitorAnonymousSession&&("login_required"==e.message||"consent_required"==e.message||"interaction_required"==e.message||"account_selection_required"==e.message))return Le.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:e.session_state};throw e}))):(Le.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))}_signin(e,t,r={}){return this._signinStart(e,t,r).then(t=>this._signinEnd(t.url,e))}_signinStart(e,t,r={}){return t.prepare(r).then(t=>(Le.debug("UserManager._signinStart: got navigator window handle"),this.createSigninRequest(e).then(e=>(Le.debug("UserManager._signinStart: got signin request"),r.url=e.url,r.id=e.state.id,t.navigate(r))).catch(e=>{throw t.close&&(Le.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),t.close()),e})))}_signinEnd(e,t={}){return this.processSigninResponse(e).then(e=>{Le.debug("UserManager._signinEnd: got signin response");let r=new Ei(e);if(t.current_sub){if(t.current_sub!==r.profile.sub)return Le.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",r.profile.sub),Promise.reject(new Error("login_required"));Le.debug("UserManager._signinEnd: current user matches user returned from signin")}return this.storeUser(r).then(()=>(Le.debug("UserManager._signinEnd: user stored"),this._events.load(r),r))})}_signinCallback(e,t){return Le.debug("UserManager._signinCallback"),t.callback(e)}signoutRedirect(e={}){(e=Object.assign({},e)).request_type="so:r";let t=e.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;t&&(e.post_logout_redirect_uri=t);let r={useReplaceToNavigate:e.useReplaceToNavigate};return this._signoutStart(e,this._redirectNavigator,r).then(()=>{Le.info("UserManager.signoutRedirect: successful")})}signoutRedirectCallback(e){return this._signoutEnd(e||this._redirectNavigator.url).then(e=>(Le.info("UserManager.signoutRedirectCallback: successful"),e))}signoutPopup(e={}){(e=Object.assign({},e)).request_type="so:p";let t=e.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return e.post_logout_redirect_uri=t,e.display="popup",e.post_logout_redirect_uri&&(e.state=e.state||{}),this._signout(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then(()=>{Le.info("UserManager.signoutPopup: successful")})}signoutPopupCallback(e,t){return void 0===t&&"boolean"==typeof e&&(t=e,e=null),this._popupNavigator.callback(e,t,"?").then(()=>{Le.info("UserManager.signoutPopupCallback: successful")})}_signout(e,t,r={}){return this._signoutStart(e,t,r).then(e=>this._signoutEnd(e.url))}_signoutStart(e={},t,r={}){return t.prepare(r).then(t=>(Le.debug("UserManager._signoutStart: got navigator window handle"),this._loadUser().then(i=>(Le.debug("UserManager._signoutStart: loaded current user from storage"),(this._settings.revokeAccessTokenOnSignout?this._revokeInternal(i):Promise.resolve()).then(()=>{var s=e.id_token_hint||i&&i.id_token;return s&&(Le.debug("UserManager._signoutStart: Setting id_token into signout request"),e.id_token_hint=s),this.removeUser().then(()=>(Le.debug("UserManager._signoutStart: user removed, creating signout request"),this.createSignoutRequest(e).then(e=>(Le.debug("UserManager._signoutStart: got signout request"),r.url=e.url,e.state&&(r.id=e.state.id),t.navigate(r)))))}))).catch(e=>{throw t.close&&(Le.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),t.close()),e})))}_signoutEnd(e){return this.processSignoutResponse(e).then(e=>(Le.debug("UserManager._signoutEnd: got signout response"),e))}revokeAccessToken(){return this._loadUser().then(e=>this._revokeInternal(e,!0).then(t=>{if(t)return Le.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),e.access_token=null,e.refresh_token=null,e.expires_at=null,e.token_type=null,this.storeUser(e).then(()=>{Le.debug("UserManager.revokeAccessToken: user stored"),this._events.load(e)})})).then(()=>{Le.info("UserManager.revokeAccessToken: access token revoked successfully")})}_revokeInternal(e,t){if(e){var r=e.access_token,i=e.refresh_token;return this._revokeAccessTokenInternal(r,t).then(e=>this._revokeRefreshTokenInternal(i,t).then(t=>(e||t||Le.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),e||t)))}return Promise.resolve(!1)}_revokeAccessTokenInternal(e,t){return!e||e.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(e,t).then(()=>!0)}_revokeRefreshTokenInternal(e,t){return e?this._tokenRevocationClient.revoke(e,t,"refresh_token").then(()=>!0):Promise.resolve(!1)}startSilentRenew(){this._silentRenewService.start()}stopSilentRenew(){this._silentRenewService.stop()}get _userStoreKey(){return`user:${this.settings.authority}:${this.settings.client_id}`}_loadUser(){return this._userStore.get(this._userStoreKey).then(e=>e?(Le.debug("UserManager._loadUser: user storageString loaded"),Ei.fromStorageString(e)):(Le.debug("UserManager._loadUser: no user storageString"),null))}storeUser(e){if(e){Le.debug("UserManager.storeUser: storing user");var t=e.toStorageString();return this._userStore.set(this._userStoreKey,t)}return Le.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)}},AccessTokenEvents:Ci,MetadataService:Xe,CordovaPopupNavigator:class{prepare(e){let t=new Mi(e);return Promise.resolve(t)}},CordovaIFrameNavigator:class{prepare(e){e.popupWindowFeatures="hidden=yes";let t=new Mi(e);return Promise.resolve(t)}},CheckSessionIFrame:Di,TokenRevocationClient:Ui,SessionMonitor:Ni,Global:ze,User:Ei};const Ki=De(!1),qi=De(!1),Li=De({});let $i="http://localhost:3000";try{$i=`${window.location.protocol}//${window.location.hostname}`}catch(st){}const Ji={authority:"https://auth.teessidehackspace.org.uk/auth/realms/master",client_id:"hackspace-api",redirect_uri:$i,post_logout_redirect_uri:$i,response_type:"id_token token",scope:"openid profile",filterProtocolClaims:!0,loadUserInfo:!0};var Wi=new class{constructor(){this.user=null}get isLoggedIn(){return null!==this.user&&this.user&&!this.user.expired}login(e){return this.user=null,this.updateStore(),this.userManager.signinRedirect(e)}updateStore(){this.isLoggedIn&&qi.set(!0),Ki.set(this.isLoggedIn),Li.set(this.user)}logoutSession(){return this.user=null,this.updateStore(),this.userManager.signoutRedirect()}async getUser(){try{this.user=await this.userManager.getUser(),this.user&&!this.user.expired||(this.user=await this.userManager.signinRedirectCallback()),this.updateStore()}catch(e){}return this.user}get userManager(){return this._userManager?this._userManager:this._userManager=new Vi.UserManager(Ji)}};function zi(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1}function Gi(e,{delay:r=0,duration:i=400,easing:s=t}){const n=+getComputedStyle(e).opacity;return{delay:r,duration:i,easing:s,css:e=>`opacity: ${e*n}`}}function Yi(e,{delay:t=0,speed:r,duration:i,easing:s=zi}){const n=e.getTotalLength();return void 0===i?i=void 0===r?800:n/r:"function"==typeof i&&(i=i(n)),{delay:t,duration:i,easing:s,css:(e,t)=>`stroke-dasharray: ${e*n} ${t*n}`}}function Qi(t){let r,i,s,n,o,a,u,c;return{c(){r=w("figure"),i=E("svg"),s=E("g"),n=E("path"),a=E("g"),u=E("path"),this.h()},l(e){var t=T(r=I(e,"FIGURE",{class:!0})),o=T(i=I(t,"svg",{version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,viewBox:!0,"enable-background":!0,"xml:space":!0,class:!0},1)),c=T(s=I(o,"g",{},1));T(n=I(c,"path",{style:!0,d:!0},1)).forEach(S),c.forEach(S);var h=T(a=I(o,"g",{},1));T(u=I(h,"path",{style:!0,d:!0},1)).forEach(S),h.forEach(S),o.forEach(S),t.forEach(S),this.h()},h(){U(n,"stroke",Xi),U(n,"stroke-width","3"),U(n,"fill","#FFFFFF"),C(n,"d",Zi),U(u,"fill",Xi),C(u,"d",Zi),C(i,"version","1.1"),C(i,"id","Layer_1"),C(i,"xmlns","http://www.w3.org/2000/svg"),C(i,"xmlns:xlink","http://www.w3.org/1999/xlink"),C(i,"x","0px"),C(i,"y","0px"),C(i,"viewBox","0 0 223.489 220.489"),C(i,"enable-background","new 0 0 223.489 220.489"),C(i,"xml:space","preserve"),C(i,"class","svelte-1j6awru"),C(r,"class","svelte-1j6awru")},m(e,t){F(e,r,t),_(r,i),_(i,s),_(s,n),_(i,a),_(a,u)},p:e,i(e){o||ne(()=>{(o=Fe(n,Yi,{duration:2e3})).start()}),c||ne(()=>{(c=Fe(u,Gi,{delay:1500,duration:1e3})).start()})},o:e,d(e){e&&S(r)}}}const Xi="#1AB91B",Zi="M175.262,51.21c-33.712-33.709-88.367-33.709-122.073,0c-33.713,33.712-33.713,88.365,0,122.075c33.706,33.71,88.364,33.71,122.073,0C208.972,139.575,208.972,84.922,175.262,51.21zM147.78,141.541l-19.69-19.687l6.193-6.193l-3.275-3.274l-16.645,16.646l3.271,3.277l6.41-6.413l19.695,19.688l-29.514,29.514l-19.692-19.689l3.359-3.356l-23.471-23.474l-3.363,3.36l-19.687-19.69l29.515-29.515l19.688,19.688l-6.414,6.412l4.031,4.03l16.65-16.647l-4.029-4.03l-6.197,6.196l-19.689-19.69l29.3-29.295l19.685,19.688l-3.355,3.36l23.47,23.472l3.361-3.36l19.688,19.691L147.78,141.541z";class es extends Re{constructor(e){super(),Ce(this,e,null,Qi,a,{})}}function ts(e){let t,r,i,s;return{c(){t=w("li"),r=w("a"),i=x("Member"),this.h()},l(e){var s=T(t=I(e,"LI",{class:!0})),n=T(r=I(s,"A",{"aria-current":!0,href:!0,class:!0}));i=D(n,"Member"),n.forEach(S),s.forEach(S),this.h()},h(){C(r,"aria-current",s="member"===e[0]?"page":void 0),C(r,"href","member"),C(r,"class","svelte-p8nm83"),C(t,"class","svelte-p8nm83")},m(e,s){F(e,t,s),_(t,r),_(r,i)},p(e,t){1&t&&s!==(s="member"===e[0]?"page":void 0)&&C(r,"aria-current",s)},d(e){e&&S(t)}}}function rs(e){let t,r,i,s;return{c(){t=w("li"),r=w("a"),i=x("Trustee"),this.h()},l(e){var s=T(t=I(e,"LI",{class:!0})),n=T(r=I(s,"A",{"aria-current":!0,href:!0,class:!0}));i=D(n,"Trustee"),n.forEach(S),s.forEach(S),this.h()},h(){C(r,"aria-current",s="trustee"===e[0]?"page":void 0),C(r,"href","trustee"),C(r,"class","svelte-p8nm83"),C(t,"class","svelte-p8nm83")},m(e,s){F(e,t,s),_(t,r),_(r,i)},p(e,t){1&t&&s!==(s="trustee"===e[0]?"page":void 0)&&C(r,"aria-current",s)},d(e){e&&S(t)}}}function is(t){let r,i,s,n,o;return{c(){r=w("li"),i=w("button"),s=x("Login"),this.h()},l(e){var t=T(r=I(e,"LI",{class:!0})),n=T(i=I(t,"BUTTON",{class:!0}));s=D(n,"Login"),n.forEach(S),t.forEach(S),this.h()},h(){C(i,"class","svelte-p8nm83"),C(r,"class","svelte-p8nm83")},m(e,a){F(e,r,a),_(r,i),_(i,s),n||(o=P(i,"click",t[4]),n=!0)},p:e,d(e){e&&S(r),n=!1,o()}}}function ss(t){let r,i,s,n,o;return{c(){r=w("li"),i=w("button"),s=x("Logout"),this.h()},l(e){var t=T(r=I(e,"LI",{class:!0})),n=T(i=I(t,"BUTTON",{class:!0}));s=D(n,"Logout"),n.forEach(S),t.forEach(S),this.h()},h(){C(i,"class","svelte-p8nm83"),C(r,"class","svelte-p8nm83")},m(e,a){F(e,r,a),_(r,i),_(i,s),n||(o=P(i,"click",t[3]),n=!0)},p:e,d(e){e&&S(r),n=!1,o()}}}function ns(e){let t,r,i,s,n,o,a,u,c,h,l,d,g,p,f,v,m,y,b,E,A,P,R,H,B,U,j,O,M,V,K,q,L,$,J,W,z=e[1].includes("member"),G=e[1].includes("trustee");s=new es({});let Y=z&&ts(e),Q=G&&rs(e);function X(e,t){return e[2]?ss:is}let Z=X(e),ee=Z(e);return{c(){t=w("nav"),r=w("header"),i=w("div"),xe(s.$$.fragment),n=k(),o=w("h1"),a=x("Teesside Hackspace"),u=k(),c=w("ul"),h=w("li"),l=w("a"),d=x("Home"),p=k(),f=w("li"),v=w("a"),m=x("Organisation"),b=k(),E=w("li"),A=w("a"),P=x("Wiki"),R=k(),H=w("li"),B=w("a"),U=x("Stats"),O=k(),M=w("li"),V=w("a"),K=x("Account"),L=k(),Y&&Y.c(),$=k(),Q&&Q.c(),J=k(),ee.c(),this.h()},l(e){var g=T(t=I(e,"NAV",{class:!0})),y=T(r=I(g,"HEADER",{class:!0})),_=T(i=I(y,"DIV",{class:!0}));ke(s.$$.fragment,_),_.forEach(S),n=N(y);var F=T(o=I(y,"H1",{class:!0}));a=D(F,"Teesside Hackspace"),F.forEach(S),y.forEach(S),u=N(g);var w=T(c=I(g,"UL",{class:!0})),x=T(h=I(w,"LI",{class:!0})),k=T(l=I(x,"A",{"aria-current":!0,href:!0,class:!0}));d=D(k,"Home"),k.forEach(S),x.forEach(S),p=N(w);var C=T(f=I(w,"LI",{class:!0})),j=T(v=I(C,"A",{"aria-current":!0,href:!0,class:!0}));m=D(j,"Organisation"),j.forEach(S),C.forEach(S),b=N(w);var q=T(E=I(w,"LI",{class:!0})),W=T(A=I(q,"A",{href:!0,class:!0}));P=D(W,"Wiki"),W.forEach(S),q.forEach(S),R=N(w);var z=T(H=I(w,"LI",{class:!0})),G=T(B=I(z,"A",{"aria-current":!0,href:!0,class:!0}));U=D(G,"Stats"),G.forEach(S),z.forEach(S),O=N(w);var X=T(M=I(w,"LI",{class:!0})),Z=T(V=I(X,"A",{"aria-current":!0,href:!0,class:!0}));K=D(Z,"Account"),Z.forEach(S),X.forEach(S),L=N(w),Y&&Y.l(w),$=N(w),Q&&Q.l(w),J=N(w),ee.l(w),w.forEach(S),g.forEach(S),this.h()},h(){C(i,"class","logoContainer svelte-p8nm83"),C(o,"class","svelte-p8nm83"),C(r,"class","svelte-p8nm83"),C(l,"aria-current",g=void 0===e[0]?"page":void 0),C(l,"href","."),C(l,"class","svelte-p8nm83"),C(h,"class","svelte-p8nm83"),C(v,"aria-current",y="organisation"===e[0]?"page":void 0),C(v,"href","organisation"),C(v,"class","svelte-p8nm83"),C(f,"class","svelte-p8nm83"),C(A,"href","https://dokuwiki.teessidehackspace.org.uk/Main"),C(A,"class","svelte-p8nm83"),C(E,"class","svelte-p8nm83"),C(B,"aria-current",j="stats"===e[0]?"page":void 0),C(B,"href","stats"),C(B,"class","svelte-p8nm83"),C(H,"class","svelte-p8nm83"),C(V,"aria-current",q="account"===e[0]?"page":void 0),C(V,"href","account"),C(V,"class","svelte-p8nm83"),C(M,"class","svelte-p8nm83"),C(c,"class","svelte-p8nm83"),C(t,"class","svelte-p8nm83")},m(e,g){F(e,t,g),_(t,r),_(r,i),Ae(s,i,null),_(r,n),_(r,o),_(o,a),_(t,u),_(t,c),_(c,h),_(h,l),_(l,d),_(c,p),_(c,f),_(f,v),_(v,m),_(c,b),_(c,E),_(E,A),_(A,P),_(c,R),_(c,H),_(H,B),_(B,U),_(c,O),_(c,M),_(M,V),_(V,K),_(c,L),Y&&Y.m(c,null),_(c,$),Q&&Q.m(c,null),_(c,J),ee.m(c,null),W=!0},p(e,[t]){(!W||1&t&&g!==(g=void 0===e[0]?"page":void 0))&&C(l,"aria-current",g),(!W||1&t&&y!==(y="organisation"===e[0]?"page":void 0))&&C(v,"aria-current",y),(!W||1&t&&j!==(j="stats"===e[0]?"page":void 0))&&C(B,"aria-current",j),(!W||1&t&&q!==(q="account"===e[0]?"page":void 0))&&C(V,"aria-current",q),2&t&&(z=e[1].includes("member")),z?Y?Y.p(e,t):((Y=ts(e)).c(),Y.m(c,$)):Y&&(Y.d(1),Y=null),2&t&&(G=e[1].includes("trustee")),G?Q?Q.p(e,t):((Q=rs(e)).c(),Q.m(c,J)):Q&&(Q.d(1),Q=null),Z===(Z=X(e))&&ee?ee.p(e,t):(ee.d(1),(ee=Z(e))&&(ee.c(),ee.m(c,null)))},i(e){W||(me(s.$$.fragment,e),W=!0)},o(e){ye(s.$$.fragment,e),W=!1},d(e){e&&S(t),Pe(s),Y&&Y.d(),Q&&Q.d(),ee.d()}}}function os(e,t,r){let i;u(e,Ki,e=>r(2,i=e));let s=[];(async()=>{const e=await Wi.getUser();e&&(console.log(e),r(1,s=e.profile.resource_access["hackspace-api"].roles))})();let{segment:n}=t;return e.$set=(e=>{"segment"in e&&r(0,n=e.segment)}),[n,s,i,function(){Wi.logoutSession()},function(){Wi.login({redirect_uri:window.location})}]}class as extends Re{constructor(e){super(),Ce(this,e,os,ns,a,{segment:0})}}class us{constructor(e){this.router=e}match(e){const t=this.router.lookup.find(t=>e.match(t));return this.router.routes[t]}}const cs=(new class{constructor(){this.lookup=[],this.routes={},this.unrestrict("/client/.*")}addMapping(e,t){const r=new RegExp(e);this.routes[r]=Object.assign({path:e},t),this.lookup.push(r)}restrict(e,t){return this.addMapping(e,{scope:t}),this}unrestrict(e){return this.addMapping(e,{auth:!1}),this}build(){return new us(this)}}).restrict("/account.*",["user"]).restrict("/trustees.*",["trustee"]).restrict("/members.*",["customer"]).unrestrict(".*").unrestrict("/login.*").unrestrict("/index.*").build();function hs(e){let t,r,i,s;t=new as({props:{segment:e[0]}});const n=e[3].default,o=c(n,e,e[2],null);return{c(){xe(t.$$.fragment),r=k(),i=w("main"),o&&o.c(),this.h()},l(e){ke(t.$$.fragment,e),r=N(e);var s=T(i=I(e,"MAIN",{class:!0}));o&&o.l(s),s.forEach(S),this.h()},h(){C(i,"class","svelte-k66kze")},m(e,n){Ae(t,e,n),F(e,r,n),F(e,i,n),o&&o.m(i,null),s=!0},p(e,r){const i={};1&r&&(i.segment=e[0]),t.$set(i),o&&o.p&&4&r&&l(o,n,e,e[2],r,null,null)},i(e){s||(me(t.$$.fragment,e),me(o,e),s=!0)},o(e){ye(t.$$.fragment,e),ye(o,e),s=!1},d(e){Pe(t,e),e&&S(r),e&&S(i),o&&o.d(e)}}}function ls(e){let t,r,i=e[1]&&hs(e);return{c(){i&&i.c(),t=A()},l(e){i&&i.l(e),t=A()},m(e,s){i&&i.m(e,s),F(e,t,s),r=!0},p(e,[r]){e[1]?i?(i.p(e,r),2&r&&me(i,1)):((i=hs(e)).c(),me(i,1),i.m(t.parentNode,t)):i&&(fe(),ye(i,1,1,()=>{i=null}),ve())},i(e){r||(me(i),r=!0)},o(e){ye(i),r=!1},d(e){i&&i.d(e),e&&S(t)}}}function ds(e,t,r){let i;u(e,Ki,e=>r(4,i=e));let s=!1;(async()=>{if(!i){await Wi.getUser()}r(1,s=!0)})();const{page:n,session:o}=nn(),a={routes:cs,deny:()=>{r(1,s=!1),Wi.login({redirect_uri:window.location})}};n.subscribe(async e=>{await(se(),re);const t=await Wi.getUser();let r=i&&t?["logged_in"]:[];r.length&&(r=r.concat(t.profile.resource_access["hackspace-api"].roles)),function(e,t,r){const i=r.routes.match(e),s=t&&t.scope||[],n=i.scope;!1===i.auth||n.find(e=>s.includes(e))?r.grant&&r.grant():r.deny(e,{given:s,required:n})}(e.path,{scope:r},a)});let{segment:c}=t,{$$slots:h={},$$scope:l}=t;return e.$set=(e=>{"segment"in e&&r(0,c=e.segment),"$$scope"in e&&r(2,l=e.$$scope)}),[c,s,l,h]}class gs extends Re{constructor(e){super(),Ce(this,e,ds,ls,a,{segment:0})}}function ps(e){let t,r,i=e[1].stack+"";return{c(){t=w("pre"),r=x(i)},l(e){var s=T(t=I(e,"PRE",{}));r=D(s,i),s.forEach(S)},m(e,i){F(e,t,i),_(t,r)},p(e,t){2&t&&i!==(i=e[1].stack+"")&&H(r,i)},d(e){e&&S(t)}}}function fs(e){let t,r,i,s,n,o,a,u,c,h,l,d,g=e[1].message+"";document.title=t=e[0],i=new as({props:{segment:segment}});let p=e[2]&&e[1].stack&&ps(e);return{c(){r=k(),xe(i.$$.fragment),s=k(),n=w("h1"),o=x(e[0]),a=k(),u=w("p"),c=x(g),h=k(),p&&p.c(),l=A(),this.h()},l(t){O('[data-svelte="svelte-1o9r2ue"]',document.head).forEach(S),r=N(t),ke(i.$$.fragment,t),s=N(t);var d=T(n=I(t,"H1",{class:!0}));o=D(d,e[0]),d.forEach(S),a=N(t);var f=T(u=I(t,"P",{class:!0}));c=D(f,g),f.forEach(S),h=N(t),p&&p.l(t),l=A(),this.h()},h(){C(n,"class","svelte-u4e356"),C(u,"class","svelte-u4e356")},m(e,t){F(e,r,t),Ae(i,e,t),F(e,s,t),F(e,n,t),_(n,o),F(e,a,t),F(e,u,t),_(u,c),F(e,h,t),p&&p.m(e,t),F(e,l,t),d=!0},p(e,[r]){(!d||1&r)&&t!==(t=e[0])&&(document.title=t),(!d||1&r)&&H(o,e[0]),(!d||2&r)&&g!==(g=e[1].message+"")&&H(c,g),e[2]&&e[1].stack?p?p.p(e,r):((p=ps(e)).c(),p.m(l.parentNode,l)):p&&(p.d(1),p=null)},i(e){d||(me(i.$$.fragment,e),d=!0)},o(e){ye(i.$$.fragment,e),d=!1},d(e){e&&S(r),Pe(i,e),e&&S(s),e&&S(n),e&&S(a),e&&S(u),e&&S(h),p&&p.d(e),e&&S(l)}}}function vs(e,t,r){let{status:i}=t,{error:s}=t;return e.$set=(e=>{"status"in e&&r(0,i=e.status),"error"in e&&r(1,s=e.error)}),[i,s,!1]}class ms extends Re{constructor(e){super(),Ce(this,e,vs,fs,a,{status:0,error:1})}}function ys(e){let t,i,s;const n=[e[4].props];var o=e[4].component;function a(e){let t={};for(let e=0;e<n.length;e+=1)t=r(t,n[e]);return{props:t}}return o&&(t=new o(a())),{c(){t&&xe(t.$$.fragment),i=A()},l(e){t&&ke(t.$$.fragment,e),i=A()},m(e,r){t&&Ae(t,e,r),F(e,i,r),s=!0},p(e,r){const s=16&r?be(n,[we(e[4].props)]):{};if(o!==(o=e[4].component)){if(t){fe();const e=t;ye(e.$$.fragment,1,0,()=>{Pe(e,1)}),ve()}o?(xe((t=new o(a())).$$.fragment),me(t.$$.fragment,1),Ae(t,i.parentNode,i)):t=null}else o&&t.$set(s)},i(e){s||(t&&me(t.$$.fragment,e),s=!0)},o(e){t&&ye(t.$$.fragment,e),s=!1},d(e){e&&S(i),t&&Pe(t,e)}}}function _s(e){let t,r;return t=new ms({props:{error:e[0],status:e[1]}}),{c(){xe(t.$$.fragment)},l(e){ke(t.$$.fragment,e)},m(e,i){Ae(t,e,i),r=!0},p(e,r){const i={};1&r&&(i.error=e[0]),2&r&&(i.status=e[1]),t.$set(i)},i(e){r||(me(t.$$.fragment,e),r=!0)},o(e){ye(t.$$.fragment,e),r=!1},d(e){Pe(t,e)}}}function Fs(e){let t,r,i,s;const n=[_s,ys],o=[];function a(e,t){return e[0]?0:1}return t=a(e),r=o[t]=n[t](e),{c(){r.c(),i=A()},l(e){r.l(e),i=A()},m(e,r){o[t].m(e,r),F(e,i,r),s=!0},p(e,s){let u=t;(t=a(e))===u?o[t].p(e,s):(fe(),ye(o[u],1,1,()=>{o[u]=null}),ve(),(r=o[t])||(r=o[t]=n[t](e)).c(),me(r,1),r.m(i.parentNode,i))},i(e){s||(me(r),s=!0)},o(e){ye(r),s=!1},d(e){o[t].d(e),e&&S(i)}}}function Ss(e){let t,i;const s=[{segment:e[2][0]},e[3].props];let n={$$slots:{default:[Fs]},$$scope:{ctx:e}};for(let e=0;e<s.length;e+=1)n=r(n,s[e]);return t=new gs({props:n}),{c(){xe(t.$$.fragment)},l(e){ke(t.$$.fragment,e)},m(e,r){Ae(t,e,r),i=!0},p(e,[r]){const i=12&r?be(s,[4&r&&{segment:e[2][0]},8&r&&we(e[3].props)]):{};147&r&&(i.$$scope={dirty:r,ctx:e}),t.$set(i)},i(e){i||(me(t.$$.fragment,e),i=!0)},o(e){ye(t.$$.fragment,e),i=!1},d(e){Pe(t,e)}}}function bs(e,t,r){let{stores:i}=t,{error:s}=t,{status:n}=t,{segments:o}=t,{level0:a}=t,{level1:u=null}=t,{notify:c}=t;return W(c),G(Ne,i),e.$set=(e=>{"stores"in e&&r(5,i=e.stores),"error"in e&&r(0,s=e.error),"status"in e&&r(1,n=e.status),"segments"in e&&r(2,o=e.segments),"level0"in e&&r(3,a=e.level0),"level1"in e&&r(4,u=e.level1),"notify"in e&&r(6,c=e.notify)}),[s,n,o,a,u,i,c]}class ws extends Re{constructor(e){super(),Ce(this,e,bs,Ss,a,{stores:5,error:0,status:1,segments:2,level0:3,level1:4,notify:6})}}const Es=[],xs=[{js:()=>import("./index.8e86849b.js"),css:["index.8e86849b.css","client.40169bd0.css"]},{js:()=>import("./organisation.7eea257e.js"),css:["organisation.7eea257e.css","client.40169bd0.css"]},{js:()=>import("./account.b53eb808.js"),css:["account.b53eb808.css","client.40169bd0.css"]},{js:()=>import("./trustee.44297f20.js"),css:["client.40169bd0.css"]},{js:()=>import("./member.98b05797.js"),css:["member.98b05797.css","client.40169bd0.css"]},{js:()=>import("./login.691f2b7b.js"),css:["login.691f2b7b.css","client.40169bd0.css"]},{js:()=>import("./stats.27a9af09.js"),css:["stats.27a9af09.css","client.40169bd0.css"]}],ks=[{pattern:/^\/$/,parts:[{i:0}]},{pattern:/^\/organisation\/?$/,parts:[{i:1}]},{pattern:/^\/account\/?$/,parts:[{i:2}]},{pattern:/^\/trustee\/?$/,parts:[{i:3}]},{pattern:/^\/member\/?$/,parts:[{i:4}]},{pattern:/^\/login\/?$/,parts:[{i:5}]},{pattern:/^\/stats\/?$/,parts:[{i:6}]}];const As="undefined"!=typeof __SAPPER__&&__SAPPER__;let Ps,Cs,Rs,Ts=!1,Is=[],Ds="{}";const Ns={page:function(e){const t=De(e);let r=!0;return{notify:function(){r=!0,t.update(e=>e)},set:function(e){r=!1,t.set(e)},subscribe:function(e){let i;return t.subscribe(t=>{(void 0===i||r&&t!==i)&&e(i=t)})}}}({}),preloading:De(null),session:De(As&&As.session)};let Hs,Bs;Ns.session.subscribe(async e=>{if(Hs=e,!Ts)return;Bs=!0;const t=Ls(new URL(location.href)),r=Cs={},{redirect:i,props:s,branch:n}=await zs(t);r===Cs&&await Ws(i,n,s,t.page)});let Us,js=null;let Os,Ms=1;const Vs="undefined"!=typeof history?history:{pushState:(e,t,r)=>{},replaceState:(e,t,r)=>{},scrollRestoration:""},Ks={};function qs(e){const t=Object.create(null);return e.length>0&&e.slice(1).split("&").forEach(e=>{let[,r,i=""]=/([^=]*)(?:=(.*))?/.exec(decodeURIComponent(e.replace(/\+/g," ")));"string"==typeof t[r]&&(t[r]=[t[r]]),"object"==typeof t[r]?t[r].push(i):t[r]=i}),t}function Ls(e){if(e.origin!==location.origin)return null;if(!e.pathname.startsWith(As.baseUrl))return null;let t=e.pathname.slice(As.baseUrl.length);if(""===t&&(t="/"),!Es.some(e=>e.test(t)))for(let r=0;r<ks.length;r+=1){const i=ks[r],s=i.pattern.exec(t);if(s){const r=qs(e.search),n=i.parts[i.parts.length-1],o=n.params?n.params(s):{},a={host:location.host,path:t,query:r,params:o};return{href:e.href,route:i,match:s,page:a}}}}function $s(){return{x:pageXOffset,y:pageYOffset}}async function Js(e,t,r,i){if(t)Os=t;else{const e=$s();Ks[Os]=e,t=Os=++Ms,Ks[Os]=r?e:{x:0,y:0}}Os=t,Ps&&Ns.preloading.set(!0);const s=js&&js.href===e.href?js.promise:zs(e);js=null;const n=Cs={},{redirect:o,props:a,branch:u}=await s;if(n===Cs&&(await Ws(o,u,a,e.page),document.activeElement&&document.activeElement.blur(),!r)){let e=Ks[t];if(i){const t=document.getElementById(i.slice(1));t&&(e={x:0,y:t.getBoundingClientRect().top+scrollY})}Ks[Os]=e,e&&scrollTo(e.x,e.y)}}async function Ws(e,t,r,i){if(e)return function(e,t={replaceState:!1}){const r=Ls(new URL(e,document.baseURI));return r?(Vs[t.replaceState?"replaceState":"pushState"]({id:Os},"",e),Js(r,null).then(()=>{})):(location.href=e,new Promise(e=>{}))}(e.location,{replaceState:!0});if(Ns.page.set(i),Ns.preloading.set(!1),Ps)Ps.$set(r);else{r.stores={page:{subscribe:Ns.page.subscribe},preloading:{subscribe:Ns.preloading.subscribe},session:Ns.session},r.level0={props:await Rs},r.notify=Ns.page.notify;const e=document.querySelector("#sapper-head-start"),t=document.querySelector("#sapper-head-end");if(e&&t){for(;e.nextSibling!==t;)Ys(e.nextSibling);Ys(e),Ys(t)}Ps=new ws({target:Us,props:r,hydrate:!0})}Is=t,Ds=JSON.stringify(i.query),Ts=!0,Bs=!1}async function zs(e){const{route:t,page:r}=e,i=r.path.split("/").filter(Boolean);let s=null;const n={error:null,status:200,segments:[i[0]]},o={fetch:(e,t)=>fetch(e,t),redirect:(e,t)=>{if(s&&(s.statusCode!==e||s.location!==t))throw new Error("Conflicting redirects");s={statusCode:e,location:t}},error:(e,t)=>{n.error="string"==typeof t?new Error(t):t,n.status=e}};let a;Rs||(Rs=As.preloaded[0]||He.call(o,{host:r.host,path:r.path,query:r.query,params:{}},Hs));let u=1;try{const s=JSON.stringify(r.query),c=t.pattern.exec(r.path);let h=!1;a=await Promise.all(t.parts.map(async(t,a)=>{const l=i[a];if(function(e,t,r,i){if(i!==Ds)return!0;const s=Is[e];return!!s&&(t!==s.segment||!(!s.match||JSON.stringify(s.match.slice(1,e+2))===JSON.stringify(r.slice(1,e+2)))||void 0)}(a,l,c,s)&&(h=!0),n.segments[u]=i[a+1],!t)return{segment:l};const d=u++;if(!Bs&&!h&&Is[a]&&Is[a].part===t.i)return Is[a];h=!1;const{default:g,preload:p}=await function(e){const t="string"==typeof e.css?[]:e.css.map(Gs);return t.unshift(e.js()),Promise.all(t).then(e=>e[0])}(xs[t.i]);let f;return f=Ts||!As.preloaded[a+1]?p?await p.call(o,{host:r.host,path:r.path,query:r.query,params:t.params?t.params(e.match):{}},Hs):{}:As.preloaded[a+1],n[`level${d}`]={component:g,props:f,segment:l,match:c,part:t.i}}))}catch(e){n.error=e,n.status=500,a=[]}return{redirect:s,props:n,branch:a}}function Gs(e){const t=`client/${e}`;if(!document.querySelector(`link[href="${t}"]`))return new Promise((e,r)=>{const i=document.createElement("link");i.rel="stylesheet",i.href=t,i.onload=(()=>e()),i.onerror=r,document.head.appendChild(i)})}function Ys(e){e.parentNode.removeChild(e)}function Qs(e){const t=Ls(new URL(e,document.baseURI));if(t)return js&&e===js.href||function(e,t){js={href:e,promise:t}}(e,zs(t)),js.promise}let Xs;function Zs(e){clearTimeout(Xs),Xs=setTimeout(()=>{en(e)},20)}function en(e){const t=rn(e.target);t&&"prefetch"===t.rel&&Qs(t.href)}function tn(e){if(1!==function(e){return null===e.which?e.button:e.which}(e))return;if(e.metaKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;const t=rn(e.target);if(!t)return;if(!t.href)return;const r="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name,i=String(r?t.href.baseVal:t.href);if(i===location.href)return void(location.hash||e.preventDefault());if(t.hasAttribute("download")||"external"===t.getAttribute("rel"))return;if(r?t.target.baseVal:t.target)return;const s=new URL(i);if(s.pathname===location.pathname&&s.search===location.search)return;const n=Ls(s);if(n){Js(n,null,t.hasAttribute("sapper-noscroll"),s.hash),e.preventDefault(),Vs.pushState({id:Os},"",s.href)}}function rn(e){for(;e&&"A"!==e.nodeName.toUpperCase();)e=e.parentNode;return e}function sn(e){if(Ks[Os]=$s(),e.state){const t=Ls(new URL(location.href));t?Js(t,e.state.id):location.href=location.href}else(function(e){Os=e})(Ms=Ms+1),Vs.replaceState({id:Os},"",location.href)}const nn=()=>Y(Ne);!function(e){var t;"scrollRestoration"in Vs&&(Vs.scrollRestoration="manual"),addEventListener("beforeunload",()=>{Vs.scrollRestoration="auto"}),addEventListener("load",()=>{Vs.scrollRestoration="manual"}),t=e.target,Us=t,addEventListener("click",tn),addEventListener("popstate",sn),addEventListener("touchstart",en),addEventListener("mousemove",Zs),Promise.resolve().then(()=>{const{hash:e,href:t}=location;Vs.replaceState({id:Ms},"",t);const r=new URL(location.href);if(As.error)return function(e){const{host:t,pathname:r,search:i}=location,{session:s,preloaded:n,status:o,error:a}=As;Rs||(Rs=n&&n[0]),Ws(null,[],{error:a,status:o,session:s,level0:{props:Rs},level1:{props:{status:o,error:a},component:ms},segments:n},{host:t,path:r,query:qs(i),params:{}})}();const i=Ls(r);return i?Js(i,Ms,!0,e):void 0})}({target:document.querySelector("#sapper")});export{Yr as $,n as A,$ as B,d as C,Y as D,xe as E,A as F,ke as G,Ae as H,we as I,fe as J,Pe as K,ve as L,G as M,j as N,H as O,J as P,z as Q,Z as R,Re as S,B as T,Ee as U,oe as V,Se as W,u as X,Ki as Y,b as Z,Li as _,k as a,Gr as a0,Qr as a1,zr as a2,Wi as a3,Ie as a4,es as a5,ne as a6,Fe as a7,Gi as a8,qi as a9,W as aa,U as ab,I as b,N as c,S as d,w as e,T as f,D as g,C as h,Ce as i,F as j,_ as k,P as l,Q as m,e as n,c as o,r as p,O as q,R as r,a as s,x as t,g as u,l as v,be as w,o as x,me as y,ye as z};
